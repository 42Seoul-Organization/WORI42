{"ast":null,"code":"/**\r\n * A collection of low-level async operation stuff.\r\n */\n\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\nimport * as $array from \"./Array\";\nvar pendingFrame = false;\nvar nextQueue = [];\nvar readQueue = [];\nvar writeQueue = [];\nvar idleQueue = [];\nvar fps = 1000 / 60;\n/**\r\n * [raf description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\n\nexport var raf = typeof requestAnimationFrame === \"function\" ? function (fn) {\n  requestAnimationFrame(fn);\n} : function (fn) {\n  setTimeout(fn, fps);\n};\n/**\r\n * [frameLoop description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\n\nfunction frameLoop() {\n  var now = Date.now();\n  var length = nextQueue.length;\n\n  for (var i = 0; i < length; ++i) {\n    nextQueue[i](now);\n  }\n\n  $array.shiftLeft(nextQueue, length);\n\n  for (var i = 0; i < readQueue.length; ++i) {\n    readQueue[i](now);\n  }\n\n  readQueue.length = 0;\n\n  for (var i = 0; i < writeQueue.length; ++i) {\n    writeQueue[i](now);\n  }\n\n  writeQueue.length = 0;\n\n  if (nextQueue.length === 0 && readQueue.length === 0) {\n    pendingFrame = false;\n  } else {\n    raf(frameLoop);\n  }\n}\n/**\r\n * [pendFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\n\n\nfunction pendFrame() {\n  if (!pendingFrame) {\n    pendingFrame = true;\n    raf(frameLoop);\n  }\n}\n/**\r\n * [nextFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\n\n\nexport function nextFrame(fn) {\n  nextQueue.push(fn);\n  pendFrame();\n}\n/**\r\n * [readFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\n\nexport function readFrame(fn) {\n  readQueue.push(fn);\n  pendFrame();\n}\n/**\r\n * [writeFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\n\nexport function writeFrame(fn) {\n  writeQueue.push(fn);\n  pendFrame();\n}\n/**\r\n * [whenIdle description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\n\nexport function whenIdle(fn) {\n  idleQueue.push(fn);\n}\n/**\r\n * [triggerIdle description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @todo Maybe don't trigger a callback which was added while in the middle of triggering?\r\n */\n\nexport function triggerIdle() {\n  var now = Date.now();\n  var length = idleQueue.length;\n\n  for (var i = 0; i < length; ++i) {\n    idleQueue.shift()(now);\n  }\n}","map":{"version":3,"sources":["../../../../../src/.internal/core/utils/AsyncPending.ts"],"names":[],"mappings":"AAAA;;;;AAIA;;;;;;AAMA,OAAO,KAAK,MAAZ,MAAwB,SAAxB;AAUA,IAAI,YAAY,GAAG,KAAnB;AAEA,IAAM,SAAS,GAAoB,EAAnC;AACA,IAAM,SAAS,GAAoB,EAAnC;AACA,IAAM,UAAU,GAAoB,EAApC;AACA,IAAM,SAAS,GAAoB,EAAnC;AAGA,IAAM,GAAG,GAAG,OAAO,EAAnB;AAEA;;;;;;;AAMA,OAAO,IAAM,GAAG,GACd,OAAO,qBAAP,KAAiC,UAAjC,GACE,UAAS,EAAT,EAAuB;AACxB,EAAA,qBAAqB,CAAC,EAAD,CAArB;AACA,CAHD,GAIE,UAAS,EAAT,EAAuB;AACxB,EAAA,UAAU,CAAC,EAAD,EAAK,GAAL,CAAV;AACA,CAPI;AASP;;;;;;;AAMA,SAAS,SAAT,GAAkB;AACjB,MAAM,GAAG,GAAG,IAAI,CAAC,GAAL,EAAZ;AAGA,MAAM,MAAM,GAAG,SAAS,CAAC,MAAzB;;AAEA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,MAApB,EAA4B,EAAE,CAA9B,EAAiC;AAChC,IAAA,SAAS,CAAC,CAAD,CAAT,CAAa,GAAb;AACA;;AAED,EAAA,MAAM,CAAC,SAAP,CAAiB,SAAjB,EAA4B,MAA5B;;AAGA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,SAAS,CAAC,MAA9B,EAAsC,EAAE,CAAxC,EAA2C;AAC1C,IAAA,SAAS,CAAC,CAAD,CAAT,CAAa,GAAb;AACA;;AAED,EAAA,SAAS,CAAC,MAAV,GAAmB,CAAnB;;AAGA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,UAAU,CAAC,MAA/B,EAAuC,EAAE,CAAzC,EAA4C;AAC3C,IAAA,UAAU,CAAC,CAAD,CAAV,CAAc,GAAd;AACA;;AAED,EAAA,UAAU,CAAC,MAAX,GAAoB,CAApB;;AAGA,MAAI,SAAS,CAAC,MAAV,KAAqB,CAArB,IAA0B,SAAS,CAAC,MAAV,KAAqB,CAAnD,EAAsD;AACrD,IAAA,YAAY,GAAG,KAAf;AAEA,GAHD,MAGO;AACN,IAAA,GAAG,CAAC,SAAD,CAAH;AACA;AACD;AAED;;;;;;;;AAMA,SAAS,SAAT,GAAkB;AACjB,MAAI,CAAC,YAAL,EAAmB;AAClB,IAAA,YAAY,GAAG,IAAf;AAEA,IAAA,GAAG,CAAC,SAAD,CAAH;AACA;AACD;AAGD;;;;;;;;;AAOA,OAAM,SAAU,SAAV,CAAoB,EAApB,EAAgC;AACrC,EAAA,SAAS,CAAC,IAAV,CAAe,EAAf;AACA,EAAA,SAAS;AACT;AAED;;;;;;;;AAOA,OAAM,SAAU,SAAV,CAAoB,EAApB,EAAgC;AACrC,EAAA,SAAS,CAAC,IAAV,CAAe,EAAf;AACA,EAAA,SAAS;AACT;AAED;;;;;;;;AAOA,OAAM,SAAU,UAAV,CAAqB,EAArB,EAAiC;AACtC,EAAA,UAAU,CAAC,IAAX,CAAgB,EAAhB;AACA,EAAA,SAAS;AACT;AAED;;;;;;;;AAOA,OAAM,SAAU,QAAV,CAAmB,EAAnB,EAA+B;AACpC,EAAA,SAAS,CAAC,IAAV,CAAe,EAAf;AACA;AAED;;;;;;;;AAOA,OAAM,SAAU,WAAV,GAAqB;AAC1B,MAAM,GAAG,GAAG,IAAI,CAAC,GAAL,EAAZ;AAEA,MAAM,MAAM,GAAG,SAAS,CAAC,MAAzB;;AAEA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,MAApB,EAA4B,EAAE,CAA9B,EAAiC;AAC1B,IAAA,SAAS,CAAC,KAAV,GAAmB,GAAnB;AACN;AACD","sourcesContent":["/**\r\n * A collection of low-level async operation stuff.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport * as $array from \"./Array\";\r\n\r\n/**\r\n * [Listener description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\r\nexport type Listener = (now: number) => void;\r\n\r\nlet pendingFrame = false;\r\n\r\nconst nextQueue: Array<Listener> = [];\r\nconst readQueue: Array<Listener> = [];\r\nconst writeQueue: Array<Listener> = [];\r\nconst idleQueue: Array<Listener> = [];\r\n\r\n\r\nconst fps = 1000 / 60;\r\n\r\n/**\r\n * [raf description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\r\nexport const raf =\r\n\t(typeof requestAnimationFrame === \"function\"\r\n\t\t? function(fn: () => void): void {\r\n\t\t\trequestAnimationFrame(fn);\r\n\t\t}\r\n\t\t: function(fn: () => void): void {\r\n\t\t\tsetTimeout(fn, fps);\r\n\t\t});\r\n\r\n/**\r\n * [frameLoop description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\r\nfunction frameLoop(): void {\r\n\tconst now = Date.now();\r\n\r\n\r\n\tconst length = nextQueue.length;\r\n\r\n\tfor (let i = 0; i < length; ++i) {\r\n\t\tnextQueue[i](now);\r\n\t}\r\n\r\n\t$array.shiftLeft(nextQueue, length);\r\n\r\n\r\n\tfor (let i = 0; i < readQueue.length; ++i) {\r\n\t\treadQueue[i](now);\r\n\t}\r\n\r\n\treadQueue.length = 0;\r\n\r\n\r\n\tfor (let i = 0; i < writeQueue.length; ++i) {\r\n\t\twriteQueue[i](now);\r\n\t}\r\n\r\n\twriteQueue.length = 0;\r\n\r\n\r\n\tif (nextQueue.length === 0 && readQueue.length === 0) {\r\n\t\tpendingFrame = false;\r\n\r\n\t} else {\r\n\t\traf(frameLoop);\r\n\t}\r\n}\r\n\r\n/**\r\n * [pendFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\r\nfunction pendFrame(): void {\r\n\tif (!pendingFrame) {\r\n\t\tpendingFrame = true;\r\n\r\n\t\traf(frameLoop);\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * [nextFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\r\nexport function nextFrame(fn: Listener): void {\r\n\tnextQueue.push(fn);\r\n\tpendFrame();\r\n}\r\n\r\n/**\r\n * [readFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\r\nexport function readFrame(fn: Listener): void {\r\n\treadQueue.push(fn);\r\n\tpendFrame();\r\n}\r\n\r\n/**\r\n * [writeFrame description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\r\nexport function writeFrame(fn: Listener): void {\r\n\twriteQueue.push(fn);\r\n\tpendFrame();\r\n}\r\n\r\n/**\r\n * [whenIdle description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param fn [description]\r\n */\r\nexport function whenIdle(fn: Listener): void {\r\n\tidleQueue.push(fn);\r\n}\r\n\r\n/**\r\n * [triggerIdle description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @todo Maybe don't trigger a callback which was added while in the middle of triggering?\r\n */\r\nexport function triggerIdle(): void {\r\n\tconst now = Date.now();\r\n\r\n\tconst length = idleQueue.length;\r\n\r\n\tfor (let i = 0; i < length; ++i) {\r\n\t\t(<any>idleQueue.shift())(now);\r\n\t}\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}