{"ast":null,"code":"import * as $array from \"./Array\";\nimport * as $log from \"./Log\";\n\nvar Native =\n/** @class */\nfunction () {\n  function Native() {\n    var _this = this;\n\n    this._targets = [];\n    this._observer = new ResizeObserver(function (entries) {\n      $array.each(entries, function (entry) {\n        $array.each(_this._targets, function (x) {\n          if (x.target === entry.target) {\n            x.callback();\n          }\n        });\n      });\n    });\n  }\n\n  Native.prototype.addTarget = function (target, callback) {\n    this._observer.observe(target, {\n      box: \"content-box\"\n    });\n\n    this._targets.push({\n      target: target,\n      callback: callback\n    });\n  };\n\n  Native.prototype.removeTarget = function (target) {\n    this._observer.unobserve(target);\n\n    $array.keepIf(this._targets, function (x) {\n      return x.target !== target;\n    });\n  };\n\n  return Native;\n}();\n\nvar Raf =\n/** @class */\nfunction () {\n  function Raf() {\n    this._targets = [];\n  }\n\n  Raf.prototype.addTarget = function (target, callback) {\n    var _this = this;\n\n    if (this._targets.length === 0) {\n      var lastTime_1 = null;\n\n      var loop_1 = function () {\n        var currentTime = Date.now();\n\n        if (lastTime_1 === null || currentTime > lastTime_1 + Raf.delay) {\n          lastTime_1 = currentTime;\n          $array.each(_this._targets, function (x) {\n            var newSize = x.target.getBoundingClientRect();\n\n            if (newSize.width !== x.size.width || newSize.height !== x.size.height) {\n              x.size = newSize;\n              x.callback();\n            }\n          });\n        }\n\n        _this._timer = requestAnimationFrame(loop_1);\n      };\n\n      this._timer = requestAnimationFrame(loop_1);\n    }\n\n    var size = target.getBoundingClientRect();\n\n    this._targets.push({\n      target: target,\n      callback: callback,\n      size: size\n    });\n  };\n\n  Raf.prototype.removeTarget = function (target) {\n    $array.keepIf(this._targets, function (x) {\n      return x.target !== target;\n    });\n\n    if (this._targets.length === 0) {\n      cancelAnimationFrame(this._timer);\n    }\n  };\n\n  Raf.delay = 200;\n  return Raf;\n}();\n\nvar observer = null;\n\nfunction makeSensor() {\n  if (observer === null) {\n    if (typeof ResizeObserver !== \"undefined\") {\n      observer = new Native();\n    } else {\n      observer = new Raf();\n    }\n  }\n\n  return observer;\n}\n\nvar ResizeSensor =\n/** @class */\nfunction () {\n  function ResizeSensor(element, callback) {\n    this._disposed = false;\n    this._sensor = makeSensor();\n    this._element = element;\n\n    this._sensor.addTarget(element, callback);\n  }\n\n  ResizeSensor.prototype.isDisposed = function () {\n    return this._disposed;\n  };\n\n  ResizeSensor.prototype.dispose = function () {\n    if (!this._disposed) {\n      this._disposed = true;\n\n      this._sensor.removeTarget(this._element);\n    }\n  };\n\n  Object.defineProperty(ResizeSensor.prototype, \"sensor\", {\n    get: function () {\n      return this._sensor;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Deprecated: do not use.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  ResizeSensor.prototype.reset = function () {\n    $log.warn(\"resizeSensor.reset() is no longer needed and can be removed\");\n  };\n\n  return ResizeSensor;\n}();\n\nexport { ResizeSensor };","map":{"version":3,"sources":["../../../../../src/.internal/core/utils/ResizeSensor.ts"],"names":[],"mappings":"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","sourcesContent":["import * as $array from \"./Array\";\nimport * as $log from \"./Log\";\n\n\ninterface Sensor {\n\taddTarget(target: Element, callback: () => void): void;\n\tremoveTarget(target: Element): void;\n}\n\n\ndeclare const ResizeObserver: any;\n\nclass Native implements Sensor {\n\tprivate _observer: any;\n\tprivate _targets: Array<{ target: Element, callback: () => void }> = [];\n\n\tconstructor() {\n\t\tthis._observer = new ResizeObserver((entries: Array<any>) => {\n\t\t\t$array.each(entries, (entry) => {\n\t\t\t\t$array.each(this._targets, (x) => {\n\t\t\t\t\tif (x.target === entry.target) {\n\t\t\t\t\t\tx.callback();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\taddTarget(target: Element, callback: () => void) {\n\t\tthis._observer.observe(target, { box: \"content-box\" });\n\t\tthis._targets.push({ target, callback });\n\t}\n\n\tremoveTarget(target: Element) {\n\t\tthis._observer.unobserve(target);\n\n\t\t$array.keepIf(this._targets, (x) => {\n\t\t\treturn x.target !== target;\n\t\t});\n\t}\n}\n\n\nclass Raf implements Sensor {\n\tpublic static delay: number = 200;\n\n\tprivate _timer: number | undefined;\n\tprivate _targets: Array<{ target: Element, callback: () => void, size: ClientRect | DOMRect }> = [];\n\n\taddTarget(target: Element, callback: () => void) {\n\t\tif (this._targets.length === 0) {\n\t\t\tlet lastTime: number | null = null;\n\n\t\t\tconst loop = () => {\n\t\t\t\tconst currentTime = Date.now();\n\n\t\t\t\tif (lastTime === null || currentTime > (lastTime + Raf.delay)) {\n\t\t\t\t\tlastTime = currentTime;\n\n\t\t\t\t\t$array.each(this._targets, (x) => {\n\t\t\t\t\t\tlet newSize = x.target.getBoundingClientRect();\n\n\t\t\t\t\t\tif (newSize.width !== x.size.width || newSize.height !== x.size.height) {\n\t\t\t\t\t\t\tx.size = newSize;\n\t\t\t\t\t\t\tx.callback();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis._timer = requestAnimationFrame(loop);\n\t\t\t};\n\n\t\t\tthis._timer = requestAnimationFrame(loop);\n\t\t}\n\n\t\tlet size = target.getBoundingClientRect();\n\t\tthis._targets.push({ target, callback, size });\n\t}\n\n\tremoveTarget(target: Element) {\n\t\t$array.keepIf(this._targets, (x) => {\n\t\t\treturn x.target !== target;\n\t\t});\n\n\t\tif (this._targets.length === 0) {\n\t\t\tcancelAnimationFrame(this._timer);\n\t\t}\n\t}\n}\n\n\nlet observer: Sensor | null = null;\n\nfunction makeSensor(): Sensor {\n\tif (observer === null) {\n\t\tif (typeof ResizeObserver !== \"undefined\") {\n\t\t\tobserver = new Native();\n\n\t\t} else {\n\t\t\tobserver = new Raf();\n\t\t}\n\t}\n\n\treturn observer;\n}\n\nexport class ResizeSensor {\n\tprivate _sensor: Sensor;\n\tprivate _element: Element;\n\tprivate _disposed: boolean = false;\n\n\tconstructor(element: Element, callback: () => void) {\n\t\tthis._sensor = makeSensor();\n\t\tthis._element = element;\n\t\tthis._sensor.addTarget(element, callback);\n\t}\n\n\tpublic isDisposed() {\n\t\treturn this._disposed;\n\t}\n\n\tpublic dispose() {\n\t\tif (!this._disposed) {\n\t\t\tthis._disposed = true;\n\t\t\tthis._sensor.removeTarget(this._element);\n\t\t}\n\t}\n\n\tpublic get sensor(): Sensor {\n\t\treturn this._sensor;\n\t}\n\n\t/**\n\t * Deprecated: do not use.\n\t *\n\t * @ignore Exclude from docs\n\t */\n\tpublic reset() {\n\t\t$log.warn(\"resizeSensor.reset() is no longer needed and can be removed\");\n\t}\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}