{"ast":null,"code":"/**\r\n * Provides functionality used to build scrollbars.\r\n */\nimport { __extends } from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\n\nimport { Container } from \"../Container\";\nimport { ResizeButton } from \"../elements/ResizeButton\";\nimport { Button } from \"../elements/Button\";\nimport { getInteraction } from \"../interaction/Interaction\";\nimport { MouseCursorStyle } from \"../interaction/Mouse\";\nimport { RoundedRectangle } from \"../elements/RoundedRectangle\";\nimport { registry } from \"../Registry\";\nimport { keyboard } from \"../utils/Keyboard\";\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\nimport { percent, Percent } from \"../utils/Percent\";\nimport * as $math from \"../utils/Math\";\nimport * as $ease from \"../utils/Ease\";\nimport * as $type from \"../utils/Type\";\nimport * as $utils from \"../utils/Utils\";\n;\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Scrollbar is a generic control allowing to select a range of values or pan\r\n * the selection.\r\n *\r\n * @see {@link IScrollbarEvents} for a list of available events\r\n * @see {@link IScrollbarAdapters} for a list of available Adapters\r\n */\n\nvar Scrollbar =\n/** @class */\nfunction (_super) {\n  __extends(Scrollbar, _super);\n  /**\r\n   * Construtor\r\n   */\n\n\n  function Scrollbar() {\n    var _this = _super.call(this) || this;\n    /**\r\n     * Previously selected lower (start) value.\r\n     */\n\n\n    _this._previousStart = 0;\n    /**\r\n     * Previously selected upper (end) value.\r\n     */\n\n    _this._previousEnd = 1;\n    /**\r\n     * A value of previously selected lower value, used for doubleclick function.\r\n     */\n\n    _this._prevStart = 0;\n    /**\r\n     * A value of previously selected upper value, used for doubleclick function.\r\n     */\n\n    _this._prevEnd = 1;\n    /**\r\n     * Indicates if the Scrollbar is currently \"busy\" (animating and or\r\n     * performing zoom by user interaction).\r\n     */\n\n    _this._isBusy = false;\n    /**\r\n     * [_skipRangeEvents description]\r\n     *\r\n     * @todo Description\r\n     */\n\n    _this._skipRangeEvents = false;\n    /**\r\n     * Update the selection when dragging the grips.\r\n     *\r\n     * If set to `false` selection will be updated only when the grip is\r\n     * released.\r\n     *\r\n     * @default true\r\n     */\n\n    _this.updateWhileMoving = true;\n    _this.className = \"Scrollbar\";\n    _this.minHeight = 12;\n    _this.minWidth = 12;\n    _this.animationDuration = 0;\n    _this.animationEasing = $ease.cubicOut;\n\n    _this.margin(10, 10, 10, 10);\n\n    var interfaceColors = new InterfaceColorSet(); // background is also container as it might contain graphs, grid, etc\n\n    var background = _this.background;\n    background.cornerRadius(10, 10, 10, 10);\n    background.fill = interfaceColors.getFor(\"fill\");\n    background.fillOpacity = 0.5; // Make system tooltips appear by default\n\n    _this.showSystemTooltip = true;\n    _this.startGrip = new ResizeButton();\n    _this.endGrip = new ResizeButton(); // Default orientation...\n    // ... is set in `applyInternalDefaults()` because it accesses `language`\n    // and should only be started to access when parent is set\n    // Set events\n\n    _this.events.on(\"transformed\", _this.updateThumb, _this, false); // Initial positions\n\n\n    _this.start = 0;\n    _this.end = 1; // Set roles\n\n    _this.role = \"scrollbar\";\n    _this.thumb.role = \"slider\";\n    _this.thumb.readerLive = \"polite\";\n    _this.startGrip.role = \"slider\";\n    _this.endGrip.role = \"slider\"; // otherwise range changed wont' be registered\n\n    _this.events.once(\"inited\", function () {\n      _this._previousStart = undefined;\n\n      _this.dispatchRangeChange();\n    }, undefined, false);\n\n    _this.hideGrips = false;\n    _this.orientation = \"horizontal\"; // Min/max values for accessibility\n\n    _this.setSVGAttribute({\n      \"aria-valuemin\": \"0\"\n    });\n\n    _this.setSVGAttribute({\n      \"aria-valuemax\": \"100\"\n    });\n\n    _this.applyTheme();\n\n    return _this;\n  }\n  /**\r\n   * Sets defaults that instantiate some objects that rely on parent, so they\r\n   * cannot be set in constructor.\r\n   */\n\n\n  Scrollbar.prototype.applyInternalDefaults = function () {\n    _super.prototype.applyInternalDefaults.call(this); // Set screen reader tetxt accordingly\n\n\n    if (this.orientation === \"horizontal\") {\n      if (!$type.hasValue(this.readerTitle)) {\n        this.readerTitle = this.language.translate(\"Use TAB to select grip buttons or left and right arrows to change selection\");\n      }\n\n      if (!$type.hasValue(this.thumb.readerDescription)) {\n        this.thumb.readerDescription = this.language.translate(\"Use left and right arrows to move selection\");\n      }\n\n      if (!$type.hasValue(this.startGrip.readerDescription)) {\n        this.startGrip.readerDescription = this.language.translate(\"Use left and right arrows to move left selection\");\n      }\n\n      if (!$type.hasValue(this.endGrip.readerDescription)) {\n        this.endGrip.readerDescription = this.language.translate(\"Use left and right arrows to move right selection\");\n      }\n\n      this.readerOrientation = \"horizontal\";\n    } else {\n      if (!$type.hasValue(this.readerTitle)) {\n        this.readerTitle = this.language.translate(\"Use TAB select grip buttons or up and down arrows to change selection\");\n      }\n\n      if (!$type.hasValue(this.thumb.readerDescription)) {\n        this.thumb.readerDescription = this.language.translate(\"Use up and down arrows to move selection\");\n      }\n\n      if (!$type.hasValue(this.startGrip.readerDescription)) {\n        this.startGrip.readerDescription = this.language.translate(\"Use up and down arrows to move upper selection\");\n      }\n\n      if (!$type.hasValue(this.endGrip.readerDescription)) {\n        this.endGrip.readerDescription = this.language.translate(\"Use up and down arrows to move lower selection\");\n      }\n\n      this.readerOrientation = \"vertical\";\n    }\n\n    this.readerControls = this.baseSprite.uidAttr();\n  };\n  /**\r\n   * Validates the layout of the scrollbar's elements.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.validateLayout = function () {\n    this.updateSize();\n\n    _super.prototype.validateLayout.call(this); // when size changes, need to update extremes\n\n\n    this.updateExtremes();\n  };\n  /**\r\n   * Update background for the scrollbar.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.processBackground = function () {\n    _super.prototype.processBackground.call(this);\n\n    var background = this.background;\n    background.clickable = true;\n    background.events.on(\"hit\", this.handleBgHit, this, undefined);\n  };\n  /**\r\n   * Zooms to the particular place when clicked/tapped on the scrollbar\r\n   * background.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param event  Event\r\n   */\n\n\n  Scrollbar.prototype.handleBgHit = function (event) {\n    this.makeBusy();\n    var point = event.spritePoint;\n    point = $utils.spritePointToSprite(point, this.background, this);\n    var thumb = this.thumb;\n\n    if (this.orientation == \"horizontal\") {\n      var thumbX = point.x - thumb.pixelWidth / 2;\n      thumbX = $math.fitToRange(thumbX, 0, this.innerWidth - thumb.pixelWidth);\n      this._thumbAnimation = thumb.animate({\n        property: \"x\",\n        to: thumbX\n      }, this.animationDuration, this.animationEasing);\n    } else {\n      var thumbY = point.y - thumb.pixelHeight / 2;\n      thumbY = $math.fitToRange(thumbY, 0, this.innerHeight - thumb.pixelHeight);\n      this._thumbAnimation = thumb.animate({\n        property: \"y\",\n        to: thumbY\n      }, this.animationDuration, this.animationEasing);\n    }\n\n    if (this.animationDuration > 0) {\n      this._thumbAnimation.events.on(\"animationended\", this.makeUnbusy, this, false);\n    } else {\n      this._thumb.validate();\n\n      this.makeUnbusy();\n    }\n  };\n  /**\r\n   * Set scrollbar as busy. (currently zooming)\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.makeBusy = function () {\n    this._isBusy = true;\n    this._skipRangeEvents = false;\n\n    if (this._unbusyTimeout) {\n      this.removeDispose(this._unbusyTimeout);\n    }\n\n    this._unbusyTimeout = undefined;\n    this.stopAnimations();\n  };\n  /**\r\n   * Stops all animations, currently playing for the scrollbar.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.stopAnimations = function () {\n    if (this._thumbAnimation) {\n      this._thumbAnimation.stop(true);\n    }\n\n    if (this._zoomAnimation) {\n      this._zoomAnimation.stop(true);\n    }\n  };\n  /**\r\n   * Cancels \"busy\" status of the Scrollbar.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.makeUnbusy = function () {\n    /**\r\n     * We cannot make Scrollbar not busy right after release, because then axes\r\n     * will take over controll and Scrollbar will start to animate.\r\n     * Theorethically, it's not right to set timeout by `animationDuration`,\r\n     * however we can not know all the durations of elements we scroll, so we\r\n     * assume that animation duration will be the same as\r\n     * `interpolationDuration` or `rangeChange` duration.\r\n     */\n    this._unbusyTimeout = this.setTimeout(this.makeUnbusyReal.bind(this), this.animationDuration * 1.1);\n  };\n  /**\r\n   * [makeUnbusyReal description]\r\n   *\r\n   * @todo Description\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.makeUnbusyReal = function () {\n    this._usingGrip = undefined;\n    this._isBusy = false;\n\n    if (!this.updateWhileMoving) {\n      this.dispatchRangeChange();\n    }\n  };\n  /**\r\n   * Disptatches rangechanged event if it really changed\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.dispatchRangeChange = function () {\n    if (this._previousEnd != this.end || this._previousStart != this.start) {\n      this._previousStart = this.start;\n      this._previousEnd = this.end;\n      this.dispatch(\"rangechanged\");\n    }\n  };\n  /**\r\n   * Updates the \"thumb\" element. A draggable element between the grips.\r\n   */\n\n\n  Scrollbar.prototype.updateThumb = function () {\n    if (!this.parent) {\n      return;\n    }\n\n    var thumb = this.thumb;\n    var start = this.start;\n    var end = this.end;\n    var startGrip = this.startGrip;\n    var endGrip = this.endGrip;\n\n    if (this.orientation == \"horizontal\") {\n      var innerWidth_1 = this.innerWidth;\n      thumb.width = innerWidth_1 * (end - start);\n      thumb.maxX = innerWidth_1 - thumb.pixelWidth;\n      thumb.x = start * innerWidth_1;\n      startGrip.moveTo({\n        x: thumb.pixelX,\n        y: 0\n      }, undefined, undefined, true); // overrides dragging\n\n      endGrip.moveTo({\n        x: thumb.pixelX + thumb.pixelWidth,\n        y: 0\n      }, undefined, undefined, true);\n      startGrip.readerTitle = this.language.translate(\"From %1\", undefined, this.adapter.apply(\"positionValue\", {\n        value: Math.round(start * 100) + \"%\",\n        position: start\n      }).value);\n      startGrip.readerValueNow = \"\" + Math.round(start * 100);\n      startGrip.readerValueText = startGrip.readerTitle;\n      endGrip.readerTitle = this.language.translate(\"To %1\", undefined, this.adapter.apply(\"positionValue\", {\n        value: Math.round(end * 100) + \"%\",\n        position: end\n      }).value);\n      endGrip.readerValueNow = \"\" + Math.round(end * 100);\n      endGrip.readerValueText = endGrip.readerTitle;\n    } else {\n      var innerHeight_1 = this.innerHeight;\n      thumb.height = innerHeight_1 * (end - start);\n      thumb.maxY = innerHeight_1 - thumb.pixelHeight;\n      thumb.y = (1 - end) * innerHeight_1;\n      startGrip.moveTo({\n        x: 0,\n        y: thumb.pixelY + thumb.pixelHeight\n      }, undefined, undefined, true);\n      endGrip.moveTo({\n        x: 0,\n        y: thumb.pixelY\n      }, undefined, undefined, true);\n      startGrip.readerTitle = this.language.translate(\"To %1\", undefined, this.adapter.apply(\"positionValue\", {\n        value: Math.round((1 - start) * 100) + \"%\",\n        position: 1 - start\n      }).value);\n      startGrip.readerValueNow = \"\" + Math.round(start * 100);\n      startGrip.readerValueText = startGrip.readerTitle;\n      endGrip.readerTitle = this.language.translate(\"From %1\", undefined, this.adapter.apply(\"positionValue\", {\n        value: Math.round((1 - end) * 100) + \"%\",\n        position: 1 - end\n      }).value);\n      endGrip.readerValueNow = \"\" + Math.round(end * 100);\n      endGrip.readerValueText = endGrip.readerTitle;\n    } // Add accessibility\n\n\n    thumb.readerTitle = this.language.translate(\"From %1 to %2\", undefined, this.adapter.apply(\"positionValue\", {\n      value: Math.round(start * 100) + \"%\",\n      position: start\n    }).value, this.adapter.apply(\"positionValue\", {\n      value: Math.round(end * 100) + \"%\",\n      position: end\n    }).value);\n    thumb.readerValueNow = \"\" + Math.round(start * 100);\n    thumb.readerValueText = thumb.readerTitle;\n    this.readerValueNow = \"\" + Math.round(start * 100);\n    this.readerValueText = thumb.readerTitle;\n\n    if (!this._skipRangeEvents && this.updateWhileMoving) {\n      this.dispatchRangeChange();\n    }\n  };\n  /**\r\n   * Updates extremes of the scrollbar.\r\n   */\n\n\n  Scrollbar.prototype.updateExtremes = function () {\n    var orientation = this.orientation;\n    var minX = 0;\n    var minY = 0;\n    var maxX = 0;\n    var maxY = 0;\n\n    if (orientation == \"horizontal\") {\n      maxX = this.innerWidth;\n      minY = maxY = this.innerHeight / 2;\n    } else {\n      maxY = this.innerHeight;\n      minX = maxX = this.innerWidth / 2;\n    }\n\n    var startGrip = this.startGrip;\n    startGrip.minX = minX;\n    startGrip.maxX = maxX;\n    startGrip.minY = minY;\n    startGrip.maxY = maxY;\n    var endGrip = this.endGrip;\n    endGrip.minX = minX;\n    endGrip.maxX = maxX;\n    endGrip.minY = minY;\n    endGrip.maxY = maxY;\n    var thumb = this.thumb;\n    thumb.minX = minX;\n    thumb.maxX = maxX;\n    thumb.minY = minY;\n    thumb.maxY = maxY;\n  };\n  /**\r\n   * Updates size of the scrollbar.\r\n   */\n\n\n  Scrollbar.prototype.updateSize = function () {\n    var orientation = this.orientation;\n    var startGrip = this.startGrip;\n\n    if (startGrip) {\n      startGrip.orientation = orientation;\n    }\n\n    if (this.endGrip) {\n      this.endGrip.orientation = orientation;\n    }\n\n    var thumb = this.thumb;\n\n    if (thumb) {\n      if (orientation == \"horizontal\") {\n        if (!$type.isNumber(this._pixelWidth)) {\n          if (!(this.width instanceof Percent)) {\n            this.width = percent(100);\n          }\n        } // this teorethically might be wrong, if user indeed sets height of a horizontal scrollbar in percent\n        // however without this height might be equal to 100% if previous orientation was set to horizontal\n        // so this is ok solution, in case user really wants to have scrollbar height set in percent,\n        // he should do this after orientation.\n\n\n        if ($type.hasValue(this.percentHeight)) {\n          this.height = this.minHeight;\n        }\n\n        thumb.height = this.innerHeight;\n        thumb.verticalCenter = \"middle\";\n        thumb.horizontalCenter = \"left\";\n      } else {\n        if (!$type.isNumber(this._pixelHeight)) {\n          if (!(this.height instanceof Percent)) {\n            this.height = percent(100);\n          }\n        } // same as above with percentHeight\n\n\n        if ($type.hasValue(this.percentWidth)) {\n          this.width = this.minWidth;\n        }\n\n        thumb.width = this.innerWidth;\n        thumb.verticalCenter = \"top\";\n        thumb.horizontalCenter = \"middle\";\n      }\n    }\n  };\n\n  Object.defineProperty(Scrollbar.prototype, \"isBusy\", {\n    /**\r\n     * Indicates if the Scrollbar is currently \"busy\" (animating and or\r\n     * performing zoom by user interaction).\r\n     * @return boolean\r\n     */\n    get: function get() {\n      return this._isBusy;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"start\", {\n    /**\r\n     * @return Position (0-1)\r\n     */\n    get: function get() {\n      return Math.min(this.getPosition(this._start), this.getPosition(this._end));\n    },\n\n    /**\r\n     * ==========================================================================\r\n     * POSITIONS\r\n     * ==========================================================================\r\n     * @hidden\r\n     */\n\n    /**\r\n     * Relative position (0-1) of the start grip.\r\n     *\r\n     * @param position  Position (0-1)\r\n     */\n    set: function set(position) {\n      if (!this._isBusy) {\n        this.__start = position;\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"__start\", {\n    /**\r\n     * @return [description]\r\n     */\n    get: function get() {\n      return this._start;\n    },\n\n    /**\r\n     * [__start description]\r\n     *\r\n     * @todo Description\r\n     * @param position [description]\r\n     */\n    set: function set(position) {\n      this._start = this.getPosition(position);\n      this.updateThumb();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"end\", {\n    /**\r\n     * @return Position (0-1)\r\n     */\n    get: function get() {\n      return Math.max(this.getPosition(this._start), this.getPosition(this._end));\n    },\n\n    /**\r\n     * Relative position (0-1) of the end grip.\r\n     *\r\n     * @param position  Position (0-1)\r\n     */\n    set: function set(position) {\n      if (!this._isBusy) {\n        this.__end = position;\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"__end\", {\n    /**\r\n     * @return [description]\r\n     */\n    get: function get() {\n      return this._end;\n    },\n\n    /**\r\n     * [__end description]\r\n     *\r\n     * @todo Description\r\n     * @param position [description]\r\n     */\n    set: function set(position) {\n      this._end = this.getPosition(position);\n      this.updateThumb();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"range\", {\n    /**\r\n     * Current selection range.\r\n     *\r\n     * @readonly\r\n     * @return Range\r\n     */\n    get: function get() {\n      return {\n        start: this.start,\n        end: this.end,\n        priority: this._usingGrip\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Disables range change events.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  Scrollbar.prototype.skipRangeEvents = function () {\n    if (!this._isBusy) {\n      this._skipRangeEvents = true;\n    }\n  };\n  /**\r\n   * [fixRange description]\r\n   *\r\n   * @todo Description\r\n   * @ignore Exclude from docs\r\n   * @param range  Range\r\n   */\n\n\n  Scrollbar.prototype.fixRange = function (range) {\n    if (range.start != $math.round(this._start, 2) || range.end != $math.round(this._end, 2)) {\n      this._start = range.start;\n      this._end = range.end;\n      this._skipRangeEvents = true;\n      this.updateThumb();\n      this._skipRangeEvents = false;\n      this.thumb.validate();\n      this.thumb.background.validate();\n    }\n  };\n  /**\r\n   * [getPosition description]\r\n   *\r\n   * @todo Description\r\n   * @param position  [description]\r\n   * @return [description]\r\n   */\n\n\n  Scrollbar.prototype.getPosition = function (position) {\n    return $math.fitToRange($math.round(position, 4), 0, 1);\n  };\n\n  Object.defineProperty(Scrollbar.prototype, \"orientation\", {\n    /**\r\n     * @return Orientation\r\n     */\n    get: function get() {\n      return this.getPropertyValue(\"orientation\");\n    },\n\n    /**\r\n     * ==========================================================================\r\n     * MISC\r\n     * ==========================================================================\r\n     * @hidden\r\n     */\n\n    /**\r\n     * Orientation of the scrollbar.\r\n     *\r\n     * Available options: \"horizontal\" (default) and \"vertical\".\r\n     *\r\n     * @default \"horizontal\"\r\n     * @param value  Orientation\r\n     */\n    set: function set(value) {\n      if (this.setPropertyValue(\"orientation\", value)) {\n        // Set mouse cursors and screen reader tetxt accordingly\n        if (value === \"horizontal\") {\n          // Mouse styles\n          this.startGrip.cursorOverStyle = MouseCursorStyle.horizontalResize;\n          this.endGrip.cursorOverStyle = MouseCursorStyle.horizontalResize; // Reader text\n\n          /*this.readerTitle = this.language.translate(\"Use TAB to select grip buttons or left and right arrows to change selection\");\r\n          this.thumb.readerDescription = this.language.translate(\"Use left and right arrows to move selection\");\r\n          this.startGrip.readerDescription = this.language.translate(\"Use left and right arrows to move left selection\");\r\n          this.endGrip.readerDescription = this.language.translate(\"Use left and right arrows to move right selection\");*/\n        } else {\n          // Mouse styles\n          this.startGrip.cursorOverStyle = MouseCursorStyle.verticalResize;\n          this.endGrip.cursorOverStyle = MouseCursorStyle.verticalResize; // Reader text\n\n          /*this.readerTitle = this.language.translate(\"Use TAB select grip buttons or up and down arrows to change selection\");\r\n          this.thumb.readerDescription = this.language.translate(\"Use up and down arrows to move selection\");\r\n          this.startGrip.readerDescription = this.language.translate(\"Use up and down arrows to move upper selection\");\r\n          this.endGrip.readerDescription = this.language.translate(\"Use up and down arrows to move lower selection\");*/\n        }\n\n        this.updateByOrientation();\n        this.invalidate();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Scrollbar.prototype.updateByOrientation = function () {};\n\n  Object.defineProperty(Scrollbar.prototype, \"startGrip\", {\n    /**\r\n     * @return Grip element\r\n     */\n    get: function get() {\n      return this._startGrip;\n    },\n\n    /**\r\n     * ==========================================================================\r\n     * GRIPS\r\n     * ==========================================================================\r\n     * @hidden\r\n     */\n\n    /**\r\n     * Start grip element. (button)\r\n     *\r\n     * @param button  Grip element\r\n     */\n    set: function set(button) {\n      if (this._startGrip) {\n        this.removeDispose(this._startGrip);\n      }\n\n      this._startGrip = button;\n      this.processGrip(button);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"endGrip\", {\n    /**\r\n     * @return Grip element\r\n     */\n    get: function get() {\n      return this._endGrip;\n    },\n\n    /**\r\n     * End grip element. (button)\r\n     *\r\n     * @param button  Grip element\r\n     */\n    set: function set(button) {\n      if (this._endGrip) {\n        this.removeDispose(this._endGrip);\n      }\n\n      this._endGrip = button;\n      this.processGrip(button);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Decorates the grip button with properties and events.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param button Grip button\r\n   */\n\n  Scrollbar.prototype.processGrip = function (button) {\n    button.parent = this;\n    button.isMeasured = false;\n    button.focusable = true;\n    button.shouldClone = false; // Set button defaults\n    //button.showSystemTooltip = true; // setting this here is not right because we break inheritance\n\n    button.zIndex = 100;\n    button.events.on(\"drag\", this.handleGripDrag, this, false);\n    button.events.on(\"dragstop\", this.makeUnbusy, this, false);\n    button.events.on(\"down\", this.makeBusy, this, false);\n\n    this._disposers.push(button);\n  };\n  /**\r\n   * Updates positions of related elements after grip element is dragged.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param event  Event\r\n   */\n\n\n  Scrollbar.prototype.handleGripDrag = function (event) {\n    this.makeBusy();\n\n    if (event.target === this._startGrip) {\n      this._usingGrip = \"start\";\n    } else {\n      this._usingGrip = \"end\";\n    }\n\n    if (this.orientation == \"horizontal\") {\n      this._start = this.startGrip.pixelX / this.innerWidth;\n      this._end = this.endGrip.pixelX / this.innerWidth;\n    } else {\n      this._start = 1 - this.startGrip.pixelY / this.innerHeight;\n      this._end = 1 - this.endGrip.pixelY / this.innerHeight;\n    }\n\n    this.updateThumb();\n  };\n\n  Object.defineProperty(Scrollbar.prototype, \"thumb\", {\n    /**\r\n     * @return Thumb element\r\n     */\n    get: function get() {\n      if (!this._thumb) {\n        // Create scrollbar controls (setters will handle adding disposers)\n        var thumb = new Button();\n        thumb.background.cornerRadius(10, 10, 10, 10);\n        thumb.padding(0, 0, 0, 0);\n        this.thumb = thumb;\n      }\n\n      return this._thumb;\n    },\n\n    /**\r\n     * A \"thumb\" element.\r\n     *\r\n     * It's a draggable square space between the grips, that can be used to\r\n     * pan the selection.\r\n     *\r\n     * @param thumb  Thumb element\r\n     */\n    set: function set(thumb) {\n      var _this = this;\n\n      if (thumb) {\n        if (this._thumb) {\n          this.removeDispose(this._thumb);\n        }\n\n        this._thumb = thumb;\n        thumb.parent = this;\n        thumb.isMeasured = false;\n        thumb.inert = true;\n        thumb.draggable = true;\n        thumb.clickable = true;\n        thumb.hoverable = true;\n        thumb.focusable = true;\n        thumb.shouldClone = false;\n        thumb.zIndex = 0; // TODO remove closures ?\n        // Add events\n        // Add cursor styles to thumb\n\n        thumb.cursorOverStyle = MouseCursorStyle.grab;\n        thumb.cursorDownStyle = MouseCursorStyle.grabbing;\n        thumb.events.on(\"dragstart\", this.makeBusy, this, false);\n        thumb.events.on(\"dragstop\", this.makeUnbusy, this, false);\n        thumb.events.on(\"positionchanged\", this.handleThumbPosition, this, false);\n        thumb.events.on(\"sizechanged\", this.handleThumbPosition, this, false);\n        thumb.events.on(\"doublehit\", this.handleDoubleClick, this, false); // Add event for space and ENTER to toggle full zoom out and back\n        // (same as doubleclick)\n\n        this._disposers.push(getInteraction().body.events.on(\"keyup\", function (ev) {\n          if (keyboard.isKey(ev.event, [\"space\", \"enter\"]) && _this.thumb.isFocused) {\n            ev.event.preventDefault();\n\n            _this.handleDoubleClick();\n          }\n        }));\n\n        this._disposers.push(this._thumb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Zooms-in and out the selection on double-click of the thumb.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  Scrollbar.prototype.handleDoubleClick = function () {\n    this.makeBusy();\n    var newStart = 0;\n    var newEnd = 1;\n\n    if (this.start != 0 || this.end != 1) {\n      this._prevStart = this.start;\n      this._prevEnd = this.end;\n    } else {\n      newStart = this._prevStart;\n      newEnd = this._prevEnd;\n    }\n\n    var zoomAnimation = this.animate([{\n      property: \"__start\",\n      to: newStart\n    }, {\n      property: \"__end\",\n      to: newEnd\n    }], this.animationDuration, this.animationEasing);\n\n    if (zoomAnimation && !zoomAnimation.isFinished()) {\n      zoomAnimation.events.on(\"animationended\", this.makeUnbusy, this, false);\n      this._zoomAnimation = zoomAnimation;\n    } else {\n      this.makeUnbusy();\n    }\n  };\n  /**\r\n   * Updates positions of other elements when thumb is moved.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Scrollbar.prototype.handleThumbPosition = function () {\n    var thumb = this.thumb;\n\n    if (this.orientation == \"horizontal\") {\n      var innerWidth_2 = this.innerWidth;\n      var w = thumb.innerWidth;\n      var x = thumb.pixelX;\n      this._start = x / innerWidth_2;\n      this._end = (x + w) / innerWidth_2;\n      this.updateThumb();\n    } else {\n      var innerHeight_2 = this.innerHeight;\n      var h = thumb.innerHeight;\n      var y = thumb.pixelY;\n      this._start = 1 - (y + h) / innerHeight_2;\n      this._end = 1 - y / innerHeight_2;\n      this.updateThumb();\n    }\n  };\n  /**\r\n   * Creates a background element for the scrollbar.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @return Background\r\n   */\n\n\n  Scrollbar.prototype.createBackground = function () {\n    return new RoundedRectangle();\n  };\n\n  Object.defineProperty(Scrollbar.prototype, \"hideGrips\", {\n    /**\r\n     * @return Show only on hover?\r\n     */\n    get: function get() {\n      return this._hideGrips;\n    },\n\n    /**\r\n     * Use this property to set whether grips should be always visible (`false`),\r\n     * or they should just appear on scrollbar hover (`true`).\r\n     *\r\n     * @param value  Show only on hover?\r\n     */\n    set: function set(value) {\n      var _this = this;\n\n      this._hideGrips = value;\n\n      if (this._overDisposer) {\n        this.removeDispose(this._overDisposer);\n      }\n\n      if (this._outDisposer) {\n        this.removeDispose(this._outDisposer);\n      }\n\n      if (value) {\n        this._overDisposer = this.events.on(\"over\", function () {\n          _this.startGrip.show();\n\n          _this.endGrip.show();\n        }, undefined, false);\n        this._outDisposer = this.events.on(\"out\", function () {\n          _this.startGrip.hide();\n\n          _this.endGrip.hide();\n        }, undefined, false);\n        this.startGrip.hide();\n        this.endGrip.hide();\n      } else {\n        this.startGrip.show();\n        this.endGrip.show();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"animationDuration\", {\n    /**\r\n     * @return Orientation\r\n     */\n    get: function get() {\n      return this.getPropertyValue(\"animationDuration\");\n    },\n\n    /**\r\n     * Duration in milliseconds of scrollbar animation (happens when user clicks on a background of a scrollbar)\r\n     * @default 0\r\n     * @param value number\r\n     */\n    set: function set(value) {\n      this.setPropertyValue(\"animationDuration\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scrollbar.prototype, \"animationEasing\", {\n    /**\r\n     * @return {Function}\r\n     */\n    get: function get() {\n      return this.getPropertyValue(\"animationEasing\");\n    },\n\n    /**\r\n     * Animation easing function.\r\n     * @todo: review description and default\r\n     * @default $ease.cubicOut\r\n     * @param value (value: number) => number\r\n     */\n    set: function set(value) {\n      this.setPropertyValue(\"animationEasing\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Adds easing functions to \"function\" fields.\r\n   *\r\n   * @param field  Field name\r\n   * @return Assign as function?\r\n   */\n\n  Scrollbar.prototype.asFunction = function (field) {\n    return field == \"animationEasing\" || _super.prototype.asIs.call(this, field);\n  };\n\n  return Scrollbar;\n}(Container);\n\nexport { Scrollbar };\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\n\nregistry.registeredClasses[\"Scrollbar\"] = Scrollbar;","map":{"version":3,"sources":["../../../../../src/.internal/core/elements/Scrollbar.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Provides functionality used to build scrollbars.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../Container\";\r\nimport { IRange } from \"../defs/IRange\";\r\nimport { Sprite, ISpriteEvents, AMEvent } from \"../Sprite\";\r\nimport { Orientation } from \"../defs/Orientation\";\r\nimport { ResizeButton } from \"../elements/ResizeButton\";\r\nimport { Button } from \"../elements/Button\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { MouseCursorStyle } from \"../interaction/Mouse\";\r\nimport { RoundedRectangle } from \"../elements/RoundedRectangle\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { Animation } from \"../utils/Animation\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { registry } from \"../Registry\";\r\nimport { keyboard } from \"../utils/Keyboard\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport { percent, Percent } from \"../utils/Percent\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $ease from \"../utils/Ease\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $utils from \"../utils/Utils\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Scrollbar]].\r\n */\r\nexport interface IScrollbarProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Duration in milliseconds of Scrollbar animation.\r\n\t *\r\n\t * This affects how fast Scrollbar elements move/resize. For example when\r\n\t * chart zooms or pans, Scrollbar elements' positions need to be adjusted\r\n\t * as well. This setting will affect whether they will be relocated\r\n\t * instantenously (0), or will animte gradually.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tanimationDuration?: number;\r\n\r\n\t/**\r\n\t * An easing function to use when animating (moving/sizing) Scrollbar\r\n\t * elements.\r\n\t */\r\n\tanimationEasing?: (value: number) => number;\r\n\r\n\t/**\r\n\t * Orientation of a scrollbar\r\n\t */\r\n\torientation?: Orientation;\r\n}\r\n\r\n/**\r\n * Defines events for [[Scrollbar]].\r\n */\r\nexport interface IScrollbarEvents extends IContainerEvents {\r\n\r\n\t/**\r\n\t * Invoked when range of scrollbar selection changes.\r\n\t */\r\n\trangechanged: {};\r\n\r\n}\r\n\r\n/**\r\n * Defines adapters for [[Scrollbar]].\r\n */\r\nexport interface IScrollbarAdapters extends IContainerAdapters, IScrollbarProperties {\r\n\r\n\t/**\r\n\t * Applied to a position value when it is retrieved.\r\n\t */\r\n\tpositionValue: {\r\n\t\tvalue: any,\r\n\t\tposition: number\r\n\t}\r\n\r\n};\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Scrollbar is a generic control allowing to select a range of values or pan\r\n * the selection.\r\n *\r\n * @see {@link IScrollbarEvents} for a list of available events\r\n * @see {@link IScrollbarAdapters} for a list of available Adapters\r\n */\r\nexport class Scrollbar extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IScrollbarProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IScrollbarAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IScrollbarEvents;\r\n\r\n\t/**\r\n\t * Holds a reference to a draggable rectangle that fills the space between\r\n\t * two selection grips. It can be used to pan the selection maintaining the\r\n\t * distance between start and end grips.\r\n\t */\r\n\tprotected _thumb: $type.Optional<Button>;\r\n\r\n\t/**\r\n\t * Orientation of the scrollbar.\r\n\t */\r\n\tprotected _orientation: Orientation;\r\n\r\n\t/**\r\n\t * A button (grip) instance to be used to select lower range value.\r\n\t */\r\n\tprotected _startGrip!: ResizeButton;\r\n\r\n\t/**\r\n\t * A button (grip) instance to be used to select upper range value.\r\n\t */\r\n\tprotected _endGrip!: ResizeButton;\r\n\r\n\t/**\r\n\t * Currently selected lower (start) value.\r\n\t */\r\n\tprotected _start!: number;\r\n\r\n\t/**\r\n\t * Currently selected upper (end) value.\r\n\t */\r\n\tprotected _end!: number;\r\n\r\n\t/**\r\n\t * Previously selected lower (start) value.\r\n\t */\r\n\tprotected _previousStart: $type.Optional<number> = 0;\r\n\r\n\t/**\r\n\t * Previously selected upper (end) value.\r\n\t */\r\n\tprotected _previousEnd: $type.Optional<number> = 1;\r\n\r\n\t/**\r\n\t * An [[Animation]] instance that moves \"thumb\".\r\n\t */\r\n\tprotected _thumbAnimation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * An [[Animation]] instance that moves zoom grip buttons.\r\n\t */\r\n\tprotected _zoomAnimation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * A value of previously selected lower value, used for doubleclick function.\r\n\t */\r\n\tprotected _prevStart: number = 0;\r\n\r\n\t/**\r\n\t * A value of previously selected upper value, used for doubleclick function.\r\n\t */\r\n\tprotected _prevEnd: number = 1;\r\n\r\n\t/**\r\n\t * Indicates if the Scrollbar is currently \"busy\" (animating and or\r\n\t * performing zoom by user interaction).\r\n\t */\r\n\tprotected _isBusy: boolean = false;\r\n\r\n\t/**\r\n\t * [_skipRangeEvents description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _skipRangeEvents: boolean = false;\r\n\r\n\t/**\r\n\t * Holds timeout reference that resets \"busy\" status.\r\n\t */\r\n\tprotected _unbusyTimeout: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * [undefined description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _usingGrip: \"start\" | \"end\" | undefined;\r\n\r\n\t/**\r\n\t * Sets the type of the element to use as background.\r\n\t */\r\n\tpublic _background: RoundedRectangle;\r\n\r\n\t/**\r\n\t * Hide grips when not hovered over scrollbar?\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tprotected _hideGrips!: boolean;\r\n\r\n\t/**\r\n\t * A disposer for the hover event.\r\n\t */\r\n\tprotected _overDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * A disposer for the out event.\r\n\t */\r\n\tprotected _outDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * Update the selection when dragging the grips.\r\n\t *\r\n\t * If set to `false` selection will be updated only when the grip is\r\n\t * released.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tpublic updateWhileMoving: boolean = true;\r\n\r\n\t/**\r\n\t * Construtor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"Scrollbar\";\r\n\r\n\t\tthis.minHeight = 12;\r\n\t\tthis.minWidth = 12;\r\n\r\n\t\tthis.animationDuration = 0;\r\n\t\tthis.animationEasing = $ease.cubicOut;\r\n\r\n\t\tthis.margin(10, 10, 10, 10);\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\t// background is also container as it might contain graphs, grid, etc\r\n\t\tlet background: RoundedRectangle = this.background;\r\n\t\tbackground.cornerRadius(10, 10, 10, 10);\r\n\t\tbackground.fill = interfaceColors.getFor(\"fill\");\r\n\t\tbackground.fillOpacity = 0.5;\r\n\r\n\t\t// Make system tooltips appear by default\r\n\t\tthis.showSystemTooltip = true;\r\n\r\n\t\tthis.startGrip = new ResizeButton();\r\n\t\tthis.endGrip = new ResizeButton();\r\n\r\n\t\t// Default orientation...\r\n\t\t// ... is set in `applyInternalDefaults()` because it accesses `language`\r\n\t\t// and should only be started to access when parent is set\r\n\r\n\t\t// Set events\r\n\t\tthis.events.on(\"transformed\", this.updateThumb, this, false);\r\n\r\n\t\t// Initial positions\r\n\t\tthis.start = 0;\r\n\t\tthis.end = 1;\r\n\r\n\t\t// Set roles\r\n\t\tthis.role = \"scrollbar\";\r\n\t\tthis.thumb.role = \"slider\";\r\n\t\tthis.thumb.readerLive = \"polite\";\r\n\t\tthis.startGrip.role = \"slider\";\r\n\t\tthis.endGrip.role = \"slider\";\r\n\r\n\t\t// otherwise range changed wont' be registered\r\n\t\tthis.events.once(\"inited\", () => {\r\n\t\t\tthis._previousStart = undefined;\r\n\t\t\tthis.dispatchRangeChange();\r\n\t\t}, undefined, false)\r\n\r\n\r\n\t\tthis.hideGrips = false;\r\n\r\n\t\tthis.orientation = \"horizontal\";\r\n\r\n\t\t// Min/max values for accessibility\r\n\t\tthis.setSVGAttribute({ \"aria-valuemin\": \"0\" });\r\n\t\tthis.setSVGAttribute({ \"aria-valuemax\": \"100\" });\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets defaults that instantiate some objects that rely on parent, so they\r\n\t * cannot be set in constructor.\r\n\t */\r\n\tprotected applyInternalDefaults(): void {\r\n\t\tsuper.applyInternalDefaults();\r\n\r\n\t\t// Set screen reader tetxt accordingly\r\n\t\tif (this.orientation === \"horizontal\") {\r\n\t\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\t\tthis.readerTitle = this.language.translate(\"Use TAB to select grip buttons or left and right arrows to change selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.thumb.readerDescription)) {\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use left and right arrows to move selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.startGrip.readerDescription)) {\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use left and right arrows to move left selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.endGrip.readerDescription)) {\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use left and right arrows to move right selection\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.readerOrientation = \"horizontal\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\t\tthis.readerTitle = this.language.translate(\"Use TAB select grip buttons or up and down arrows to change selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.thumb.readerDescription)) {\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use up and down arrows to move selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.startGrip.readerDescription)) {\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use up and down arrows to move upper selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.endGrip.readerDescription)) {\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use up and down arrows to move lower selection\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.readerOrientation = \"vertical\";\r\n\t\t}\r\n\r\n\t\tthis.readerControls = this.baseSprite.uidAttr();\r\n\t}\r\n\r\n\t/**\r\n\t * Validates the layout of the scrollbar's elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateLayout(): void {\r\n\t\tthis.updateSize();\r\n\t\tsuper.validateLayout();\r\n\r\n\t\t// when size changes, need to update extremes\r\n\t\tthis.updateExtremes();\r\n\t}\r\n\r\n\t/**\r\n\t * Update background for the scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic processBackground(): void {\r\n\t\tsuper.processBackground();\r\n\t\tlet background = this.background;\r\n\r\n\t\tbackground.clickable = true;\r\n\t\tbackground.events.on(\"hit\", this.handleBgHit, this, undefined);\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms to the particular place when clicked/tapped on the scrollbar\r\n\t * background.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event  Event\r\n\t */\r\n\tpublic handleBgHit(event: ISpriteEvents[\"hit\"]): void {\r\n\t\tthis.makeBusy();\r\n\t\tlet point: IPoint = event.spritePoint;\r\n\t\tpoint = $utils.spritePointToSprite(point, this.background, this);\r\n\t\tlet thumb: Sprite = this.thumb;\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\t\t\tlet thumbX: number = point.x - thumb.pixelWidth / 2;\r\n\t\t\tthumbX = $math.fitToRange(thumbX, 0, this.innerWidth - thumb.pixelWidth);\r\n\t\t\tthis._thumbAnimation = thumb.animate({ property: \"x\", to: thumbX }, this.animationDuration, this.animationEasing);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet thumbY: number = point.y - thumb.pixelHeight / 2;\r\n\t\t\tthumbY = $math.fitToRange(thumbY, 0, this.innerHeight - thumb.pixelHeight);\r\n\t\t\tthis._thumbAnimation = thumb.animate({ property: \"y\", to: thumbY }, this.animationDuration, this.animationEasing);\r\n\t\t}\r\n\t\tif (this.animationDuration > 0) {\r\n\t\t\tthis._thumbAnimation.events.on(\"animationended\", this.makeUnbusy, this, false);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._thumb.validate();\r\n\t\t\tthis.makeUnbusy();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set scrollbar as busy. (currently zooming)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makeBusy(): void {\r\n\t\tthis._isBusy = true;\r\n\t\tthis._skipRangeEvents = false;\r\n\t\tif (this._unbusyTimeout) {\r\n\t\t\tthis.removeDispose(this._unbusyTimeout);\r\n\t\t}\r\n\t\tthis._unbusyTimeout = undefined;\r\n\t\tthis.stopAnimations();\r\n\t}\r\n\r\n\t/**\r\n\t * Stops all animations, currently playing for the scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic stopAnimations(): void {\r\n\t\tif (this._thumbAnimation) {\r\n\t\t\tthis._thumbAnimation.stop(true);\r\n\t\t}\r\n\t\tif (this._zoomAnimation) {\r\n\t\t\tthis._zoomAnimation.stop(true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cancels \"busy\" status of the Scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makeUnbusy(): void {\r\n\t\t/**\r\n\t\t * We cannot make Scrollbar not busy right after release, because then axes\r\n\t\t * will take over controll and Scrollbar will start to animate.\r\n\t\t * Theorethically, it's not right to set timeout by `animationDuration`,\r\n\t\t * however we can not know all the durations of elements we scroll, so we\r\n\t\t * assume that animation duration will be the same as\r\n\t\t * `interpolationDuration` or `rangeChange` duration.\r\n\t\t */\r\n\t\tthis._unbusyTimeout = this.setTimeout(this.makeUnbusyReal.bind(this), this.animationDuration * 1.1);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * [makeUnbusyReal description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makeUnbusyReal(): void {\r\n\t\tthis._usingGrip = undefined;\r\n\t\tthis._isBusy = false;\r\n\t\tif (!this.updateWhileMoving) {\r\n\t\t\tthis.dispatchRangeChange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disptatches rangechanged event if it really changed\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected dispatchRangeChange() {\r\n\t\tif (this._previousEnd != this.end || this._previousStart != this.start) {\r\n\t\t\tthis._previousStart = this.start;\r\n\t\t\tthis._previousEnd = this.end;\r\n\t\t\tthis.dispatch(\"rangechanged\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Updates the \"thumb\" element. A draggable element between the grips.\r\n\t */\r\n\tprotected updateThumb(): void {\r\n\r\n\t\tif (!this.parent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet thumb: Sprite = this.thumb;\r\n\r\n\t\tlet start: number = this.start;\r\n\t\tlet end: number = this.end;\r\n\r\n\t\tlet startGrip: ResizeButton = this.startGrip;\r\n\t\tlet endGrip: ResizeButton = this.endGrip;\r\n\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\r\n\t\t\tlet innerWidth: number = this.innerWidth;\r\n\r\n\t\t\tthumb.width = innerWidth * (end - start);\r\n\t\t\tthumb.maxX = innerWidth - thumb.pixelWidth;\r\n\t\t\tthumb.x = start * innerWidth;\r\n\r\n\t\t\tstartGrip.moveTo({ x: thumb.pixelX, y: 0 }, undefined, undefined, true); // overrides dragging\r\n\t\t\tendGrip.moveTo({ x: thumb.pixelX + thumb.pixelWidth, y: 0 }, undefined, undefined, true);\r\n\r\n\t\t\tstartGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"From %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round(start * 100) + \"%\",\r\n\t\t\t\t\tposition: start\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tstartGrip.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\t\tstartGrip.readerValueText = startGrip.readerTitle;\r\n\r\n\t\t\tendGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"To %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round(end * 100) + \"%\",\r\n\t\t\t\t\tposition: end\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tendGrip.readerValueNow = \"\" + Math.round(end * 100);\r\n\t\t\tendGrip.readerValueText = endGrip.readerTitle;\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet innerHeight: number = this.innerHeight;\r\n\r\n\t\t\tthumb.height = innerHeight * (end - start);\r\n\t\t\tthumb.maxY = innerHeight - thumb.pixelHeight;\r\n\t\t\tthumb.y = (1 - end) * innerHeight;\r\n\r\n\t\t\tstartGrip.moveTo({ x: 0, y: thumb.pixelY + thumb.pixelHeight }, undefined, undefined, true);\r\n\t\t\tendGrip.moveTo({ x: 0, y: thumb.pixelY }, undefined, undefined, true);\r\n\r\n\t\t\tstartGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"To %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round((1 - start) * 100) + \"%\",\r\n\t\t\t\t\tposition: (1 - start)\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tstartGrip.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\t\tstartGrip.readerValueText = startGrip.readerTitle;\r\n\r\n\t\t\tendGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"From %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round((1 - end) * 100) + \"%\",\r\n\t\t\t\t\tposition: (1 - end)\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tendGrip.readerValueNow = \"\" + Math.round(end * 100);\r\n\t\t\tendGrip.readerValueText = endGrip.readerTitle;\r\n\t\t}\r\n\r\n\t\t// Add accessibility\r\n\t\tthumb.readerTitle = this.language.translate(\r\n\t\t\t\"From %1 to %2\",\r\n\t\t\tundefined,\r\n\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\tvalue: Math.round(start * 100) + \"%\",\r\n\t\t\t\tposition: start\r\n\t\t\t}).value,\r\n\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\tvalue: Math.round(end * 100) + \"%\",\r\n\t\t\t\tposition: end\r\n\t\t\t}).value\r\n\t\t);\r\n\r\n\t\tthumb.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\tthumb.readerValueText = thumb.readerTitle;\r\n\r\n\t\tthis.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\tthis.readerValueText = thumb.readerTitle;\r\n\r\n\t\tif (!this._skipRangeEvents && this.updateWhileMoving) {\r\n\t\t\tthis.dispatchRangeChange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates extremes of the scrollbar.\r\n\t */\r\n\tprotected updateExtremes(): void {\r\n\t\tlet orientation = this.orientation;\r\n\t\tlet minX: number = 0;\r\n\t\tlet minY: number = 0;\r\n\t\tlet maxX: number = 0;\r\n\t\tlet maxY: number = 0;\r\n\r\n\t\tif (orientation == \"horizontal\") {\r\n\t\t\tmaxX = this.innerWidth;\r\n\t\t\tminY = maxY = this.innerHeight / 2;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmaxY = this.innerHeight;\r\n\t\t\tminX = maxX = this.innerWidth / 2;\r\n\t\t}\r\n\r\n\t\tlet startGrip: ResizeButton = this.startGrip;\r\n\t\tstartGrip.minX = minX;\r\n\t\tstartGrip.maxX = maxX;\r\n\t\tstartGrip.minY = minY;\r\n\t\tstartGrip.maxY = maxY;\r\n\r\n\t\tlet endGrip: ResizeButton = this.endGrip;\r\n\t\tendGrip.minX = minX;\r\n\t\tendGrip.maxX = maxX;\r\n\t\tendGrip.minY = minY;\r\n\t\tendGrip.maxY = maxY;\r\n\r\n\t\tlet thumb = this.thumb;\r\n\t\tthumb.minX = minX;\r\n\t\tthumb.maxX = maxX;\r\n\t\tthumb.minY = minY;\r\n\t\tthumb.maxY = maxY;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates size of the scrollbar.\r\n\t */\r\n\tprotected updateSize(): void {\r\n\t\tlet orientation = this.orientation;\r\n\r\n\t\tlet startGrip = this.startGrip;\r\n\t\tif (startGrip) {\r\n\t\t\tstartGrip.orientation = orientation;\r\n\t\t}\r\n\t\tif (this.endGrip) {\r\n\t\t\tthis.endGrip.orientation = orientation;\r\n\t\t}\r\n\r\n\t\tlet thumb: Sprite = this.thumb;\r\n\t\tif (thumb) {\r\n\t\t\tif (orientation == \"horizontal\") {\r\n\t\t\t\tif (!$type.isNumber(this._pixelWidth)) {\r\n\t\t\t\t\tif (!(this.width instanceof Percent)) {\r\n\t\t\t\t\t\tthis.width = percent(100);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// this teorethically might be wrong, if user indeed sets height of a horizontal scrollbar in percent\r\n\t\t\t\t// however without this height might be equal to 100% if previous orientation was set to horizontal\r\n\t\t\t\t// so this is ok solution, in case user really wants to have scrollbar height set in percent,\r\n\t\t\t\t// he should do this after orientation.\r\n\t\t\t\tif ($type.hasValue(this.percentHeight)) {\r\n\t\t\t\t\tthis.height = this.minHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthumb.height = this.innerHeight;\r\n\r\n\t\t\t\tthumb.verticalCenter = \"middle\";\r\n\t\t\t\tthumb.horizontalCenter = \"left\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!$type.isNumber(this._pixelHeight)) {\r\n\t\t\t\t\tif (!(this.height instanceof Percent)) {\r\n\t\t\t\t\t\tthis.height = percent(100);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// same as above with percentHeight\r\n\t\t\t\tif ($type.hasValue(this.percentWidth)) {\r\n\t\t\t\t\tthis.width = this.minWidth;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthumb.width = this.innerWidth;\r\n\t\t\t\tthumb.verticalCenter = \"top\";\r\n\t\t\t\tthumb.horizontalCenter = \"middle\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if the Scrollbar is currently \"busy\" (animating and or\r\n\t * performing zoom by user interaction).\r\n\t * @return boolean\r\n\t */\r\n\tpublic get isBusy():boolean{\r\n\t\treturn this._isBusy;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * POSITIONS\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Relative position (0-1) of the start grip.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t */\r\n\tpublic set start(position: number) {\r\n\t\tif (!this._isBusy) {\r\n\t\t\tthis.__start = position;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Position (0-1)\r\n\t */\r\n\tpublic get start(): number {\r\n\t\treturn Math.min(this.getPosition(this._start), this.getPosition(this._end));\r\n\t}\r\n\r\n\t/**\r\n\t * [__start description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param position [description]\r\n\t */\r\n\tprotected set __start(position: number) {\r\n\t\tthis._start = this.getPosition(position);\r\n\t\tthis.updateThumb();\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tprotected get __start(): number {\r\n\t\treturn this._start;\r\n\t}\r\n\r\n\t/**\r\n\t * Relative position (0-1) of the end grip.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t */\r\n\tpublic set end(position: number) {\r\n\t\tif (!this._isBusy) {\r\n\t\t\tthis.__end = position;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Position (0-1)\r\n\t */\r\n\tpublic get end(): number {\r\n\t\treturn Math.max(this.getPosition(this._start), this.getPosition(this._end));\r\n\t}\r\n\r\n\t/**\r\n\t * [__end description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param position [description]\r\n\t */\r\n\tprotected set __end(position: number) {\r\n\t\tthis._end = this.getPosition(position);\r\n\t\tthis.updateThumb();\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tprotected get __end(): number {\r\n\t\treturn this._end;\r\n\t}\r\n\r\n\t/**\r\n\t * Current selection range.\r\n\t *\r\n\t * @readonly\r\n\t * @return Range\r\n\t */\r\n\tpublic get range(): IRange {\r\n\t\treturn { start: this.start, end: this.end, priority: this._usingGrip };\r\n\t}\r\n\r\n\t/**\r\n\t * Disables range change events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic skipRangeEvents(): void {\r\n\t\tif (!this._isBusy) {\r\n\t\t\tthis._skipRangeEvents = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [fixRange description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t * @param range  Range\r\n\t */\r\n\tpublic fixRange(range: IRange): void {\r\n\t\tif (range.start != $math.round(this._start, 2) || range.end != $math.round(this._end, 2)) {\r\n\t\t\tthis._start = range.start;\r\n\t\t\tthis._end = range.end;\r\n\r\n\t\t\tthis._skipRangeEvents = true;\r\n\t\t\tthis.updateThumb();\r\n\t\t\tthis._skipRangeEvents = false;\r\n\t\t\tthis.thumb.validate();\r\n\t\t\tthis.thumb.background.validate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [getPosition description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param position  [description]\r\n\t * @return [description]\r\n\t */\r\n\tprotected getPosition(position: number): number {\r\n\t\treturn $math.fitToRange($math.round(position, 4), 0, 1);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * MISC\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Orientation of the scrollbar.\r\n\t *\r\n\t * Available options: \"horizontal\" (default) and \"vertical\".\r\n\t *\r\n\t * @default \"horizontal\"\r\n\t * @param value  Orientation\r\n\t */\r\n\tpublic set orientation(value: Orientation) {\r\n\r\n\t\tif (this.setPropertyValue(\"orientation\", value)) {\r\n\r\n\t\t\t// Set mouse cursors and screen reader tetxt accordingly\r\n\t\t\tif (value === \"horizontal\") {\r\n\r\n\t\t\t\t// Mouse styles\r\n\t\t\t\tthis.startGrip.cursorOverStyle = MouseCursorStyle.horizontalResize;\r\n\t\t\t\tthis.endGrip.cursorOverStyle = MouseCursorStyle.horizontalResize;\r\n\r\n\t\t\t\t// Reader text\r\n\t\t\t\t/*this.readerTitle = this.language.translate(\"Use TAB to select grip buttons or left and right arrows to change selection\");\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use left and right arrows to move selection\");\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use left and right arrows to move left selection\");\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use left and right arrows to move right selection\");*/\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Mouse styles\r\n\t\t\t\tthis.startGrip.cursorOverStyle = MouseCursorStyle.verticalResize;\r\n\t\t\t\tthis.endGrip.cursorOverStyle = MouseCursorStyle.verticalResize;\r\n\r\n\t\t\t\t// Reader text\r\n\t\t\t\t/*this.readerTitle = this.language.translate(\"Use TAB select grip buttons or up and down arrows to change selection\");\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use up and down arrows to move selection\");\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use up and down arrows to move upper selection\");\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use up and down arrows to move lower selection\");*/\r\n\r\n\t\t\t}\r\n\t\t\tthis.updateByOrientation();\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected updateByOrientation() {\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get orientation(): Orientation {\r\n\t\treturn this.getPropertyValue(\"orientation\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * GRIPS\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Start grip element. (button)\r\n\t *\r\n\t * @param button  Grip element\r\n\t */\r\n\tpublic set startGrip(button: ResizeButton) {\r\n\t\tif (this._startGrip) {\r\n\t\t\tthis.removeDispose(this._startGrip);\r\n\t\t}\r\n\t\tthis._startGrip = button;\r\n\t\tthis.processGrip(button);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Grip element\r\n\t */\r\n\tpublic get startGrip(): ResizeButton {\r\n\t\treturn this._startGrip;\r\n\t}\r\n\r\n\t/**\r\n\t * End grip element. (button)\r\n\t *\r\n\t * @param button  Grip element\r\n\t */\r\n\tpublic set endGrip(button: ResizeButton) {\r\n\t\tif (this._endGrip) {\r\n\t\t\tthis.removeDispose(this._endGrip);\r\n\t\t}\r\n\t\tthis._endGrip = button;\r\n\t\tthis.processGrip(button);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Grip element\r\n\t */\r\n\tpublic get endGrip(): ResizeButton {\r\n\t\treturn this._endGrip;\r\n\t}\r\n\r\n\t/**\r\n\t * Decorates the grip button with properties and events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param button Grip button\r\n\t */\r\n\tpublic processGrip(button: ResizeButton) {\r\n\t\tbutton.parent = this;\r\n\t\tbutton.isMeasured = false;\r\n\t\tbutton.focusable = true;\r\n\t\tbutton.shouldClone = false;\r\n\r\n\t\t// Set button defaults\r\n\t\t//button.showSystemTooltip = true; // setting this here is not right because we break inheritance\r\n\t\tbutton.zIndex = 100;\r\n\r\n\t\tbutton.events.on(\"drag\", this.handleGripDrag, this, false);\r\n\t\tbutton.events.on(\"dragstop\", this.makeUnbusy, this, false);\r\n\t\tbutton.events.on(\"down\", this.makeBusy, this, false);\r\n\r\n\t\tthis._disposers.push(button);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates positions of related elements after grip element is dragged.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event  Event\r\n\t */\r\n\tpublic handleGripDrag(event: AMEvent<ResizeButton, ISpriteEvents>[\"drag\"]): void {\r\n\t\tthis.makeBusy();\r\n\r\n\t\tif (event.target === this._startGrip) {\r\n\t\t\tthis._usingGrip = \"start\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._usingGrip = \"end\";\r\n\t\t}\r\n\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\t\t\tthis._start = this.startGrip.pixelX / this.innerWidth;\r\n\t\t\tthis._end = this.endGrip.pixelX / this.innerWidth;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._start = 1 - this.startGrip.pixelY / this.innerHeight;\r\n\t\t\tthis._end = 1 - this.endGrip.pixelY / this.innerHeight;\r\n\t\t}\r\n\r\n\t\tthis.updateThumb();\r\n\t}\r\n\r\n\t/**\r\n\t * A \"thumb\" element.\r\n\t *\r\n\t * It's a draggable square space between the grips, that can be used to\r\n\t * pan the selection.\r\n\t *\r\n\t * @param thumb  Thumb element\r\n\t */\r\n\tpublic set thumb(thumb: Button) {\r\n\t\tif (thumb) {\r\n\r\n\t\t\tif (this._thumb) {\r\n\t\t\t\tthis.removeDispose(this._thumb);\r\n\t\t\t}\r\n\r\n\t\t\tthis._thumb = thumb;\r\n\t\t\tthumb.parent = this;\r\n\t\t\tthumb.isMeasured = false;\r\n\t\t\tthumb.inert = true;\r\n\t\t\tthumb.draggable = true;\r\n\t\t\tthumb.clickable = true;\r\n\t\t\tthumb.hoverable = true;\r\n\t\t\tthumb.focusable = true;\r\n\t\t\tthumb.shouldClone = false;\r\n\t\t\tthumb.zIndex = 0;\r\n\r\n\t\t\t// TODO remove closures ?\r\n\t\t\t// Add events\r\n\r\n\t\t\t// Add cursor styles to thumb\r\n\t\t\tthumb.cursorOverStyle = MouseCursorStyle.grab;\r\n\t\t\tthumb.cursorDownStyle = MouseCursorStyle.grabbing;\r\n\r\n\t\t\tthumb.events.on(\"dragstart\", this.makeBusy, this, false);\r\n\t\t\tthumb.events.on(\"dragstop\", this.makeUnbusy, this, false);\r\n\t\t\tthumb.events.on(\"positionchanged\", this.handleThumbPosition, this, false);\r\n\t\t\tthumb.events.on(\"sizechanged\", this.handleThumbPosition, this, false);\r\n\t\t\tthumb.events.on(\"doublehit\", this.handleDoubleClick, this, false);\r\n\r\n\t\t\t// Add event for space and ENTER to toggle full zoom out and back\r\n\t\t\t// (same as doubleclick)\r\n\t\t\tthis._disposers.push(getInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\t\tif (keyboard.isKey(ev.event, [\"space\", \"enter\"]) && this.thumb.isFocused) {\r\n\t\t\t\t\tev.event.preventDefault();\r\n\t\t\t\t\tthis.handleDoubleClick();\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\r\n\t\t\tthis._disposers.push(this._thumb);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Thumb element\r\n\t */\r\n\tpublic get thumb(): Button {\r\n\t\tif (!this._thumb) {\r\n\t\t\t// Create scrollbar controls (setters will handle adding disposers)\r\n\t\t\tlet thumb = new Button();\r\n\t\t\tthumb.background.cornerRadius(10, 10, 10, 10);\r\n\t\t\tthumb.padding(0, 0, 0, 0);\r\n\t\t\tthis.thumb = thumb;\r\n\t\t}\r\n\t\treturn this._thumb;\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms-in and out the selection on double-click of the thumb.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDoubleClick(): void {\r\n\r\n\t\tthis.makeBusy();\r\n\r\n\t\tlet newStart: number = 0;\r\n\t\tlet newEnd: number = 1;\r\n\r\n\t\tif (this.start != 0 || this.end != 1) {\r\n\t\t\tthis._prevStart = this.start;\r\n\t\t\tthis._prevEnd = this.end;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnewStart = this._prevStart;\r\n\t\t\tnewEnd = this._prevEnd;\r\n\t\t}\r\n\r\n\t\tlet zoomAnimation = this.animate([{ property: \"__start\", to: newStart }, { property: \"__end\", to: newEnd }], this.animationDuration, this.animationEasing);\r\n\r\n\t\tif (zoomAnimation && !zoomAnimation.isFinished()) {\r\n\t\t\tzoomAnimation.events.on(\"animationended\", this.makeUnbusy, this, false);\r\n\t\t\tthis._zoomAnimation = zoomAnimation;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.makeUnbusy();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates positions of other elements when thumb is moved.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleThumbPosition(): void {\r\n\t\tlet thumb = this.thumb;\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\t\t\tlet innerWidth = this.innerWidth;\r\n\t\t\tlet w = thumb.innerWidth;\r\n\t\t\tlet x = thumb.pixelX;\r\n\r\n\t\t\tthis._start = x / innerWidth;\r\n\t\t\tthis._end = (x + w) / innerWidth;\r\n\t\t\tthis.updateThumb();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet innerHeight = this.innerHeight;\r\n\t\t\tlet h = thumb.innerHeight;\r\n\t\t\tlet y = thumb.pixelY;\r\n\r\n\t\t\tthis._start = 1 - (y + h) / innerHeight;\r\n\t\t\tthis._end = 1 - y / innerHeight;\r\n\t\t\tthis.updateThumb();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a background element for the scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Background\r\n\t */\r\n\tpublic createBackground(): this[\"_background\"] {\r\n\t\treturn new RoundedRectangle();\r\n\t}\r\n\r\n\t/**\r\n\t * Use this property to set whether grips should be always visible (`false`),\r\n\t * or they should just appear on scrollbar hover (`true`).\r\n\t *\r\n\t * @param value  Show only on hover?\r\n\t */\r\n\tpublic set hideGrips(value: boolean) {\r\n\r\n\t\tthis._hideGrips = value;\r\n\r\n\t\tif (this._overDisposer) {\r\n\t\t\tthis.removeDispose(this._overDisposer);\r\n\t\t}\r\n\t\tif (this._outDisposer) {\r\n\t\t\tthis.removeDispose(this._outDisposer);\r\n\t\t}\r\n\r\n\t\tif (value) {\r\n\t\t\tthis._overDisposer = this.events.on(\"over\", () => {\r\n\t\t\t\tthis.startGrip.show();\r\n\t\t\t\tthis.endGrip.show();\r\n\t\t\t}, undefined, false)\r\n\t\t\tthis._outDisposer = this.events.on(\"out\", () => {\r\n\t\t\t\tthis.startGrip.hide();\r\n\t\t\t\tthis.endGrip.hide();\r\n\t\t\t}, undefined, false)\r\n\t\t\tthis.startGrip.hide();\r\n\t\t\tthis.endGrip.hide();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.startGrip.show();\r\n\t\t\tthis.endGrip.show();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show only on hover?\r\n\t */\r\n\tpublic get hideGrips(): boolean {\r\n\t\treturn this._hideGrips;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Duration in milliseconds of scrollbar animation (happens when user clicks on a background of a scrollbar)\r\n\t * @default 0\r\n\t * @param value number\r\n\t */\r\n\tpublic set animationDuration(value: number) {\r\n\t\tthis.setPropertyValue(\"animationDuration\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get animationDuration(): number {\r\n\t\treturn this.getPropertyValue(\"animationDuration\");\r\n\t}\r\n\r\n\t/**\r\n\t * Animation easing function.\r\n\t * @todo: review description and default\r\n\t * @default $ease.cubicOut\r\n\t * @param value (value: number) => number\r\n\t */\r\n\tpublic set animationEasing(value: (value: number) => number) {\r\n\t\tthis.setPropertyValue(\"animationEasing\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return {Function}\r\n\t */\r\n\tpublic get animationEasing(): (value: number) => number {\r\n\t\treturn this.getPropertyValue(\"animationEasing\");\r\n\t}\r\n\r\n\t/**\r\n\t * Adds easing functions to \"function\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn field == \"animationEasing\" || super.asIs(field);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Scrollbar\"] = Scrollbar;\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}