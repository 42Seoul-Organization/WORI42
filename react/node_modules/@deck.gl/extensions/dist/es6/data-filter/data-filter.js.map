{"version":3,"sources":["../../../src/data-filter/data-filter.js"],"names":["LayerExtension","shaderModule","shaderModule64","defaultProps","getFilterValue","type","value","filterEnabled","filterRange","filterSoftRange","filterTransformSize","filterTransformColor","DATA_TYPE_FROM_SIZE","DataFilterExtension","constructor","filterSize","fp64","Error","getShaders","extension","opts","modules","defines","DATAFILTER_TYPE","DATAFILTER_DOUBLE","Boolean","initializeState","context","attributeManager","getAttributeManager","add","filterValues","size","accessor","shaderAttributes","divisor","instanceFilterValues","extensionName"],"mappings":"AAoBA,SAAQA,cAAR,QAA6B,eAA7B;AACA,SAAQC,YAAR,EAAsBC,cAAtB,QAA2C,iBAA3C;AAGA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,cAAc,EAAE;AAACC,IAAAA,IAAI,EAAE,UAAP;AAAmBC,IAAAA,KAAK,EAAE;AAA1B,GADG;AAGnBC,EAAAA,aAAa,EAAE,IAHI;AAInBC,EAAAA,WAAW,EAAE,CAAC,CAAC,CAAF,EAAK,CAAL,CAJM;AAKnBC,EAAAA,eAAe,EAAE,IALE;AAMnBC,EAAAA,mBAAmB,EAAE,IANF;AAOnBC,EAAAA,oBAAoB,EAAE;AAPH,CAArB;AAUA,MAAMC,mBAAmB,GAAG;AAC1B,KAAG,OADuB;AAE1B,KAAG,MAFuB;AAG1B,KAAG,MAHuB;AAI1B,KAAG;AAJuB,CAA5B;AAOA,eAAe,MAAMC,mBAAN,SAAkCb,cAAlC,CAAiD;AAC9Dc,EAAAA,WAAW,CAAC;AAACC,IAAAA,UAAU,GAAG,CAAd;AAAiBC,IAAAA,IAAI,GAAG;AAAxB,MAAiC,EAAlC,EAAsC;AAC/C,QAAI,CAACJ,mBAAmB,CAACG,UAAD,CAAxB,EAAsC;AACpC,YAAM,IAAIE,KAAJ,CAAU,yBAAV,CAAN;AACD;;AAED,UAAM;AAACF,MAAAA,UAAD;AAAaC,MAAAA;AAAb,KAAN;AACD;;AAEDE,EAAAA,UAAU,CAACC,SAAD,EAAY;AACpB,UAAM;AAACJ,MAAAA,UAAD;AAAaC,MAAAA;AAAb,QAAqBG,SAAS,CAACC,IAArC;AAEA,WAAO;AACLC,MAAAA,OAAO,EAAE,CAACL,IAAI,GAAGd,cAAH,GAAoBD,YAAzB,CADJ;AAELqB,MAAAA,OAAO,EAAE;AACPC,QAAAA,eAAe,EAAEX,mBAAmB,CAACG,UAAD,CAD7B;AAEPS,QAAAA,iBAAiB,EAAEC,OAAO,CAACT,IAAD;AAFnB;AAFJ,KAAP;AAOD;;AAEDU,EAAAA,eAAe,CAACC,OAAD,EAAUR,SAAV,EAAqB;AAClC,UAAMS,gBAAgB,GAAG,KAAKC,mBAAL,EAAzB;;AACA,QAAID,gBAAJ,EAAsB;AACpBA,MAAAA,gBAAgB,CAACE,GAAjB,CAAqB;AACnBC,QAAAA,YAAY,EAAE;AACZC,UAAAA,IAAI,EAAEb,SAAS,CAACC,IAAV,CAAeL,UADT;AAEZV,UAAAA,IAAI,EAAEc,SAAS,CAACC,IAAV,CAAeJ,IAAf,cAFM;AAGZiB,UAAAA,QAAQ,EAAE,gBAHE;AAIZC,UAAAA,gBAAgB,EAAE;AAChBH,YAAAA,YAAY,EAAE;AACZI,cAAAA,OAAO,EAAE;AADG,aADE;AAIhBC,YAAAA,oBAAoB,EAAE;AACpBD,cAAAA,OAAO,EAAE;AADW;AAJN;AAJN;AADK,OAArB;AAeD;AACF;;AAxC6D;AA2ChEtB,mBAAmB,CAACwB,aAApB,GAAoC,qBAApC;AACAxB,mBAAmB,CAACV,YAApB,GAAmCA,YAAnC","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {LayerExtension} from '@deck.gl/core';\nimport {shaderModule, shaderModule64} from './shader-module';\nimport GL from '@luma.gl/constants';\n\nconst defaultProps = {\n  getFilterValue: {type: 'accessor', value: 0},\n\n  filterEnabled: true,\n  filterRange: [-1, 1],\n  filterSoftRange: null,\n  filterTransformSize: true,\n  filterTransformColor: true\n};\n\nconst DATA_TYPE_FROM_SIZE = {\n  1: 'float',\n  2: 'vec2',\n  3: 'vec3',\n  4: 'vec4'\n};\n\nexport default class DataFilterExtension extends LayerExtension {\n  constructor({filterSize = 1, fp64 = false} = {}) {\n    if (!DATA_TYPE_FROM_SIZE[filterSize]) {\n      throw new Error('filterSize out of range');\n    }\n\n    super({filterSize, fp64});\n  }\n\n  getShaders(extension) {\n    const {filterSize, fp64} = extension.opts;\n\n    return {\n      modules: [fp64 ? shaderModule64 : shaderModule],\n      defines: {\n        DATAFILTER_TYPE: DATA_TYPE_FROM_SIZE[filterSize],\n        DATAFILTER_DOUBLE: Boolean(fp64)\n      }\n    };\n  }\n\n  initializeState(context, extension) {\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      attributeManager.add({\n        filterValues: {\n          size: extension.opts.filterSize,\n          type: extension.opts.fp64 ? GL.DOUBLE : GL.FLOAT,\n          accessor: 'getFilterValue',\n          shaderAttributes: {\n            filterValues: {\n              divisor: 0\n            },\n            instanceFilterValues: {\n              divisor: 1\n            }\n          }\n        }\n      });\n    }\n  }\n}\n\nDataFilterExtension.extensionName = 'DataFilterExtension';\nDataFilterExtension.defaultProps = defaultProps;\n"],"file":"data-filter.js"}