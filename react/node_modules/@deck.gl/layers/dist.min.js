!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("deck"),require("luma")):"function"==typeof define&&define.amd?define(["deck","luma"],t):"object"==typeof exports?exports.deck=t(require("deck"),require("luma")):e.deck=t(e.deck,e.luma)}(window,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=31)}([function(e,t,n){e.exports=n(36)},function(t,n){t.exports=e},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(34);function i(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},i(t,n,o||t)}e.exports=i},function(e,n){e.exports=t},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(32),i=n(33);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},function(e,t,n){var r=n(35);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},,function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(16);function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function o(e,t,n){return(o=i()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&Object(r.a)(o,n.prototype),o}).apply(null,arguments)}},function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t,n){n=n||2;var r,s,l,c,u,d,h,v=t&&t.length,y=v?t[0]*n:e.length,m=i(e,0,y,n,!0),x=[];if(!m||m.next===m.prev)return x;if(v&&(m=function(e,t,n,r){var a,s,l,c,u,d=[];for(a=0,s=t.length;a<s;a++)l=t[a]*r,c=a<s-1?t[a+1]*r:e.length,(u=i(e,l,c,r,!1))===u.next&&(u.steiner=!0),d.push(g(u));for(d.sort(f),a=0;a<d.length;a++)p(d[a],n),n=o(n,n.next);return n}(e,t,m,n)),e.length>80*n){r=l=e[0],s=c=e[1];for(var b=n;b<y;b+=n)(u=e[b])<r&&(r=u),(d=e[b+1])<s&&(s=d),u>l&&(l=u),d>c&&(c=d);h=0!==(h=Math.max(l-r,c-s))?1/h:0}return a(m,x,n,r,s,h),x}function i(e,t,n,r,i){var o,a;if(i===O(e,t,n,r)>0)for(o=t;o<n;o+=r)a=C(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=C(o,e[o],e[o+1],a);return a&&x(a,a.next)&&(L(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!x(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(L(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,i,f,p){if(e){!p&&f&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=h(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,l,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,f);for(var d,g,v=e;e.prev!==e.next;)if(d=e.prev,g=e.next,f?l(e,r,i,f):s(e))t.push(d.i/n),t.push(e.i/n),t.push(g.i/n),L(e),e=g.next,v=g.next;else if((e=g)===v){p?1===p?a(e=c(o(e),t,n),t,n,r,i,f,2):2===p&&u(e,t,n,r,i,f):a(o(e),t,n,r,i,f,1);break}}}function s(e){var t=e.prev,n=e,r=e.next;if(m(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(v(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(e,t,n,r){var i=e.prev,o=e,a=e.next;if(m(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=h(s,l,t,n,r),p=h(c,u,t,n,r),d=e.prevZ,g=e.nextZ;d&&d.z>=f&&g&&g.z<=p;){if(d!==e.prev&&d!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,g!==e.prev&&g!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;d&&d.z>=f;){if(d!==e.prev&&d!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;g&&g.z<=p;){if(g!==e.prev&&g!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function c(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!x(i,a)&&b(i,r,r.next,a)&&_(i,a)&&_(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),L(r),L(r.next),r=e=a),r=r.next}while(r!==e);return o(r)}function u(e,t,n,r,i,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&y(l,c)){var u=S(l,c);return l=o(l,l.next),u=o(u,u.next),a(l,t,n,r,i,s),void a(u,t,n,r,i,s)}c=c.next}l=l.next}while(l!==e)}function f(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var l,c=n,u=n.x,f=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&v(o<f?i:a,o,u,f,o<f?a:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),_(r,e)&&(l<p||l===p&&(r.x>n.x||r.x===n.x&&d(n,r)))&&(n=r,p=l)),r=r.next}while(r!==c);return n}(e,t)){var n=S(t,e);o(n,n.next)}}function d(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function h(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function v(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(_(e,t)&&_(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||x(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,r){var i=P(m(e,t,n)),o=P(m(e,t,r)),a=P(m(n,r,e)),s=P(m(n,r,t));return i!==o&&a!==s||(!(0!==i||!w(e,n,t))||(!(0!==o||!w(e,r,t))||(!(0!==a||!w(n,e,r))||!(0!==s||!w(n,t,r)))))}function w(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function P(e){return e>0?1:e<0?-1:0}function _(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function S(e,t){var n=new k(e.i,e.x,e.y),r=new k(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function C(e,t,n,r){var i=new k(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function L(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function k(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=r,e.exports.default=r,r.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(O(e,0,o,n));if(i)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,u=s<l-1?t[s+1]*n:e.length;a-=Math.abs(O(e,c,u,n))}var f=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,d=r[s+1]*n,h=r[s+2]*n;f+=Math.abs((e[p]-e[h])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[h+1]-e[p+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},function(e,t,n){var r=n(37),i=n(38),o=n(39);e.exports=function(e,t){return r(e)||i(e,t)||o()}},function(e,t,n){"use strict";e.exports=r,e.exports.default=r;function r(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function i(e,t,n,r,i,a,s){for(var l=0;l<t;l++){for(var c=0;c<n;c++)r[c]=e[c*t+l];for(o(r,i,a,s,n),c=0;c<n;c++)e[c*t+l]=i[c]}for(c=0;c<n;c++){for(l=0;l<t;l++)r[l]=e[c*t+l];for(o(r,i,a,s,t),l=0;l<t;l++)e[c*t+l]=Math.sqrt(i[l])}}function o(e,t,n,r,i){n[0]=0,r[0]=-1e20,r[1]=1e20;for(var o=1,a=0;o<i;o++){for(var s=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=1e20}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;t[o]=(o-n[a])*(o-n[a])+e[n[a]]}}r.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var o=t.data[4*r+3]/255;this.gridOuter[r]=1===o?0:0===o?1e20:Math.pow(Math.max(0,.5-o),2),this.gridInner[r]=1===o?1e20:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(i(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),i(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var a=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(a/this.radius+this.cutoff))))}return n}},,,,,,,,,,,,function(e,t,n){var r=n(40),i=("undefined"==typeof window?global:window).deck||{};if(!i.Layer)throw new Error("@deck.gl/core is not found");e.exports=Object.assign(i,r)},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var r=n(2);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n,r){var i=t&&t.prototype instanceof u?t:u,o=Object.create(i.prototype),a=new P(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function u(){}function f(){}function p(){}var d={};d[i]=function(){return this};var h=Object.getPrototypeOf,g=h&&h(h(_([])));g&&g!==t&&n.call(g,i)&&(d=g);var v=p.prototype=u.prototype=Object.create(d);function y(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function m(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,a){var s=l(e[r],e,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return t("throw",e,o,a)}))}a(s.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function _(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=v.constructor=p,p.constructor=f,p[a]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(m.prototype),m.prototype[o]=function(){return this},e.AsyncIterator=m,e.async=function(t,n,r,i){var o=new m(s(t,n,r,i));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(v),v[a]="Generator",v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=_,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:_(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";n.r(t);var r=n(5),i=n.n(r),o=n(6),a=n.n(o),s=n(7),l=n.n(s),c=n(2),u=n.n(c),f=n(3),p=n.n(f),d=n(8),h=n.n(d),g=n(1),v=n(4),y=[0,0,0,255],m={getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getSourceColor:{type:"accessor",value:y},getTargetColor:{type:"accessor",value:y},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},x=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform bool greatCircle;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\n\n  float deltaZ = targetZ - sourceZ;\n  float dh = distance * instanceHeights;\n  float unitZ = dh == 0.0 ? 0.0 : deltaZ / dh;\n  float p2 = unitZ * unitZ + 1.0;\n  float dir = step(deltaZ, 0.0);\n  float z0 = mix(sourceZ, targetZ, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\n  float distance = length(source.xy - target.xy);\n  float z = paraboloid(distance, source.z, target.z, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 sourceRadians = radians(source);\n  vec2 targetRadians = radians(target);\n  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\n  vec2 shd_sq = sin_half_delta * sin_half_delta;\n\n  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\n  return 2.0 * asin(sqrt(a));\n}\n\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\n  vec2 lngLat;\n  if(abs(angularDist - PI) < 0.001) {\n    lngLat = (1.0 - t) * source.xy + t * target.xy;\n  } else {\n    float a = sin((1.0 - t) * angularDist);\n    float b = sin(t * angularDist);\n    vec3 p = source3D.yxz * a + target3D.yxz * b;\n    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n  }\n\n  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\n\n  return vec3(lngLat, z);\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  isValid = 1.0;\n\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  vec4 curr;\n  vec4 next;\n\n  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    vec3 source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\n    vec3 target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\n    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\n  \n    float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\n    float nextSegmentRatio = getSegmentRatio(min(numSegments, segmentIndex + 1.0));\n\n    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\n    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\n    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\n\n    if (abs(currPos.x - prevPos.x) > 180.0) {\n      indexDir = -1.0;\n      isValid = 0.0;\n    } else if (abs(currPos.x - nextPos.x) > 180.0) {\n      indexDir = 1.0;\n      isValid = 0.0;\n    }\n    nextPos = indexDir < 0.0 ? prevPos : nextPos;\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n\n    if (isValid == 0.0) {\n      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\n      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\n      currPos = mix(currPos, nextPos, t);\n      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n    }\n\n    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n  \n    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  \n  } else {\n    vec3 source = project_position(instanceSourcePositions, instanceSourcePositions64Low);\n    vec3 target = project_position(instanceTargetPositions, instanceTargetPositions64Low);\n\n    float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n    vec3 currPos = interpolateFlat(source, target, segmentRatio);\n    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\n    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n    geometry.position = vec4(currPos, 1.0);\n  }\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:y},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:y},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.props,r=e.oldProps,i=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),i.extensionsChanged){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.widthUnits,o=r.widthScale,a=r.widthMinPixels,s=r.widthMaxPixels,l=r.greatCircle,c="pixels"===i?n.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({greatCircle:l,widthScale:o*c,widthMinPixels:a,widthMaxPixels:s}).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<50;n++)t=t.concat([n,1,0,n,-1,0]);var r=new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}));return r.setUniforms({numSegments:50}),r}}]),t}(g.Layer);x.layerName="ArcLayer",x.defaultProps=m;var b=n(9),w=n.n(b),P=n(10);n(15);function _(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Math.PI,Math.PI;var S={};function C(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function L(e,t,n){return C(e)?e.map((function(e,r){return L(e,t[r],n)})):n*t+(1-n)*e}S.EPSILON=1e-12,S.debug=!1,S.precision=4,S.printTypes=!1,S.printDegrees=!1,S.printRowMajor=!0;var k={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global};(k.global||k.self||k.window).mathgl={config:S};var O=new Uint16Array([0,2,1,0,3,2]),A=new Float32Array([0,1,0,0,1,0,1,1]);function M(e,t){if(!t)return function(e){for(var t=new Float64Array(12),n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return{vertexCount:6,positions:t,indices:O,texCoords:A}}(e);for(var n=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),r=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),i=Math.ceil(n/t)+1,o=Math.ceil(r/t)+1,a=(i-1)*(o-1)*6,s=new Uint32Array(a),l=new Float32Array(i*o*2),c=new Float64Array(i*o*3),u=0,f=0,p=0;p<i;p++)for(var d=p/(i-1),h=0;h<o;h++){var g=h/(o-1),v=E(e,d,g);c[3*u+0]=v[0],c[3*u+1]=v[1],c[3*u+2]=v[2]||0,l[2*u+0]=d,l[2*u+1]=1-g,p>0&&h>0&&(s[f++]=u-o,s[f++]=u-o-1,s[f++]=u-1,s[f++]=u-o,s[f++]=u-1,s[f++]=u),u++}return{vertexCount:a,positions:c,indices:s,texCoords:l}}function E(e,t,n){return L(L(e[0],e[1],n),L(e[3],e[2],n),t)}var T,I=(T={},w()(T,10241,9987),w()(T,10240,9729),w()(T,10242,33071),w()(T,10243,33071),T),z=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.picking]})}},{key:"initializeState",value:function(){var e=this,t=this.getAttributeManager();t.remove(["instancePickingColors"]);t.add({indices:{size:1,isIndexed:!0,update:function(t){return t.value=e.state.mesh.indices},noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(t){return t.value=e.state.mesh.positions},noAlloc:!0},texCoords:{size:2,update:function(t){return t.value=e.state.mesh.texCoords},noAlloc:!0}})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps;if(e.changeFlags.extensionsChanged){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}t.image!==n.image&&this.loadTexture(t.image);var i=this.getAttributeManager();if(t.bounds!==n.bounds){var o=this.state.mesh,a=this._createMesh();for(var s in this.state.model.setVertexCount(a.vertexCount),a)o&&o[s]!==a[s]&&i.invalidate(s);this.setState({mesh:a})}}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"_createMesh",value:function(){var e=this.props.bounds,t=e;return Number.isFinite(e[0])&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),M(t,this.context.viewport.resolution)}},{key:"_getModel",value:function(e){return e?new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,n=this.state,r=n.bitmapTexture,i=n.model,o=this.props,a=o.image,s=o.desaturate,l=o.transparentColor,c=o.tintColor;r&&a instanceof HTMLVideoElement&&a.readyState>HTMLVideoElement.HAVE_METADATA&&(r.width!==a.videoWidth||r.height!==a.videoHeight?(r.resize({width:a.videoWidth,height:a.videoHeight,mipmaps:!0}),r.setSubImageData({data:a,paramters:I})):r.setSubImageData({data:a}),r.generateMipmap());r&&i&&i.setUniforms(Object.assign({},t,{bitmapTexture:r,desaturate:s,transparentColor:l.map((function(e){return e/255})),tintColor:c.slice(0,3).map((function(e){return e/255}))})).draw()}},{key:"loadTexture",value:function(e){var t=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof v.Texture2D?this.setState({bitmapTexture:e}):e instanceof HTMLVideoElement?this.setState({bitmapTexture:new v.Texture2D(t,{width:1,height:1,parameters:I,mipmaps:!1})}):e&&this.setState({bitmapTexture:new v.Texture2D(t,{data:e,parameters:I})})}}]),t}(g.Layer);z.layerName="BitmapLayer",z.defaultProps={image:{type:"object",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var j=n(0),F=n.n(j);function R(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){R(o,r,i,a,s,"next",e)}function s(e){R(o,r,i,a,s,"throw",e)}a(void 0)}))}}function W(e,t){if(!e)throw new Error(t)}var N={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},G=N.global||N.self||N.window,U="object"!==("undefined"==typeof process?"undefined":Object(P.a)(process))||"[object process]"!==String(process)||process.browser,V="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),B=(V&&parseFloat(V[1]),G._parseImageNode),H="undefined"!=typeof Image,Z="undefined"!=typeof ImageBitmap,K=Boolean(B),J=!!U||K;function X(e){var t=Q(e);if(!t)throw new Error("Not an image");return t}function q(e){switch(X(e)){case"data":return e;case"image":case"imagebitmap":var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:return W(!1)}}function Q(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"===Object(P.a)(e)&&e.data&&e.width&&e.height?"data":null}var Y=/^data:image\/svg\+xml/,$=/\.svg((\?|#).*)?$/;function ee(e){return e&&(Y.test(e)||$.test(e))}function te(e,t){if(ee(t)){var n=(new TextDecoder).decode(e);return"data:image/svg+xml;base64,".concat(btoa(n))}return ne(e,t)}function ne(e,t){if(ee(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}function re(e,t,n){return ie.apply(this,arguments)}function ie(){return(ie=D(F.a.mark((function e(t,n,r){var i,o,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=te(t,r),o=self.URL||self.webkitURL,a="string"!=typeof i&&o.createObjectURL(i),e.prev=3,e.next=6,oe(a||i,n);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,a&&o.revokeObjectURL(a),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[3,,7,10]])})))).apply(this,arguments)}function oe(e,t){return ae.apply(this,arguments)}function ae(){return(ae=D(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=new Image).src=t,!(n.image&&n.image.decode&&r.decode)){e.next=6;break}return e.next=5,r.decode();case 5:return e.abrupt("return",r);case 6:return e.next=8,new Promise((function(e,n){try{r.onload=function(){return e(r)},r.onerror=function(e){return n(new Error("Could not load image ".concat(t,": ").concat(e)))}}catch(e){n(e)}}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se={},le=!0;function ce(e,t,n){return ue.apply(this,arguments)}function ue(){return(ue=D(F.a.mark((function e(t,n,r){var i,o,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ee(r)){e.next=7;break}return e.next=3,re(t,n,r);case 3:o=e.sent,i=o,e.next=8;break;case 7:i=ne(t,r);case 8:return a=n&&n.imagebitmap,e.next=11,fe(i,a);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(e){return pe.apply(this,arguments)}function pe(){return(pe=D(F.a.mark((function e(t){var n,r=arguments;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!de(n=r.length>1&&void 0!==r[1]?r[1]:null)&&le||(n=null),!n){e.next=13;break}return e.prev=3,e.next=6,createImageBitmap(t,n);case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),console.warn(e.t0),le=!1;case 13:return e.next=15,createImageBitmap(t);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function de(e){for(var t in e||se)return!0;return!1}function he(e){var t=ge(e);return function(e){var t=ge(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,!1)))return null;return{mimeType:"image/png",width:t.getUint32(16,!1),height:t.getUint32(20,!1)}}(t)||function(e){var t=ge(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2)))return null;var n=function(){for(var e=new Set([65499,65476,65484,65501,65534]),t=65504;t<65520;++t)e.add(t);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:n}}(),r=n.tableMarkers,i=n.sofMarkers,o=2;for(;o+9<t.byteLength;){var a=t.getUint16(o,!1);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(o+5,!1),width:t.getUint16(o+7,!1)};if(!r.has(a))return null;o+=2,o+=t.getUint16(o,!1)}return null}(t)||function(e){var t=ge(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,!1)))return null;return{mimeType:"image/gif",width:t.getUint16(6,!0),height:t.getUint16(8,!0)}}(t)||function(e){var t=ge(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,!1)&&t.getUint32(2,!0)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}(t)}function ge(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}function ve(e,t){var n=(he(e)||{}).mimeType,r=G._parseImageNode;return W(r),r(e,n,t)}function ye(){return(ye=D(F.a.mark((function e(t,n,r){var i,o,a,s,l;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(n=n||{}).image||{},o=i.type||"auto",a=(r||{}).url,s=me(o),e.t0=s,e.next="imagebitmap"===e.t0?8:"image"===e.t0?12:"data"===e.t0?16:20;break;case 8:return e.next=10,ce(t,n,a);case 10:return l=e.sent,e.abrupt("break",21);case 12:return e.next=14,re(t,n,a);case 14:return l=e.sent,e.abrupt("break",21);case 16:return e.next=18,ve(t,n);case 18:return l=e.sent,e.abrupt("break",21);case 20:W(!1);case 21:return"data"===o&&(l=q(l)),e.abrupt("return",l);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){switch(e){case"auto":case"data":return function(){if(Z)return"imagebitmap";if(H)return"image";if(J)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Z||H||J;case"imagebitmap":return Z;case"image":return H;case"data":return J;case"html":return H;case"ndarray":return J;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}var xe={id:"image",name:"Images",version:"2.2.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vndmicrosofticon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function(e,t,n){return ye.apply(this,arguments)},test:function(e){return Boolean(he(new DataView(e)))},options:{image:{type:"auto",decode:!0}}},be=function(e){return"boolean"==typeof e},we=function(e){return"function"==typeof e},Pe=function(e){return null!==e&&"object"===Object(P.a)(e)},_e=function(e){return e&&"function"==typeof e[Symbol.iterator]},Se=function(e){return e&&"function"==typeof e[Symbol.asyncIterator]},Ce=function(e){return"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json},Le=function(e){return"undefined"!=typeof Blob&&e instanceof Blob},ke=function(e){return function(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Pe(e)&&we(e.tee)&&we(e.cancel)&&we(e.getReader)}(e)||function(e){return Pe(e)&&we(e.read)&&we(e.pipe)&&be(e.readable)}(e)},Oe="",Ae={};function Me(e){for(var t in Ae)if(e.startsWith(t)){var n=Ae[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(Oe).concat(e)),e}var Ee=n(12),Te=n(11);function Ie(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var ze=function(){function e(t,n){Object(Ee.a)(this,e),this._fileOrBlob=t,this.bodyUsed=!1}var t,n,r;return Object(Te.a)(e,[{key:"arrayBuffer",value:(r=D(F.a.mark((function e(){var t,n,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._getFileReader(),n=t.reader,r=t.promise,n.readAsArrayBuffer(this._fileOrBlob),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"text",value:(n=D(F.a.mark((function e(){var t,n,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._getFileReader(),n=t.reader,r=t.promise,n.readAsText(this._fileOrBlob),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"json",value:(t=D(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.text();case 2:return t=e.sent,e.abrupt("return",JSON.parse(t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_getFileReader",value:function(){Ie(!this.bodyUsed),this.bodyUsed=!0;var e=new FileReader,t=new Promise((function(t,n){try{e.onerror=function(e){return n(new Error("Read error"))},e.onabort=function(){return n(new Error("Read aborted."))},e.onload=function(){return t(e.result)}}catch(e){n(e)}}));return{reader:e,promise:t}}},{key:"headers",get:function(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}},{key:"ok",get:function(){return!0}},{key:"status",get:function(){return 200}},{key:"url",get:function(){return this._fileOrBlob.name||""}}]),e}();function je(e,t){return Promise.resolve(new ze(e,t))}function Fe(e){return Re.apply(this,arguments)}function Re(){return(Re=D(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): "),e.prev=1,!t.headers.get("Content-Type").includes("application/json")){e.next=10;break}return e.t0=n,e.next=7,t.text();case 7:n=e.t0+=e.sent,e.next=11;break;case 10:n+=t.statusText;case 11:e.next=16;break;case 13:return e.prev=13,e.t1=e.catch(1),e.abrupt("return",n);case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function De(e){return We.apply(this,arguments)}function We(){return(We=D(F.a.mark((function e(t){var n,r,i=arguments;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},!Le(t)){e.next=3;break}return e.abrupt("return",je(t,n));case 3:return t=Me(t),e.next=6,fetch(t,n);case 6:if((r=e.sent).ok||!n.throws){e.next=13;break}return e.t0=Error,e.next=11,Fe(r);case 11:throw e.t1=e.sent,new e.t0(e.t1);case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){Ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ve(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);var t=e.parseTextSync||e.parseSync||e.parse||e.parseStream||e.parseInBatches,n=e.options&&e.options[e.id];return t=t||n&&n.workerUrl}function Be(e){var t;return Ie(e,"null loader"),Ie(Ve(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=Ue(Ue({},e=e[0]),{},{options:Ue(Ue({},e.options),t)})),e.extension&&(e.extensions=e.extensions||e.extension,delete e.extension),Array.isArray(e.extensions)||(e.extensions=[e.extensions]),Ie(e.extensions&&e.extensions.length>0&&e.extensions[0]),e.parseTextSync&&(e.text=!0),e.text||(e.binary=!0),e}function He(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.2.3";Ie(e,"no loader provided");var n=e.version;t&&n&&(t=Ze(t),n=Ze(n))}function Ze(e){var t=e.split(".").map(Number);return{major:t[0],minor:t[1]}}var Ke=function(){function e(){Object(Ee.a)(this,e)}return Object(Te.a)(e,[{key:"log",value:function(){return function(e){}}},{key:"info",value:function(){return function(e){}}},{key:"warn",value:function(){return function(e){}}},{key:"error",value:function(){return function(e){}}}]),e}(),Je={CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new(function(){function e(){Object(Ee.a)(this,e),this.console=console}return Object(Te.a)(e,[{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.log).bind.apply(e,[this.console].concat(n))}},{key:"info",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.info).bind.apply(e,[this.console].concat(n))}},{key:"warn",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.warn).bind.apply(e,[this.console].concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.error).bind.apply(e,[this.console].concat(n))}}]),e}()),dataType:"arraybuffer",metadata:!1};function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){Ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe=function(e){return e&&"object"===Object(P.a)(e)&&e.constructor==={}.constructor},Ye=qe({},Je);function $e(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return et(e,t,r),tt(e,t,n)}function et(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Je,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console;if(n)for(var i in t)"object"===Object(P.a)(t[i])||n[i]||r.warn("Top-level loader option ".concat(i," not recognized"));var o=t&&t[e.id]||{},a=e.options&&e.options[e.id]||{},s=e.defaultOptions&&e.defaultOptions[e.id]||{};for(var l in o)l in a||(l in s?r.warn("".concat(e.name," loader option ").concat(e.id,".").concat(l," deprecated, use ").concat(s[l])):r.warn("".concat(e.name," loader option ").concat(e.id,".").concat(l," not recognized")))}function tt(e,t,n){var r=qe({},e.options||{});return function(e,t){!t||"baseUri"in e||(e.baseUri=t)}(r,n),null===r.log&&(r.log=new Ke),nt(r,Ye),nt(r,t),r}function nt(e,t){for(var n in t)if(n in t){var r=t[n];Qe(r)&&Qe(e[n])?e[n]=qe(qe({},e[n]),t[n]):e[n]=t[n]}}var rt=F.a.mark(it);function it(e){var t,n,r,i,o,a,s,l=arguments;return F.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=l.length>1&&void 0!==l[1]?l[1]:{},n=t.chunkSize,r=void 0===n?262144:n,i=0,o=new TextEncoder;case 4:if(!(i<e.length)){c.next=12;break}return a=Math.min(e.length-i,r),s=e.slice(i,i+a),i+=a,c.next=10,o.encode(s);case 10:c.next=4;break;case 12:case"end":return c.stop()}}),rt)}var ot=F.a.mark(at);function at(e){var t,n,r,i,o,a,s,l=arguments;return F.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=l.length>1&&void 0!==l[1]?l[1]:{},n=t.chunkSize,r=void 0===n?262144:n,i=0;case 3:if(!(i<e.byteLength)){c.next=14;break}return o=Math.min(e.byteLength-i,r),a=new ArrayBuffer(o),s=new Uint8Array(e,i,o),new Uint8Array(a).set(s),i+=o,c.next=12,a;case 12:c.next=3;break;case 14:case"end":return c.stop()}}),ot)}function st(e){this.wrapped=e}function lt(e){return new st(e)}function ct(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof st;Promise.resolve(s?a.wrapped:a).then((function(e){s?r("return"===t?"return":"next",e):i(o.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function ut(e){return function(){return new ct(e.apply(this,arguments))}}"function"==typeof Symbol&&Symbol.asyncIterator&&(ct.prototype[Symbol.asyncIterator]=function(){return this}),ct.prototype.next=function(e){return this._invoke("next",e)},ct.prototype.throw=function(e){return this._invoke("throw",e)},ct.prototype.return=function(e){return this._invoke("return",e)};function ft(e){return pt.apply(this,arguments)}function pt(){return(pt=ut(F.a.mark((function e(t){var n,r,i,o,a,s,l=arguments;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=l.length>1&&void 0!==l[1]?l[1]:{},r=n.chunkSize||1048576,i=0;case 3:if(!(i<t.size)){e.next=14;break}return o=i+r,a=t.slice(i,o),e.next=8,lt(dt(a));case 8:return s=e.sent,i=o,e.next=12,s;case 12:e.next=3;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e){return ht.apply(this,arguments)}function ht(){return(ht=D(F.a.mark((function e(t){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new FileReader;r.onloadend=function(t){return e(t.target.result)},r.onerror=function(e){return n(e)},r.readAsArrayBuffer(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;var gt="object"!==("undefined"==typeof process?"undefined":Object(P.a)(process))||"[object process]"!==String(process)||process.browser,vt="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),yt=vt&&parseFloat(vt[1])||0;function mt(e){if(gt||yt>=10){if("function"==typeof e[Symbol.asyncIterator])return e;if("function"==typeof e.getIterator)return e.getIterator()}return gt?function(e){return xt.apply(this,arguments)}(e):function(e){return bt.apply(this,arguments)}(e)}function xt(){return(xt=ut(F.a.mark((function e(t){var n,r,i,o;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.getReader(),e.prev=1;case 2:return e.next=5,lt(n.read());case 5:if(r=e.sent,i=r.done,o=r.value,!i){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,o;case 12:e.next=2;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),n.releaseLock();case 19:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}function bt(){return(bt=ut(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt(t);case 2:t=e.sent;case 3:if(null===(n=t.read())){e.next=9;break}return e.next=8,n;case 8:return e.abrupt("continue",3);case 9:if(!t._readableState.ended){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,lt(wt(t));case 13:e.next=3;break;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wt(e){return Pt.apply(this,arguments)}function Pt(){return(Pt=D(F.a.mark((function e(t){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.once("readable",e)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e?it(e,t):e instanceof ArrayBuffer?at(e,t):Le(e)?ft(e,t):ke(e)?mt(e):Ce(e)?mt(e.body):Ie(!1)}function St(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}function Ct(e,t){var n=e instanceof ArrayBuffer?new Uint8Array(e):e,r=t instanceof ArrayBuffer?new Uint8Array(t):t,i=new Uint8Array(n.byteLength+r.byteLength);return i.set(n,0),i.set(r,n.byteLength),i}function Lt(e){return kt.apply(this,arguments)}function kt(){return(kt=D(F.a.mark((function e(t){var n,r,i,o,a,s,l,c,u;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new ArrayBuffer(0),r="",i=!0,o=!1,e.prev=4,s=St(t);case 6:return e.next=8,s.next();case 8:return l=e.sent,i=l.done,e.next=12,l.value;case 12:if(c=e.sent,i){e.next=19;break}"string"==typeof(u=c)?r+=u:n=Ct(n,u);case 16:i=!0,e.next=6;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(4),o=!0,a=e.t0;case 25:if(e.prev=25,e.prev=26,i||null==s.return){e.next=30;break}return e.next=30,s.return();case 30:if(e.prev=30,!o){e.next=33;break}throw a;case 33:return e.finish(30);case 34:return e.finish(25);case 35:return e.abrupt("return",r||n);case 36:case"end":return e.stop()}}),e,null,[[4,21,25,35],[26,,30,34]])})))).apply(this,arguments)}function Ot(e){return At.apply(this,arguments)}function At(){return(At=D(F.a.mark((function e(t){var n,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=12;break}return n="fetch failed ".concat(t.status," ").concat(t.statusText),e.prev=2,e.next=5,t.text().slice(10);case 5:r=e.sent,n+=r,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:throw new Error(n);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}var Mt="Cannot convert supplied data type";function Et(e,t){return Ce(e)?t=t||e.url:Le(t)&&(t=t.name),"string"==typeof t?t.replace(/\?.*/,""):t}function Tt(e,t){if(t.text&&"string"==typeof e)return e;if(e instanceof ArrayBuffer){var n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)||(o=e)&&"object"===Object(P.a)(o)&&o.isBuffer){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);var r=e.buffer,i=e.byteLength||e.length;return 0===e.byteOffset&&i===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+i)),r}var o;throw new Error(Mt)}function It(e,t){return zt.apply(this,arguments)}function zt(){return(zt=D(F.a.mark((function e(t,n){var r,i;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(t=e.sent,r=t instanceof ArrayBuffer||ArrayBuffer.isView(t),"string"!=typeof t&&!r){e.next=6;break}return e.abrupt("return",Tt(t,n));case 6:if(!Le(t)){e.next=10;break}return e.next=9,je(t);case 9:t=e.sent;case 10:if(!Ce(t)){e.next=24;break}return i=t,e.next=14,Ot(i);case 14:if(!n.binary){e.next=20;break}return e.next=17,i.arrayBuffer();case 17:e.t0=e.sent,e.next=23;break;case 20:return e.next=22,i.text();case 22:e.t0=e.sent;case 23:return e.abrupt("return",e.t0);case 24:if(ke(t)&&(t=_t(t)),!_e(t)&&!Se(t)){e.next=27;break}return e.abrupt("return",Lt(t));case 27:throw new Error(Mt);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(n),!0).forEach((function(t){Ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n||(e=Ft({fetch:e.fetch||De},e),Array.isArray(e.loaders)||(e.loaders=null),e)}function Dt(e,t){if(!t&&!Array.isArray(e))return e;var n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){var r=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[].concat(_(n),_(r)):r}return n&&n.length?n:null}var Wt=new Map;function Nt(e){return"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n}")}function Gt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=n||new Set;if(e){if(Ut(e))r.add(e);else if(Ut(e.buffer))r.add(e.buffer);else if(t&&"object"===Object(P.a)(e))for(var i in e)Gt(e[i],t,r)}else;return void 0===n?Array.from(r):null}function Ut(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var Vt=0;function Bt(e){var t=e.data;(0,e.resolve)(t)}var Ht=function(){function e(t){var n=t.source,r=t.name,i=void 0===r?"web-worker-".concat(Vt++):r,o=t.onMessage;Object(Ee.a)(this,e);var a=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],Ie("string"==typeof e,"worker source"),e.startsWith("url(")&&e.endsWith(")")){var t=e.match(/^url\((.*)\)$/)[1];if(t&&!t.startsWith("http"))return t;e=Nt(t)}var n=Wt.get(e);if(!n){var r=new Blob([e],{type:"application/javascript"});n=URL.createObjectURL(r),Wt.set(e,n)}return n}(n,i);this.worker=new Worker(a,{name:i}),this.name=i,this.onMessage=o||Bt}var t;return Object(Te.a)(e,[{key:"process",value:(t=D(F.a.mark((function e(t){var n=this;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n.worker.onmessage=function(t){return n.onMessage({worker:n.worker,data:t.data,resolve:e,reject:r})},n.worker.onerror=function(e){var t="".concat(n.name,": WorkerThread.process() failed");e.message&&(t+=" ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));var i=new Error(t);console.error(e),r(i)};var i=Gt(t);n.worker.postMessage(t,i)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.worker.terminate(),this.worker=null}}]),e}(),Zt=function(){function e(t){var n=t.source,r=t.name,i=void 0===r?"unnamed":r,o=t.maxConcurrency,a=void 0===o?1:o,s=t.onMessage,l=t.onDebug,c=void 0===l?function(){}:l;Object(Ee.a)(this,e),this.source=n,this.name=i,this.maxConcurrency=a,this.onMessage=s,this.onDebug=c,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}var t;return Object(Te.a)(e,[{key:"destroy",value:function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0}},{key:"process",value:(t=D(F.a.mark((function e(t,n){var r=this;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){r.jobQueue.push({data:t,jobName:n,resolve:e,reject:i}),r._startQueuedJob()})));case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"_startQueuedJob",value:function(){var e=this;if(this.jobQueue.length){var t=this._getAvailableWorker();if(t){var n=this.jobQueue.shift();this.onDebug({message:"processing",worker:t.name,job:n.jobName,backlog:this.jobQueue.length}),t.process(n.data).then((function(e){return n.resolve(e)})).catch((function(e){return n.reject(e)})).then((function(){return e._onWorkerDone(t)}))}}}},{key:"_onWorkerDone",value:function(e){this.isDestroyed?e.destroy():(this.idleQueue.push(e),this._startQueuedJob())}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Ht({source:this.source,onMessage:this.onMessage,name:e})}return null}}]),e}(),Kt=function(){function e(t){var n=t.maxConcurrency,r=void 0===n?5:n,i=t.onMessage,o=t.onDebug,a=void 0===o?function(){}:o;Object(Ee.a)(this,e),this.maxConcurrency=r,this.onMessage=i,this.onDebug=a,this.workerPools=new Map}var t;return Object(Te.a)(e,null,[{key:"isSupported",value:function(){return"undefined"!=typeof Worker}}]),Object(Te.a)(e,[{key:"setProps",value:function(e){"maxConcurrency"in e&&(this.maxConcurrency=e.maxConcurrency),"onDebug"in e&&(this.onDebug=e.onDebug)}},{key:"destroy",value:function(){this.workerPools.forEach((function(e){return e.destroy()}))}},{key:"process",value:(t=D(F.a.mark((function e(t,n,r){var i;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._getWorkerPool(t,n),e.abrupt("return",i.process(r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"_getWorkerPool",value:function(e,t){var n=this.workerPools.get(t);return n||(n=new Zt({source:e,name:t,onMessage:this.onMessage,maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(t,n)),n}}]),e}(),Jt=n(14);function Xt(e){if(Jt.toArrayBuffer&&(e=Object(Jt.toArrayBuffer)(e)),e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){var t=e;return(new TextEncoder).encode(t).buffer}return Ie(!1)}function qt(e,t,n,r){if(!Kt.isSupported())return!1;var i=n&&n[e.id];return!!("local"===n.worker&&i&&i.localWorkerUrl||n.worker&&i&&i.workerUrl)&&(!e.useWorker||e.useWorker(n))}function Qt(e,t,n,r){var i=(n||{}).worker,o=n&&n[e.id]||{},a="local"===i?o.localWorkerUrl:o.workerUrl,s="url(".concat(a,")"),l=e.name,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.maxConcurrency&&(t.maxConcurrency=e.maxConcurrency);e.onDebug&&(t.onDebug=e.onDebug);Yt||(Yt=new Kt({onMessage:$t}));return Yt.setProps(t),Yt}(n);n=JSON.parse(JSON.stringify(n));var u="2.2.3"!==e.version?"(core version ".concat("2.2.3",")"):"";return c.process(s,"".concat(l,"-worker@").concat(e.version).concat(u),{arraybuffer:Xt(t),options:n,source:"loaders.gl@".concat("2.2.3"),type:"parse"})}var Yt=null;function $t(e){return en.apply(this,arguments)}function en(){return(en=D(F.a.mark((function e(t){var n,r,i,o,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.worker,r=t.data,i=t.resolve,o=t.reject,e.t0=r.type,e.next="done"===e.t0?4:"parse"===e.t0?6:"error"===e.t0?17:19;break;case 4:return i(r.result),e.abrupt("break",19);case 6:return e.prev=6,e.next=9,_n(r.arraybuffer,r.options,r.url);case 9:a=e.sent,n.postMessage({type:"parse-done",id:r.id,result:a},Gt(a)),e.next=16;break;case 13:e.prev=13,e.t1=e.catch(6),n.postMessage({type:"parse-error",id:r.id,message:e.t1.message});case 16:return e.abrupt("break",19);case 17:return o(r.message),e.abrupt("break",19);case 19:case"end":return e.stop()}}),e,null,[[6,13]])})))).apply(this,arguments)}var tn=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,nn=/^([-\w.]+\/[-\w.+]+)/;function rn(e){if("string"!=typeof e)return"";var t=e.match(tn);return t?t[1]:""}var on=/\?.*/;function an(e){if(Ce(e)){var t=function(e){if("string"!=typeof e)return"";var t=e.match(nn);return t?t[1]:e}(e.headers.get("content-type")),n=rn(e.url);return{url:sn(e.url||""),type:t||n||null}}return Le(e)?{url:sn(e.url||""),type:e.type||""}:"string"==typeof e?{url:sn(e),type:rn(e)}:{url:"",type:""}}function sn(e){return e.replace(on,"")}var ln=[];function cn(){return ln}function un(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return fn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var pn,dn=/\.([^.]+)$/;function hn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t&&!Array.isArray(t))return Be(t);vn(t=[].concat(_(t||[]),_(cn())));var i=an(e),o=i.url,a=i.type,s=yn(t,o||r.url);if(!(s=(s=s||mn(t,a))||xn(t,e))&&!n.nothrow)throw new Error(gn(e,o,a));return s}function gn(e,t,n){var r="No valid loader found";return e&&(r+=' data: "'.concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Pn(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){var n=0;return Pn(e,n,t)}return""}(e),'"')),t&&(r+=" for ".concat(t)),r}function vn(e){var t,n=un(e);try{for(n.s();!(t=n.n()).done;){Be(t.value)}}catch(e){n.e(e)}finally{n.f()}}function yn(e,t){var n=t&&t.match(dn),r=n&&n[1];return r&&function(e,t){t=t.toLowerCase();var n,r=un(e);try{for(r.s();!(n=r.n()).done;){var i,o=n.value,a=un(o.extensions);try{for(a.s();!(i=a.n()).done;){if(i.value.toLowerCase()===t)return o}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}return null}(e,r)}function mn(e,t){var n,r=un(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.mimeTypes&&i.mimeTypes.includes(t))return i;if(t==="application/x.".concat(i.id))return i}}catch(e){r.e(e)}finally{r.f()}return null}function xn(e,t){if(!t)return null;var n,r=un(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if("string"==typeof t){if(bn(t,i))return i}else if(ArrayBuffer.isView(t)){if(wn(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer){if(wn(t,0,i))return i}}}catch(e){r.e(e)}finally{r.f()}return null}function bn(e,t){return t.testText&&t.testText(e)}function wn(e,t,n){switch(Array.isArray(n.test)?"array":Object(P.a)(n.test)){case"function":return n.test(e,n);case"string":case"array":return(Array.isArray(n.test)?n.test:[n.test]).some((function(n){return n===Pn(e,t,n.length)}));default:return!1}}function Pn(e,t,n){if(e.byteLength<=t+n)return"";for(var r=new DataView(e),i="",o=0;o<n;o++)i+=String.fromCharCode(r.getUint8(t+o));return i}function _n(e,t,n,r){return Sn.apply(this,arguments)}function Sn(){return(Sn=D(F.a.mark((function e(t,n,r,i){var o,a,s,l;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||Array.isArray(n)||Ve(n)||(i=r,r=n,n=null),o="","string"==typeof i&&(o=i,i=null),r=r||{},a=Et(t,o),s=Dt(n,i),l=hn(t,s,r,{url:a})){e.next=9;break}return e.abrupt("return",null);case 9:return r=$e(l,r,a),i=Rt({url:a,parse:_n,loaders:s},r,i),e.next=13,Cn(l,t,r,i);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cn(e,t,n,r){return Ln.apply(this,arguments)}function Ln(){return(Ln=D(F.a.mark((function e(t,n,r,i){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return He(t),e.next=3,It(n,t);case 3:if(n=e.sent,!t.parseTextSync||"string"!=typeof n){e.next=7;break}return r.dataType="text",e.abrupt("return",t.parseTextSync(n,r,i,t));case 7:if(!qt(t,0,r)){e.next=11;break}return e.next=10,Qt(t,n,r);case 10:return e.abrupt("return",e.sent);case 11:if(!t.parse){e.next=15;break}return e.next=14,t.parse(n,r,i,t);case 14:return e.abrupt("return",e.sent);case 15:return Ie(!t.parseSync),e.abrupt("return",Ie(!1));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kn(){return(kn=D(F.a.mark((function e(t,n,r){var i;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(n)||Ve(n)||(r=n,n=null),i=t,"string"!=typeof t){e.next=8;break}return e.next=5,De(t,r);case 5:i=e.sent,e.next=9;break;case 8:t=null;case 9:if(!Le(t)){e.next=14;break}return e.next=12,De(t,r);case 12:i=e.sent,t=null;case 14:return e.next=16,_n(i,n,r,t);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var On=function(){},An=(pn={},w()(pn,10241,9987),w()(pn,10240,9729),w()(pn,10242,33071),w()(pn,10243,33071),pn);function Mn(e){return e&&(e.id||e.url)}function En(e,t,n){for(var r=0;r<t.length;r++){var i=t[r],o=i.icon,a=i.xOffset;e[Mn(o)]=Object.assign({},o,{x:a,y:n})}}var Tn=function(){function e(t,n){var r=n.onUpdate,o=void 0===r?On:r;i()(this,e),this.gl=t,this.onUpdate=o,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}return a()(e,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?Mn(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t=e.loadOptions,n=e.autoPacking,r=e.iconAtlas,i=e.iconMapping,o=e.data,a=e.getIcon;t&&(this._loadOptions=t),void 0!==n&&(this._autoPacking=n),a&&(this._getIcon=a),i&&(this._mapping=i),r&&this._updateIconAtlas(r),this._autoPacking&&(o||a)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(o))}},{key:"_updateIconAtlas",value:function(e){this._texture&&(this._texture.delete(),this._texture=null),e instanceof v.Texture2D?(e.setParameters(An),this._externalTexture=e,this.onUpdate()):e&&(this._texture=new v.Texture2D(this.gl,{data:e,parameters:An}),this.onUpdate())}},{key:"_updateAutoPacking",value:function(e){var t,n,r,i,o,a,s=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};var r={},i=Object(g.createIterable)(e),o=i.iterable,a=i.objectInfo,s=!0,l=!1,c=void 0;try{for(var u,f=o[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var p=u.value;a.index++;var d=t(p,a),h=Mn(d);if(!d)throw new Error("Icon is missing.");if(!d.url)throw new Error("Icon url is missing.");r[h]||n[h]&&d.url===n[h].url||(r[h]=d)}}catch(e){l=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(l)throw c}}return r}(e,this._getIcon,this._mapping)||{});if(s.length>0){var l=function(e){for(var t,n=e.icons,r=e.buffer,i=e.mapping,o=void 0===i?{}:i,a=e.xOffset,s=void 0===a?0:a,l=e.yOffset,c=void 0===l?0:l,u=e.rowHeight,f=void 0===u?0:u,p=e.canvasWidth,d=[],h=0;h<n.length;h++){var g=n[h];if(!o[Mn(g)]){var v=g.height,y=g.width;s+y+r>p&&(En(o,d,c),s=0,c=f+c+r,f=0,d=[]),d.push({icon:g,xOffset:s}),s=s+y+r,f=Math.max(f,v)}}return d.length>0&&En(o,d,c),{mapping:o,rowHeight:f,xOffset:s,yOffset:c,canvasWidth:p,canvasHeight:(t=f+c+r,Math.pow(2,Math.ceil(Math.log2(t))))}}({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),c=l.mapping,u=l.xOffset,f=l.yOffset,p=l.rowHeight,d=l.canvasHeight;this._rowHeight=p,this._mapping=c,this._xOffset=u,this._yOffset=f,this._canvasHeight=d,this._texture||(this._texture=new v.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:An})),this._texture.height!==this._canvasHeight&&(this._texture=(this.gl,t=this._texture,n=this._canvasWidth,r=this._canvasHeight,i=t.width,o=t.height,a=Object(v.cloneTextureFrom)(t,{width:n,height:r}),Object(v.copyToTexture)(t,a,{targetY:0,width:i,height:o}),t.delete(),a)),this.onUpdate(),this._loadIcons(s)}}},{key:"_loadIcons",value:function(e){var t=this,n=this._canvas.getContext("2d"),r=!0,i=!1,o=void 0;try{for(var a,s=function(){var e=a.value;t._pendingCount++,function(e,t,n){return kn.apply(this,arguments)}(e.url,xe,t._loadOptions).then((function(r){var i=Mn(e),o=t._mapping[i],a=o.x,s=o.y,l=o.width,c=o.height,u=function(e,t,n,r){return n===t.width&&r===t.height?t:(e.canvas.height=r,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,n,r),e.canvas)}(n,r,l,c);t._texture.setSubImageData({data:u,x:a,y:s,width:l,height:c}),t._texture.generateMipmap(),t.onUpdate()})).catch((function(e){g.log.error(e)()})).finally((function(){t._pendingCount--}))},l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0)s()}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}}},{key:"isLoaded",get:function(){return 0===this._pendingCount}}]),e}(),In=[0,0,0,255],zn={iconAtlas:{type:"object",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(e){return e.position}},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:In},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]}},jn=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.picking]})}},{key:"initializeState",value:function(){var e=this;this.state={iconManager:new Tn(this.context.gl,{onUpdate:function(){return e._onUpdate()}})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:In},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){var n=e.oldProps,r=e.props,i=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:r,oldProps:n,changeFlags:i});var o=this.getAttributeManager(),a=r.iconAtlas,s=r.iconMapping,l=r.data,c=r.getIcon,f=this.state.iconManager;f.setProps({loadOptions:r.loadOptions});var d=!1;if(a||this.internalState.isAsyncPropLoading("iconAtlas")?(n.iconAtlas!==r.iconAtlas&&f.setProps({iconAtlas:a,autoPacking:!1}),n.iconMapping!==r.iconMapping&&(f.setProps({iconMapping:s}),d=!0)):f.setProps({autoPacking:!0}),(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&(f.setProps({data:l,getIcon:c}),d=!0),d&&(o.invalidate("instanceOffsets"),o.invalidate("instanceIconFrames"),o.invalidate("instanceColorModes")),i.extensionsChanged){var h=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(h)}),o.invalidateAll()}}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,r=n.sizeScale,i=n.sizeMinPixels,o=n.sizeMaxPixels,a=n.sizeUnits,s=n.billboard,l=n.alphaCutoff,c=this.state.iconManager,u=this.context.viewport,f=c.getTexture();f&&f.loaded&&this.state.model.setUniforms(Object.assign({},t,{iconsTexture:f,iconsTextureDim:[f.width,f.height],sizeScale:r*("pixels"===a?u.metersPerPixel:1),sizeMinPixels:i,sizeMaxPixels:o,billboard:s,alphaCutoff:l})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}},{key:"getInstanceColorMode",value:function(e){return this.state.iconManager.getIconMapping(e).mask?1:0}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}},{key:"isLoaded",get:function(){return p()(u()(t.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}}]),t}(g.Layer);jn.layerName="IconLayer",jn.defaultProps=zn;var Fn={getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Rn=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,r=e.oldProps,i=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),i.extensionsChanged){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.widthUnits,o=r.widthScale,a=r.widthMinPixels,s=r.widthMaxPixels,l="pixels"===i?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:o*l,widthMinPixels:a,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:5,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0}))}}]),t}(g.Layer);Rn.layerName="LineLayer",Rn.defaultProps=Fn;var Dn=[0,0,0,255],Wn=[0,0,1],Nn={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(e){return e.position}},getNormal:{type:"accessor",value:Wn},getColor:{type:"accessor",value:Dn},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};var Gn=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(e){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * radiusPixels, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.gouraudLighting,g.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:Wn},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Dn}})}},{key:"updateState",value:function(e){var n,r,i,o=e.props,a=e.oldProps,s=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:o,oldProps:a,changeFlags:s}),s.extensionsChanged){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}s.dataChanged&&(n=o.data,r=n.header,i=n.attributes,r&&i&&(n.length=r.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0&&(i.instanceColors=i.COLOR_0)))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.pointSize,o="meters"===r.sizeUnits?1/n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},t,{radiusPixels:i*o})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<3;n++){var r=n/3*Math.PI*2;t.push(2*Math.cos(r),2*Math.sin(r),0)}return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}]),t}(g.Layer);Gn.layerName="PointCloudLayer",Gn.defaultProps=Nn;var Un=[0,0,0,255],Vn={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Un},getLineColor:{type:"accessor",value:Un},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Bn=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(e){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,r=e.oldProps,i=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),i.extensionsChanged){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.radiusUnits,o=r.radiusScale,a=r.radiusMinPixels,s=r.radiusMaxPixels,l=r.stroked,c=r.filled,u=r.lineWidthUnits,f=r.lineWidthScale,p=r.lineWidthMinPixels,d=r.lineWidthMaxPixels,h="pixels"===i?n.metersPerPixel:1,g="pixels"===u?n.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({stroked:l?1:0,filled:c,radiusScale:o*h,radiusMinPixels:a,radiusMaxPixels:s,lineWidthScale:f*g,lineWidthMinPixels:p,lineWidthMaxPixels:d}).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0}))}}]),t}(g.Layer);function Hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hn(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Bn.layerName="ScatterplotLayer",Bn.defaultProps=Vn;var Kn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n=e.id,r=void 0===n?Object(v.uid)("column-geometry"):n,o=Jn(e),a=o.indices,s=o.attributes;return l()(this,u()(t).call(this,Zn({},e,{id:r,indices:a,attributes:s})))}return h()(t,e),t}(v.Geometry);function Jn(e){var t=e.radius,n=e.height,r=void 0===n?1:n,i=e.nradial,o=void 0===i?10:i,a=e.vertices;g.log.assert(!a||a.length>=o);for(var s=o+1,l=3*s,c=2*Math.PI/o,u=new Uint16Array(3*o*2),f=new Float32Array(3*l),p=new Float32Array(3*l),d=0,h=0;h<s;h++)for(var v=h*c,y=a&&a[h%o],m=a&&a[(h+1)%o],x=Math.sin(v),b=Math.cos(v),w=0;w<2;w++)f[d+0]=y?y[0]:b*t,f[d+1]=y?y[1]:x*t,f[d+2]=(.5-w)*r,p[d+0]=y?m[0]-y[0]:b,p[d+1]=y?m[1]-y[1]:x,d+=3;for(var P=0;P<s;P++){var _=Math.floor(P/2)*Math.sign(P%2-.5),S=_*c,C=a&&a[(_+o)%o],L=Math.sin(S),k=Math.cos(S);f[d+0]=C?C[0]:k*t,f[d+1]=C?C[1]:L*t,f[d+2]=r/2,p[d+2]=1,d+=3}for(var O=0,A=0;A<o;A++)u[O++]=2*A+0,u[O++]=2*A+2,u[O++]=2*A+0,u[O++]=2*A+1,u[O++]=2*A+1,u[O++]=2*A+3;return{indices:u,attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:p}}}}var Xn=[0,0,0,255],qn={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:Xn},getLineColor:{type:"accessor",value:Xn},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Qn=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.gouraudLighting,g.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Xn},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Xn},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,r=e.oldProps,i=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i});var o=i.extensionsChanged;if(o){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}(o||n.diskResolution!==r.diskResolution||n.vertices!==r.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new Kn({radius:1,height:2,vertices:t,nradial:e}),r=0;if(t)for(var i=0;i<e;i++){var o=t[i];r+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),n}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,r=this.getGeometry(t,n);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3,wireframeVertexCount:r.indices.value.length}),this.state.model.setProps({geometry:r})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.lineWidthUnits,o=r.lineWidthScale,a=r.lineWidthMinPixels,s=r.lineWidthMaxPixels,l=r.elevationScale,c=r.extruded,u=r.filled,f=r.stroked,p=r.wireframe,d=r.offset,h=r.coverage,g=r.radius,v=r.angle,y=this.state,m=y.model,x=y.fillVertexCount,b=y.wireframeVertexCount,w=y.edgeDistance,P="pixels"===i?n.metersPerPixel:1;m.setUniforms(Object.assign({},t,{radius:g,angle:v/180*Math.PI,offset:d,extruded:c,coverage:h,elevationScale:l,edgeDistance:w,widthScale:o*P,widthMinPixels:a,widthMaxPixels:s})),c&&p&&(m.setProps({isIndexed:!0}),m.setVertexCount(b).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(m.setProps({isIndexed:!1}),m.setVertexCount(x).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&f&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*x/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(g.Layer);Qn.layerName="ColumnLayer",Qn.defaultProps=qn;var Yn=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getGeometry",value:function(e){return new v.CubeGeometry}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,r=n.elevationScale,i=n.extruded,o=n.offset,a=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:o,extruded:i,coverage:a,elevationScale:r,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(Qn);Yn.layerName="GridCellLayer",Yn.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};!function(){function e(t){Object(Ee.a)(this,e),this.points=t,this.isClosed=function e(t,n,r){var i=S.EPSILON;r&&(S.EPSILON=r);try{if(t===n)return!0;if(C(t)&&C(n)){if(t.length!==n.length)return!1;for(var o=0;o<t.length;++o)if(!e(t[o],n[o]))return!1;return!0}return t&&t.equals?t.equals(n):n&&n.equals?n.equals(t):!(!Number.isFinite(t)||!Number.isFinite(n))&&Math.abs(t-n)<=S.EPSILON*Math.max(1,Math.abs(t),Math.abs(n))}finally{S.EPSILON=i}}(this.points[this.points.length-1],this.points[0]),Object.freeze(this)}Object(Te.a)(e,[{key:"getSignedArea",value:function(){var e=0;return this.forEachSegment((function(t,n){e+=(t[0]+n[0])*(t[1]-n[1])})),e/2}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(e){for(var t=this.points.length,n=0;n<t-1;n++)e(this.points[n],this.points[n+1],n,n+1);this.isClosed||e(this.points[t-1],this.points[0],t-1,0)}}])}();function $n(e,t){var n=t.length,r=e.length;if(r>0){for(var i=!0,o=0;o<n;o++)if(e[r-n+o]!==t[o]){i=!1;break}if(i)return!1}for(var a=0;a<n;a++)e[r+a]=t[a];return!0}function er(e,t){for(var n=t.length,r=0;r<n;r++)e[r]=t[r]}function tr(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=r+t*n,a=0;a<n;a++)i[a]=e[o+a];return i}function nr(e,t,n,r){var i,o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(8&n)i=(r[3]-e[1])/(t[1]-e[1]),o=3;else if(4&n)i=(r[1]-e[1])/(t[1]-e[1]),o=1;else if(2&n)i=(r[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&n))return null;i=(r[0]-e[0])/(t[0]-e[0]),o=0}for(var s=0;s<e.length;s++)a[s]=(1&o)===s?r[o]:i*t[s]+(1-i)*e[s];return a}function rr(e,t){var n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function ir(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.size,o=void 0===i?2:i,a=r.broken,s=void 0!==a&&a,l=r.gridResolution,c=void 0===l?10:l,u=r.gridOffset,f=void 0===u?[0,0]:u,p=r.startIndex,d=void 0===p?0:p,h=r.endIndex,g=void 0===h?e.length:h,v=(g-d)/o,y=[],m=[y],x=tr(e,0,o,d),b=sr(x,c,f,[]),w=[];$n(y,x);for(var P=1;P<v;P++){for(n=rr(t=tr(e,P,o,d,t),b);n;){nr(x,t,n,b,w);var _=rr(w,b);_&&(nr(x,w,_,b,w),n=_),$n(y,w),er(x,w),lr(b,c,n),s&&y.length>o&&(y=[],m.push(y),$n(y,x)),n=rr(t,b)}$n(y,t),er(x,t)}return s?m:m[0]}function or(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.length)return[];for(var r=n.size,i=void 0===r?2:r,o=n.gridResolution,a=void 0===o?10:o,s=n.gridOffset,l=void 0===s?[0,0]:s,c=n.edgeTypes,u=void 0!==c&&c,f=[],p=[{pos:e,types:u&&new Array(e.length/i).fill(1),holes:t||[]}],d=[[],[]],h=[];p.length;){var g=p.shift(),v=g.pos,y=g.types,m=g.holes;cr(v,i,d),h=sr(d[0],a,l,h);var x=rr(d[1],h);if(x){var b=ar(v,y,i,0,m[0]||v.length,h,x),w={pos:b[0].pos,types:b[0].types,holes:[]},P={pos:b[1].pos,types:b[1].types,holes:[]};p.push(w,P);for(var _=0;_<m.length;_++)(b=ar(v,y,i,m[_],m[_+1]||v.length,h,x))[0]&&(w.holes.push(w.pos.length),w.pos=w.pos.concat(b[0].pos),u&&(w.types=w.types.concat(b[0].types))),b[1]&&(P.holes.push(P.pos.length),P.pos=P.pos.concat(b[1].pos),u&&(P.types=P.types.concat(b[1].types)))}else{var S={positions:v};u&&(S.edgeTypes=y),m.length&&(S.holeIndices=m),f.push(S)}}return f}function ar(e,t,n,r,i,o,a){for(var s,l,c,u=(i-r)/n,f=[],p=[],d=[],h=[],g=[],v=tr(e,u-1,n,r),y=Math.sign(8&a?v[1]-o[3]:v[0]-o[2]),m=t&&t[u-1],x=0,b=0,w=0;w<u;w++)s=tr(e,w,n,r,s),l=Math.sign(8&a?s[1]-o[3]:s[0]-o[2]),c=t&&t[r/n+w],l&&y&&y!==l&&(nr(v,s,a,o,g),$n(f,g)&&d.push(m),$n(p,g)&&h.push(m)),l<=0?($n(f,s)&&d.push(c),x-=l):d.length&&(d[d.length-1]=0),l>=0?($n(p,s)&&h.push(c),b+=l):h.length&&(h[h.length-1]=0),er(v,s),y=l,m=c;return[x?{pos:f,types:t&&d}:null,b?{pos:p,types:t&&h}:null]}function sr(e,t,n,r){var i=Math.floor((e[0]-n[0])/t)*t+n[0],o=Math.floor((e[1]-n[1])/t)*t+n[1];return r[0]=i,r[1]=o,r[2]=i+t,r[3]=o+t,r}function lr(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function cr(e,t,n){for(var r=1/0,i=-1/0,o=1/0,a=-1/0,s=0;s<e.length;s+=t){var l=e[s],c=e[s+1];r=l<r?l:r,i=l>i?l:i,o=c<o?c:o,a=c>a?c:a}return n[0][0]=r,n[0][1]=o,n[1][0]=i,n[1][1]=a,n}function ur(e,t,n,r){for(var i=-1,o=-1,a=n+1;a<r;a+=t){var s=Math.abs(e[a]);s>i&&(i=s,o=a-1)}return o}function fr(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:85.051129,o=e[n],a=e[r-t];if(Math.abs(o-a)>180){var s=tr(e,0,t,n);s[0]+=360*Math.round((a-o)/360),$n(e,s),s[1]=Math.sign(s[1])*i,$n(e,s),s[0]=o,$n(e,s)}}function pr(e,t,n,r){for(var i,o=e[0],a=n;a<r;a+=t){var s=(i=e[a])-o;(s>180||s<-180)&&(i-=360*Math.round(s/360)),e[a]=o=i}}function dr(e,t){for(var n,r=e.length/t,i=0;i<r&&((n=e[i*t])+180)%360==0;i++);var o=360*-Math.round(n/360);if(0!==o)for(var a=0;a<r;a++)e[a*t]+=o}function hr(e,t,n,r){var i=e;if(Array.isArray(e[0])){var o=e.length*t;i=new Array(o);for(var a=0;a<e.length;a++)for(var s=0;s<t;s++)i[a*t+s]=e[a][s]||0}return n?ir(i,{size:t,gridResolution:n}):r?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.size,r=void 0===n?2:n,i=t.startIndex,o=void 0===i?0:i,a=t.endIndex,s=void 0===a?e.length:a,l=t.normalize,c=void 0===l||l,u=e.slice(o,s);pr(u,r,0,s-o);var f=ir(u,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c){var p=!0,d=!1,h=void 0;try{for(var g,v=f[Symbol.iterator]();!(p=(g=v.next()).done);p=!0){var y=g.value;dr(y,r)}}catch(e){d=!0,h=e}finally{try{p||null==v.return||v.return()}finally{if(d)throw h}}}return f}(i,{size:t}):i}function gr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var vr=function(e){function t(e){return i()(this,t),l()(this,u()(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gr(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})))}return h()(t,e),a()(t,[{key:"getGeometryFromBuffer",value:function(e){return this.normalize?p()(u()(t.prototype),"getGeometryFromBuffer",this).call(this,e):function(){return null}}},{key:"normalizeGeometry",value:function(e){return this.normalize?hr(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}},{key:"get",value:function(e){return this.attributes[e]}},{key:"getGeometrySize",value:function(e){if(Array.isArray(e[0])){var t=0,n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t+=this.getGeometrySize(s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}var l=this.getPathLength(e);return l<2?0:this.isClosed(e)?l<3?0:l+2:l}},{key:"updateGeometryAttributes",value:function(e,t){if(0!==t.geometrySize)if(e&&Array.isArray(e[0])){var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,l=this.getGeometrySize(s);t.geometrySize=l,this.updateGeometryAttributes(s,t),t.vertexStart+=l}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}},{key:"_updateSegmentTypes",value:function(e,t){var n=this.attributes.segmentTypes,r=this.isClosed(e),i=t.vertexStart,o=t.geometrySize;n.fill(0,i,i+o),r?(n[i]=4,n[i+o-2]=4):(n[i]+=1,n[i+o-2]+=2),n[i+o-1]=4}},{key:"_updatePositions",value:function(e,t){var n=this.attributes.positions;if(n)for(var r=t.vertexStart,i=t.geometrySize,o=new Array(3),a=r,s=0;s<i;a++,s++)this.getPointOnPath(e,s,o),n[3*a]=o[0],n[3*a+1]=o[1],n[3*a+2]=o[2]}},{key:"getPathLength",value:function(e){return e.length/this.positionSize}},{key:"getPointOnPath",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.positionSize;t*r>=e.length&&(t+=1-e.length/r);var i=t*r;return n[0]=e[i],n[1]=e[i+1],n[2]=3===r&&e[i+2]||0,n}},{key:"isClosed",value:function(e){if(!this.normalize)return this.opts.loop;var t=this.positionSize,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}]),t}(g.Tesselator),yr=[0,0,0,255],mr={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(e){return e.path}},getColor:{type:"accessor",value:yr},getWidth:{type:"accessor",value:1}},xr={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},br=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * jointType * 4.0 * flipIfTrue(isStartCap), isJoint);\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec2 width = project_pixel_size_to_clipspace(widthPixels);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      width\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    vec2 width = project_pixel_size(widthPixels);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (jointType > 0.0 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (jointType == 0.0 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.project32,g.picking]})}},{key:"initializeState",value:function(){var e=this;this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:xr,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:xr,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:xr,defaultValue:yr},instancePickingColors:{size:3,type:5121,accessor:function(t,n){var r=n.index,i=n.target;return e.encodePickingColor(t&&t.__source?t.__source.index:r,i)}}}),this.setState({pathTesselator:new vr({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&g.log.removed("getDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var n=e.oldProps,r=e.props,i=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:r,oldProps:n,changeFlags:i});var o=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){var a=this.state.pathTesselator,s=r.data.attributes||{};a.updateGeometry({data:r.data,geometryBuffer:s.getPath,buffers:s,normalize:!r._pathType,loop:"loop"===r._pathType,getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||o.invalidateAll()}if(i.extensionsChanged){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),o.invalidateAll()}}},{key:"getPickingInfo",value:function(e){var n=p()(u()(t.prototype),"getPickingInfo",this).call(this,e),r=n.index,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find((function(e){return e.__source.index===r}))),n}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.rounded,o=r.billboard,a=r.miterLimit,s=r.widthUnits,l=r.widthScale,c=r.widthMinPixels,u=r.widthMaxPixels,f="pixels"===s?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},t,{jointType:Number(i),billboard:o,widthScale:l*f,miterLimit:a,widthMinPixels:c,widthMaxPixels:u})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(e){var t=this.state.pathTesselator;e.startIndices=t.vertexStarts,e.value=t.get("positions")}},{key:"calculateSegmentTypes",value:function(e){var t=this.state.pathTesselator;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}},{key:"wrapLongitude",get:function(){return!1}}]),t}(g.Layer);br.layerName="PathLayer",br.defaultProps=mr;var wr=n(17),Pr=n.n(wr);function _r(e,t,n,r){for(var i=0;i<t;i++)if(e[n+i]!==e[r-t+i])return!1;return!0}function Sr(e,t,n,r){for(var i=t,o=n.length,a=0;a<o;a++)for(var s=0;s<r;s++)e[i++]=n[a][s]||0;if(!function(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(var l=0;l<r;l++)e[i++]=n[0][l]||0;return i}function Cr(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=(o=o||n.length)-i;if(a<=0)return t;for(var s=t,l=0;l<a;l++)e[s++]=n[i+l];if(!_r(n,r,i,o))for(var c=0;c<r;c++)e[s++]=n[i+c];return s}function Lr(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);var n=[],r=[];if(e.positions){var i=e,o=i.positions,a=i.holeIndices;if(a){for(var s=0,l=0;l<=a.length;l++)s=Cr(n,s,o,t,a[l-1],a[l]),r.push(s);return r.pop(),{positions:n,holeIndices:r}}e=o}if(Number.isFinite(e[0]))return Cr(n,0,e,t),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){var c=0,u=!0,f=!1,p=void 0;try{for(var d,h=e[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){c=Sr(n,c,d.value,t),r.push(c)}}catch(e){f=!0,p=e}finally{try{u||null==h.return||h.return()}finally{if(f)throw p}}return r.pop(),{positions:n,holeIndices:r}}return Sr(n,0,e,t),n}function kr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Or=function(e){function t(e){i()(this,t);var n=e.fp64,r=e.IndexType,o=void 0===r?Uint32Array:r;return l()(this,u()(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:o,size:1}}})))}return h()(t,e),a()(t,[{key:"get",value:function(e){var t=this.attributes;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}},{key:"updateGeometry",value:function(e){p()(u()(t.prototype),"updateGeometry",this).call(this,e);var n=this.buffers.indices;n&&(this.vertexCount=(n.value||n).length)}},{key:"normalizeGeometry",value:function(e){if(this.normalize){if(e=Lr(e,this.positionSize),this.opts.resolution)return or(e.positions||e,e.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.size,i=void 0===r?2:r,o=n.normalize,a=void 0===o||o,s=n.edgeTypes,l=void 0!==s&&s;t=t||[];for(var c=[],u=[],f=0,p=0,d=0;d<=t.length;d++){for(var h=t[d]||e.length,g=p,v=ur(e,i,f,h),y=v;y<h;y++)c[p++]=e[y];for(var m=f;m<v;m++)c[p++]=e[m];pr(c,i,g,p),fr(c,i,g,p,n.maxLatitude),f=h,u[d]=p}u.pop();var x=or(c,u,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:l});if(a){var b=!0,w=!1,P=void 0;try{for(var _,S=x[Symbol.iterator]();!(b=(_=S.next()).done);b=!0){var C=_.value;dr(C.positions,i)}}catch(e){w=!0,P=e}finally{try{b||null==S.return||S.return()}finally{if(w)throw P}}}return x}(e.positions||e,e.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return e}},{key:"getGeometrySize",value:function(e){if(Array.isArray(e)&&!Number.isFinite(e[0])){var t=0,n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t+=this.getGeometrySize(s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}return(e.positions||e).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(e){return this.normalize||!this.buffers.indices?p()(u()(t.prototype),"getGeometryFromBuffer",this).call(this,e):function(){return null}}},{key:"updateGeometryAttributes",value:function(e,t){if(Array.isArray(e)&&!Number.isFinite(e[0])){var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,l=this.getGeometrySize(s);t.geometrySize=l,this.updateGeometryAttributes(s,t),t.vertexStart+=l,t.indexStart=this.indexStarts[t.geometryIndex+1]}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}},{key:"_updateIndices",value:function(e,t){var n=t.geometryIndex,r=t.vertexStart,i=t.indexStart,o=this.attributes,a=this.indexStarts,s=this.typedArrayManager,l=o.indices;if(l){var c=i,u=function(e,t,n){var r=null;e.holeIndices&&(r=e.holeIndices.map((function(e){return e/t})));var i=e.positions||e;if(n){var o=i.length;i=i.slice();for(var a=[],s=0;s<o;s+=t){a[0]=i[s],a[1]=i[s+1];var l=n(a);i[s]=l[0],i[s+1]=l[1]}}return Pr()(i,r,t)}(e,this.positionSize,this.opts.preproject);l=s.allocate(l,i+u.length,{copy:!0});for(var f=0;f<u.length;f++)l[c++]=u[f]+r;a[n+1]=i+u.length,o.indices=l}}},{key:"_updatePositions",value:function(e,t){var n=t.vertexStart,r=t.geometrySize,i=this.attributes.positions,o=this.positionSize;if(i)for(var a=e.positions||e,s=n,l=0;l<r;s++,l++){var c=a[l*o],u=a[l*o+1],f=o>2?a[l*o+2]:0;i[3*s]=c,i[3*s+1]=u,i[3*s+2]=f}}},{key:"_updateVertexValid",value:function(e,t){var n=t.vertexStart,r=t.geometrySize,i=this.attributes.vertexValid,o=this.positionSize,a=e&&e.holeIndices;if(e&&e.edgeTypes?i.set(e.edgeTypes,n):i.fill(1,n,n+r),a)for(var s=0;s<a.length;s++)i[n+a[s]/o-1]=0;i[n+r-1]=0}}]),t}(g.Tesselator),Ar="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n    \n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",Mr="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(Ar,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),Er="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(Ar,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64Low = instancePositions64Low;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64Low = nextPositions64Low;\n\n  calculatePosition(props);\n}\n"),Tr=[0,0,0,255],Ir={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(e){return e.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Tr},getLineColor:{type:"accessor",value:Tr},material:!0},zr={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},jr=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(e){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:e,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{},modules:[g.project32,g.gouraudLighting,g.picking]})}},{key:"initializeState",value:function(){var e=this,t=this.context,n=t.gl,r=t.viewport,i=this.props.coordinateSystem;r.isGeospatial&&i===g.COORDINATE_SYSTEM.DEFAULT&&(i=g.COORDINATE_SYSTEM.LNGLAT),this.setState({numInstances:0,polygonTesselator:new Or({preproject:i===g.COORDINATE_SYSTEM.LNGLAT&&r.projectFlat,fp64:this.use64bitPositions(),IndexType:!n||Object(v.hasFeatures)(n,v.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var o=this.getAttributeManager();o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:zr,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:zr,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:zr,accessor:"getFillColor",defaultValue:Tr,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:zr,accessor:"getLineColor",defaultValue:Tr,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(t,n){var r=n.index,i=n.target;return e.encodePickingColor(t&&t.__source?t.__source.index:r,i)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(e){var n=p()(u()(t.prototype),"getPickingInfo",this).call(this,e),r=n.index,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find((function(e){return e.__source.index===r}))),n}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,r=n.extruded,i=n.filled,o=n.wireframe,a=n.elevationScale,s=this.state,l=s.topModel,c=s.sideModel,u=s.polygonTesselator,f=Object.assign({},t,{extruded:Boolean(r),elevationScale:a});c&&(c.setInstanceCount(u.instanceCount-1),c.setUniforms(f),o&&(c.setDrawMode(3),c.setUniforms({isWireframe:!0}).draw()),i&&(c.setDrawMode(6),c.setUniforms({isWireframe:!1}).draw())),l&&(l.setVertexCount(u.vertexCount),l.setUniforms(f).draw())}},{key:"updateState",value:function(e){p()(u()(t.prototype),"updateState",this).call(this,e),this.updateGeometry(e);var n=e.props,r=e.oldProps,i=e.changeFlags,o=this.getAttributeManager();(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&(this.state.models&&this.state.models.forEach((function(e){return e.delete()})),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(e){var t=e.props,n=(e.oldProps,e.changeFlags);if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){var r=this.state.polygonTesselator,i=t.data.attributes||{};r.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(e){var t,n,r=this.props,i=r.id,o=r.filled,a=r.extruded;if(o){var s=this.getShaders(Mr);s.defines.NON_INSTANCED_MODEL=1,t=new v.Model(e,Object.assign({},s,{id:"".concat(i,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return a&&((n=new v.Model(e,Object.assign({},this.getShaders(Er),{id:"".concat(i,"-side"),geometry:new v.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}))).userData.excludeAttributes={indices:!0}),{models:[n,t].filter(Boolean),topModel:t,sideModel:n}}},{key:"calculateIndices",value:function(e){var t=this.state.polygonTesselator;e.startIndices=t.indexStarts,e.value=t.get("indices")}},{key:"calculatePositions",value:function(e){var t=this.state.polygonTesselator;e.startIndices=t.vertexStarts,e.value=t.get("positions")}},{key:"calculateVertexValid",value:function(e){e.value=this.state.polygonTesselator.get("vertexValid")}},{key:"wrapLongitude",get:function(){return!1}}]),t}(g.Layer);function Fr(e){for(var t=e.data,n=e.getIndex,r=e.dataRange,i=e.replace,o=r.startRow,a=void 0===o?0:o,s=r.endRow,l=void 0===s?1/0:s,c=t.length,u=c,f=c,p=0;p<c;p++){var d=n(t[p]);if(u>p&&d>=a&&(u=p),d>=l){f=p;break}}for(var h=u,g=f-u!==i.length,v=g&&t.slice(f),y=0;y<i.length;y++)t[h++]=i[y];if(g){for(var m=0;m<v.length;m++)t[h++]=v[m];t.length=h}return{startRow:u,endRow:u+i.length}}jr.layerName="SolidPolygonLayer",jr.defaultProps=Ir;var Rr={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(e){return e.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},Dr=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&g.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var t=this,n=(e.oldProps,e.props,e.changeFlags),r=n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon);if(r&&Array.isArray(n.dataChanged)){var i=this.state.paths.slice(),o=n.dataChanged.map((function(e){return Fr({data:i,getIndex:function(e){return e.__source.index},dataRange:e,replace:t._getPaths(e)})}));this.setState({paths:i,pathsDiff:o})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props,n=t.data,r=t.getPolygon,i=t.positionFormat,o=t._normalize,a=[],s="XY"===i?2:3,l=e.startRow,c=e.endRow,u=Object(g.createIterable)(n,l,c),f=u.iterable,p=u.objectInfo,d=!0,h=!1,v=void 0;try{for(var y,m=f[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){var x=y.value;p.index++;var b=r(x,p);o&&(b=Lr(b,s));var w=b,P=w.holeIndices,_=b.positions||b;if(P)for(var S=0;S<=P.length;S++){var C=_.slice(P[S-1]||0,P[S]||_.length);a.push(this.getSubLayerRow({path:C},x,p.index))}else a.push(this.getSubLayerRow({path:_},x,p.index))}}catch(e){h=!0,v=e}finally{try{d||null==m.return||m.return()}finally{if(h)throw v}}return a}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e._dataDiff,r=e.stroked,i=e.filled,o=e.extruded,a=e.wireframe,s=e._normalize,l=e.elevationScale,c=e.transitions,u=e.positionFormat,f=this.props,p=f.lineWidthUnits,d=f.lineWidthScale,h=f.lineWidthMinPixels,g=f.lineWidthMaxPixels,v=f.lineJointRounded,y=f.lineMiterLimit,m=f.lineDashJustified,x=this.props,b=x.getFillColor,w=x.getLineColor,P=x.getLineWidth,_=x.getLineDashArray,S=x.getElevation,C=x.getPolygon,L=x.updateTriggers,k=x.material,O=this.state,A=O.paths,M=O.pathsDiff,E=this.getSubLayerClass("fill",jr),T=this.getSubLayerClass("stroke",br),I=this.shouldRenderSubLayer("fill",A)&&new E({_dataDiff:n,extruded:o,elevationScale:l,filled:i,wireframe:a,_normalize:s,getElevation:S,getFillColor:b,getLineColor:w,material:k,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:L.getPolygon,getElevation:L.getElevation,getFillColor:L.getFillColor,getLineColor:L.getLineColor}}),{data:t,positionFormat:u,getPolygon:C});return[!o&&I,!o&&r&&this.shouldRenderSubLayer("stroke",A)&&new T({_dataDiff:M&&function(){return M},widthUnits:p,widthScale:d,widthMinPixels:h,widthMaxPixels:g,rounded:v,miterLimit:y,dashJustified:m,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(w),getWidth:this.getSubLayerAccessor(P),getDashArray:this.getSubLayerAccessor(_)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:L.getLineWidth,getColor:L.getLineColor,getDashArray:L.getLineDashArray}}),{data:A,positionFormat:u,getPath:function(e){return e.path}}),o&&I]}}]),t}(g.CompositeLayer);function Wr(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=n.startRow,o=void 0===i?0:i,a=n.endRow,s=void 0===a?e.length:a,l=o;l<s;l++){var c=e[l];g.log.assert(c&&c.geometry,"GeoJSON does not have geometry");var u=c.geometry;if("GeometryCollection"===u.type){g.log.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");for(var f=u.geometries,p=0;p<f.length;p++){var d=f[p];Nr(d,r,t,c,l)}}else Nr(u,r,t,c,l)}return r}function Nr(e,t,n,r,i){var o=e.type,a=e.coordinates,s=t.pointFeatures,l=t.lineFeatures,c=t.polygonFeatures,u=t.polygonOutlineFeatures;if(function(e,t){var n=Gr[e];g.log.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(o,a))switch(o){case"Point":s.push(n({geometry:e},r,i));break;case"MultiPoint":a.forEach((function(e){s.push(n({geometry:{type:"Point",coordinates:e}},r,i))}));break;case"LineString":l.push(n({geometry:e},r,i));break;case"MultiLineString":a.forEach((function(e){l.push(n({geometry:{type:"LineString",coordinates:e}},r,i))}));break;case"Polygon":c.push(n({geometry:e},r,i)),a.forEach((function(e){u.push(n({geometry:{type:"LineString",coordinates:e}},r,i))}));break;case"MultiPolygon":a.forEach((function(e){c.push(n({geometry:{type:"Polygon",coordinates:e}},r,i)),e.forEach((function(e){u.push(n({geometry:{type:"LineString",coordinates:e}},r,i))}))}))}else g.log.warn("".concat(o," coordinates are malformed"))()}Dr.layerName="PolygonLayer",Dr.defaultProps=Rr;var Gr={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};var Ur={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusUnits:"meters",pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};function Vr(e){return e.geometry.coordinates}var Br=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={features:{}},this.props.getLineDashArray&&g.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var t=e.props,n=e.changeFlags;if(n.dataChanged){var r=function(e){if(Array.isArray(e))return e;switch(g.log.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return g.log.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data),i=this.getSubLayerRow.bind(this);if(Array.isArray(n.dataChanged)){var o=this.state.features,a={},s={};for(var l in o)a[l]=o[l].slice(),s[l]=[];var c=!0,u=!1,f=void 0;try{for(var p,d=n.dataChanged[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var h=p.value,v=Wr(r,i,h);for(var y in o)s[y].push(Fr({data:a[y],getIndex:function(e){return e.__source.index},dataRange:h,replace:v[y]}))}}catch(e){u=!0,f=e}finally{try{c||null==d.return||d.return()}finally{if(u)throw f}}this.setState({features:a,featuresDiff:s})}else this.setState({features:Wr(r,i),featuresDiff:{}})}}},{key:"renderLayers",value:function(){var e=this.state,t=e.features,n=e.featuresDiff,r=t.pointFeatures,i=t.lineFeatures,o=t.polygonFeatures,a=t.polygonOutlineFeatures,s=this.props,l=s.stroked,c=s.filled,u=s.extruded,f=s.wireframe,p=s.material,d=s.transitions,h=this.props,g=h.lineWidthUnits,v=h.lineWidthScale,y=h.lineWidthMinPixels,m=h.lineWidthMaxPixels,x=h.lineJointRounded,b=h.lineMiterLimit,w=h.pointRadiusUnits,P=h.pointRadiusScale,_=h.pointRadiusMinPixels,S=h.pointRadiusMaxPixels,C=h.elevationScale,L=h.lineDashJustified,k=this.props,O=k.getLineColor,A=k.getFillColor,M=k.getRadius,E=k.getLineWidth,T=k.getLineDashArray,I=k.getElevation,z=k.updateTriggers,j=this.getSubLayerClass("polygons-fill",jr),F=this.getSubLayerClass("polygons-stroke",br),R=this.getSubLayerClass("line-strings",br),D=this.getSubLayerClass("points",Bn),W=this.shouldRenderSubLayer("polygons-fill",o)&&new j({_dataDiff:n.polygonFeatures&&function(){return n.polygonFeatures},extruded:u,elevationScale:C,filled:c,wireframe:f,material:p,getElevation:this.getSubLayerAccessor(I),getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(O),transitions:d&&{getPolygon:d.geometry,getElevation:d.getElevation,getFillColor:d.getFillColor,getLineColor:d.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:z.getElevation,getFillColor:z.getFillColor,getLineColor:z.getLineColor}}),{data:o,getPolygon:Vr});return[!u&&W,!u&&l&&this.shouldRenderSubLayer("polygons-stroke",a)&&new F({_dataDiff:n.polygonOutlineFeatures&&function(){return n.polygonOutlineFeatures},widthUnits:g,widthScale:v,widthMinPixels:y,widthMaxPixels:m,rounded:x,miterLimit:b,dashJustified:L,getColor:this.getSubLayerAccessor(O),getWidth:this.getSubLayerAccessor(E),getDashArray:this.getSubLayerAccessor(T),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:z.getLineColor,getWidth:z.getLineWidth,getDashArray:z.getLineDashArray}}),{data:a,getPath:Vr}),this.shouldRenderSubLayer("linestrings",i)&&new R({_dataDiff:n.lineFeatures&&function(){return n.lineFeatures},widthUnits:g,widthScale:v,widthMinPixels:y,widthMaxPixels:m,rounded:x,miterLimit:b,dashJustified:L,getColor:this.getSubLayerAccessor(O),getWidth:this.getSubLayerAccessor(E),getDashArray:this.getSubLayerAccessor(T),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:z.getLineColor,getWidth:z.getLineWidth,getDashArray:z.getLineDashArray}}),{data:i,getPath:Vr}),this.shouldRenderSubLayer("points",r)&&new D({_dataDiff:n.pointFeatures&&function(){return n.pointFeatures},stroked:l,filled:c,radiusUnits:w,radiusScale:P,radiusMinPixels:_,radiusMaxPixels:S,lineWidthUnits:g,lineWidthScale:v,lineWidthMinPixels:y,lineWidthMaxPixels:m,getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(O),getRadius:this.getSubLayerAccessor(M),getLineWidth:this.getSubLayerAccessor(E),transitions:d&&{getPosition:d.geometry,getFillColor:d.getFillColor,getLineColor:d.getLineColor,getRadius:d.getRadius,getLineWidth:d.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:z.getFillColor,getLineColor:z.getLineColor,getRadius:z.getRadius,getLineWidth:z.getLineWidth}}),{data:r,getPosition:Vr,highlightedObjectIndex:this._getHighlightedIndex(r)}),u&&W]}},{key:"_getHighlightedIndex",value:function(e){var t=this.props.highlightedObjectIndex;return Number.isFinite(t)?e.findIndex((function(e){return e.__source.index===t})):null}}]),t}(g.CompositeLayer);Br.layerName="GeoJsonLayer",Br.defaultProps=Ur;var Hr=n(18),Zr=n.n(Hr),Kr=[],Jr=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return Object.assign({},p()(u()(t.prototype),"getShaders",this).call(this),{inject:{"vs:#decl":"\n  uniform float gamma;\n  varying float vGamma;\n","vs:#main-end":"\n  vGamma = gamma / (sizeScale * iconSize.y);\n"},fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float buffer;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform bool shouldDrawBackground;\nuniform vec3 backgroundColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    if (sdf) {\n      alpha = smoothstep(buffer - vGamma, buffer + vGamma, alpha);\n    }\n    float a = alpha * vColor.a;\n    \n    if (a < alphaCutoff) {\n      if (shouldDrawBackground) {\n        gl_FragColor = vec4(backgroundColor, vColor.a);\n      } else {\n        discard;\n      }\n    } else {\n      if (shouldDrawBackground) {\n        gl_FragColor = vec4(mix(backgroundColor, vColor.rgb, alpha), vColor.a * opacity);\n      } else {\n        gl_FragColor = vec4(vColor.rgb, a * opacity);\n      }\n      DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n    }\n  } else {\n    DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n  }\n}\n"})}},{key:"initializeState",value:function(){var e=this;p()(u()(t.prototype),"initializeState",this).call(this),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(t,n){var r=n.index,i=n.target;return e.encodePickingColor(r,i)}}})}},{key:"updateState",value:function(e){p()(u()(t.prototype),"updateState",this).call(this,e);var n=e.oldProps,r=e.props;if(r.backgroundColor!==n.backgroundColor){var i=Array.isArray(r.backgroundColor)?r.backgroundColor.map((function(e){return e/255})).slice(0,3):null;this.setState({backgroundColor:i})}}},{key:"draw",value:function(e){var n=e.uniforms,r=this.props.sdf,i=this.state.backgroundColor,o=Array.isArray(i);p()(u()(t.prototype),"draw",this).call(this,{uniforms:Object.assign({},n,{buffer:.75,gamma:.2,sdf:Boolean(r),backgroundColor:i||[0,0,0],shouldDrawBackground:o})})}},{key:"getInstanceOffset",value:function(e){var n=this;return e?Array.from(e).map((function(e){return p()(u()(t.prototype),"getInstanceOffset",n).call(n,e)})):Kr}},{key:"getInstanceColorMode",value:function(e){return 1}},{key:"getInstanceIconFrame",value:function(e){var n=this;return e?Array.from(e).map((function(e){return p()(u()(t.prototype),"getInstanceIconFrame",n).call(n,e)})):Kr}}]),t}(jn);Jr.layerName="MultiIconLayer",Jr.defaultProps={backgroundColor:{type:"color",value:null,optional:!0},getIconOffsets:{type:"accessor",value:function(e){return e.offsets}}};var Xr=n(19),qr=n.n(Xr);function Qr(e,t){for(var n=0,r=0;r<e.length;r++){var i=e[r],o=null,a=t&&t[i];a&&(o=a.width),n+=o}return n}function Yr(e,t,n){for(var r=[],i=0,o=0,a=0;a<e.length;a++){var s=Qr(e[a],n);o+s>t&&(i<a&&r.push(e.substring(i,a)),i=a,o=0),o+=s}return i<e.length&&r.push(e.substring(i)),{rows:r,lastRowStartCharIndex:i,lastRowOffsetLeft:o}}function $r(e,t,n,r){return"break-all"===t?Yr(e,n,r):function(e,t,n){for(var r=[],i=0,o=0,a=0,s=null,l=0;l<e.length;l++)if(" "===e[l]?(s=e[l],o=l+1):l+1<e.length&&" "===e[l+1]||l+1===e.length?(s=e.substring(o,l+1),o=l+1):s=null,s){var c=Qr(s,n);if(a+c>t){var u=o-s.length;if(i<u&&(r.push(e.substring(i,u)),i=u,a=0),c>t){var f=Yr(s,t,n);f.rows.length>1&&(r=r.concat(f.rows.slice(0,f.rows.length-1))),i+=f.lastRowStartCharIndex,c=f.lastRowOffsetLeft}}a+=c}return i<e.length&&r.push(e.substring(i)),{rows:r,lastRowStartCharIndex:i,lastRowOffsetLeft:a}}(e,n,r)}function ei(e,t){for(var n=0,r=0,i=new Array(e.length),o=0;o<e.length;o++){var a=e[o],s=t[a];s?(r||(r=s.height),i[o]=n+s.width/2,n+=s.width):(g.log.warn("Missing character: ".concat(a))(),i[o]=n,n+=32)}return{leftOffsets:i,rowWidth:n,rowHeight:r}}var ti=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;i()(this,e),this.limit=t,this.clear()}return a()(e,[{key:"clear",value:function(){this._cache={},this._order=[]}},{key:"get",value:function(e){var t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}},{key:"set",value:function(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}},{key:"delete",value:function(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}},{key:"_deleteCache",value:function(e){delete this._cache[e]}},{key:"_deleteOrder",value:function(e){var t=this._order.findIndex((function(t){return t===e}));t>=0&&this._order.splice(t,1)}},{key:"_appendOrder",value:function(e){this._order.push(e)}}]),e}();var ni=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),ri=new ti(3),ii=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function oi(e,t){var n=ri.get(e);if(!n)return t;var r=[],i=n.mapping,o=Object.keys(i);o=new Set(o);var a=t;return a instanceof Array&&(a=new Set(a)),a.forEach((function(e){o.has(e)||r.push(e)})),r}function ai(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function si(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}var li=function(){function e(t){i()(this,e),this.gl=t,this.props={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:ni,fontSize:64,buffer:2,sdf:!1,cutoff:.25,radius:3},this._key=null,this._texture=new v.Texture2D(this.gl)}return a()(e,[{key:"finalize",value:function(){this._texture.delete()}},{key:"setProps",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ii.forEach((function(n){n in t&&(e.props[n]=t[n])}));var n=this._key;this._key=this._getKey();var r=oi(this._key,this.props.characterSet),i=ri.get(this._key);if(i&&0===r.length)this._key!==n&&this._updateTexture(i);else{var o=this._generateFontAtlas(this._key,r,i);this._updateTexture(o),ri.set(this._key,o)}}},{key:"_updateTexture",value:function(e){var t,n=e.data,r=e.width,i=e.height;this._texture.width===r&&this._texture.height===i||this._texture.resize({width:r,height:i}),this._texture.setImageData({data:n,width:r,height:i,parameters:(t={},w()(t,10242,33071),w()(t,10243,33071),t)}),this._texture.generateMipmap()}},{key:"_generateFontAtlas",value:function(e,t,n){var r=this.props,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,l=r.sdf,c=r.radius,u=r.cutoff,f=n&&n.data;f||((f=document.createElement("canvas")).width=1024);var p=f.getContext("2d");si(p,i,a,o);var d=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,l=e.xOffset,c=void 0===l?0:l,u=e.yOffset,f=void 0===u?0:u,p=0,d=c,h=0,g=!0,v=!1,y=void 0;try{for(var m,x=t[Symbol.iterator]();!(g=(m=x.next()).done);g=!0){var b=m.value;if(!s[b]){var w=n(b,h++);d+w+2*i>o&&(d=0,p++),s[b]={x:d+i,y:f+p*(r+2*i)+i,width:w,height:r},d+=w+2*i}}}catch(e){v=!0,y=e}finally{try{g||null==x.return||x.return()}finally{if(v)throw y}}var P,_=r+2*i;return{mapping:s,xOffset:d,yOffset:f+p*_,canvasHeight:(P=f+(p+1)*_,Math.pow(2,Math.ceil(Math.log2(P))))}}(Object.assign({getFontWidth:function(e){return p.measureText(e).width},fontHeight:1.2*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),h=d.mapping,g=d.canvasHeight,v=d.xOffset,y=d.yOffset;if(f.height!==g){var m=p.getImageData(0,0,f.width,f.height);f.height=g,p.putImageData(m,0,0)}if(si(p,i,a,o),l){var x=new qr.a(a,s,c,u,i,o),b=p.getImageData(0,0,x.size,x.size),w=!0,P=!1,_=void 0;try{for(var S,C=t[Symbol.iterator]();!(w=(S=C.next()).done);w=!0){var L=S.value;ai(x.draw(L),b),p.putImageData(b,h[L].x-s,h[L].y-s)}}catch(e){P=!0,_=e}finally{try{w||null==C.return||C.return()}finally{if(P)throw _}}}else{var k=!0,O=!1,A=void 0;try{for(var M,E=t[Symbol.iterator]();!(k=(M=E.next()).done);k=!0){var T=M.value;p.fillText(T,h[T].x,h[T].y+.9*a)}}catch(e){O=!0,A=e}finally{try{k||null==E.return||E.return()}finally{if(O)throw A}}}return{xOffset:v,yOffset:y,mapping:h,data:f,width:f.width,height:f.height}}},{key:"_getKey",value:function(){var e=this.props,t=e.gl,n=e.fontFamily,r=e.fontWeight,i=e.fontSize,o=e.buffer,a=e.sdf,s=e.radius,l=e.cutoff;return a?"".concat(t," ").concat(n," ").concat(r," ").concat(i," ").concat(o," ").concat(s," ").concat(l):"".concat(t," ").concat(n," ").concat(r," ").concat(i," ").concat(o)}},{key:"texture",get:function(){return this._texture}},{key:"mapping",get:function(){var e=ri.get(this._key);return e&&e.mapping}},{key:"scale",get:function(){return 1.2}}]),e}();function ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ui={fontSize:64,buffer:2,sdf:!1,radius:3,cutoff:.25},fi={start:1,middle:0,end:-1},pi={top:1,center:0,bottom:-1},di=["fontSize","buffer","sdf","radius","cutoff"],hi={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,backgroundColor:{type:"color",value:null,optional:!0},characterSet:ni,fontFamily:"Monaco, monospace",fontWeight:"normal",lineHeight:1,fontSettings:{},wordBreak:"word-break",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(e){return e.text}},getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:[0,0,0,255]},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]}},gi=function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new li(this.context.gl)}}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps,r=e.changeFlags,i=this._fontChanged(n,t);i&&this._updateFontAtlas(n,t);var o=i||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),o&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.fontAtlasManager.finalize()}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.index>=0?this.props.data[t.index]:null})}},{key:"_updateFontAtlas",value:function(e,t){var n=t.characterSet,r=t.fontSettings,i=t.fontFamily,o=t.fontWeight;this.state.fontAtlasManager.setProps(Object.assign({},ui,r,{characterSet:n,fontFamily:i,fontWeight:o})),this.setNeedsRedraw(!0)}},{key:"_fontChanged",value:function(e,t){if(e.fontFamily!==t.fontFamily||e.characterSet!==t.characterSet||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;var n=e.fontSettings||{},r=t.fontSettings||{};return di.some((function(e){return n[e]!==r[e]}))}},{key:"_updateText",value:function(){var e,t=this.props.data,n=t.attributes&&t.attributes.getText,r=this.props.getText,i=t.startIndices;if(n&&i){var o=function(e){var t=e.value,n=e.length,r=e.stride,i=e.offset,o=e.startIndices,a=t.BYTES_PER_ELEMENT,s=r?r/a:1,l=i?i/a:0,c=o[n]||Math.floor((t.length-l-a)/s)+1,u=new Array(n),f=t;if(s>1||l>0){f=new t.constructor(c);for(var p=0;p<c;p++)f[p]=t[p*s+l]}for(var d=0;d<n;d++){var h=o[d],g=o[d+1]||c;u[d]=String.fromCodePoint.apply(null,f.subarray(h,g))}return{texts:u,characterCount:c}}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},ArrayBuffer.isView(n)?{value:n}:n,{length:t.length,startIndices:i})),a=o.texts;e=o.characterCount,r=function(e,t){var n=t.index;return a[n]}}else{var s=Object(g.createIterable)(t),l=s.iterable,c=s.objectInfo;i=[0],e=0;var u=!0,f=!1,p=void 0;try{for(var d,h=l[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var v=d.value;c.index++,e+=(r(v,c)||"").length,i.push(e)}}catch(e){f=!0,p=e}finally{try{u||null==h.return||h.return()}finally{if(f)throw p}}}this.setState({getText:r,startIndices:i,numInstances:e})}},{key:"getIconOffsets",value:function(e,t){var n=this.state.fontAtlasManager.mapping,r=this.state.getText,i=this.props,o=i.wordBreak,a=i.maxWidth,s=i.lineHeight,l=i.getTextAnchor,c=i.getAlignmentBaseline,u=r(e,t)||"",f=function(e,t,n,r,i){for(var o=new Array(e.length),a=("break-word"===n||"break-all"===n)&&isFinite(r)&&r>0,s=[0,0],l=0,c=0,u=0;u<=e.length;u++){var f=e[u],p=void 0;if("\n"!==f&&void 0!==f||(p=e.slice(c,u)),p){var d=a?$r(p,n,r,i).rows:[p],h=!0,g=!1,v=void 0;try{for(var y,m=d[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var x=ei(y.value,i),b=x.rowWidth,w=x.rowHeight,P=x.leftOffsets,_=!0,S=!1,C=void 0;try{for(var L,k=P[Symbol.iterator]();!(_=(L=k.next()).done);_=!0){var O=L.value;o[c++]={x:O,y:l+w/2,rowWidth:b}}}catch(e){S=!0,C=e}finally{try{_||null==k.return||k.return()}finally{if(S)throw C}}l+=w*t,s[0]=a?r:Math.max(s[0],b)}}catch(e){g=!0,v=e}finally{try{h||null==m.return||m.return()}finally{if(g)throw v}}}"\n"===f&&(o[c++]={x:0,y:0,rowWidth:0})}return s[1]=l,{characters:o,size:s}}(u,s,o,a,n),p=f.characters,d=Zr()(f.size,2),h=d[0],g=d[1],v=fi["function"==typeof l?l(e,t):l],y=pi["function"==typeof c?c(e,t):c],m=new Array(2*u.length),x=0,b=!0,w=!1,P=void 0;try{for(var _,S=p[Symbol.iterator]();!(b=(_=S.next()).done);b=!0){var C=_.value,L=C.rowWidth,k=C.x,O=C.y,A=(1-v)*(h-L)/2;m[x++]=(v-1)*h/2+A+k,m[x++]=(y-1)*g/2+O}}catch(e){w=!0,P=e}finally{try{b||null==S.return||S.return()}finally{if(w)throw P}}return m}},{key:"renderLayers",value:function(){var e=this.state,t=e.startIndices,n=e.numInstances,r=e.getText,i=e.fontAtlasManager,o=i.scale,a=i.texture,s=i.mapping,l=e.styleVersion,c=this.props,u=c.data,f=c._dataDiff,p=c.backgroundColor,d=c.getPosition,h=c.getColor,g=c.getSize,v=c.getAngle,y=c.getPixelOffset,m=c.billboard,x=c.sdf,b=c.sizeScale,w=c.sizeUnits,P=c.sizeMinPixels,_=c.sizeMaxPixels,S=c.transitions,C=c.updateTriggers,L=this.getIconOffsets.bind(this);return new(this.getSubLayerClass("characters",Jr))({sdf:x,iconAtlas:a,iconMapping:s,backgroundColor:p,getPosition:d,getColor:h,getSize:g,getAngle:v,getPixelOffset:y,billboard:m,sizeScale:b*o,sizeUnits:w,sizeMinPixels:P*o,sizeMaxPixels:_*o,transitions:S&&{getPosition:S.getPosition,getAngle:S.getAngle,getColor:S.getColor,getSize:S.getSize,getPixelOffset:C.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getPosition:C.getPosition,getAngle:C.getAngle,getColor:C.getColor,getSize:C.getSize,getPixelOffset:C.getPixelOffset,getIconOffsets:{getText:C.getText,getTextAnchor:C.getTextAnchor,getAlignmentBaseline:C.getAlignmentBaseline,styleVersion:l}}}),{data:u,_dataDiff:f,startIndices:t,numInstances:n,getIconOffsets:L,getIcon:r})}}]),t}(g.CompositeLayer);gi.layerName="TextLayer",gi.defaultProps=hi,n.d(t,"ArcLayer",(function(){return x})),n.d(t,"BitmapLayer",(function(){return z})),n.d(t,"IconLayer",(function(){return jn})),n.d(t,"LineLayer",(function(){return Rn})),n.d(t,"PointCloudLayer",(function(){return Gn})),n.d(t,"ScatterplotLayer",(function(){return Bn})),n.d(t,"ColumnLayer",(function(){return Qn})),n.d(t,"GridCellLayer",(function(){return Yn})),n.d(t,"PathLayer",(function(){return br})),n.d(t,"PolygonLayer",(function(){return Dr})),n.d(t,"GeoJsonLayer",(function(){return Br})),n.d(t,"TextLayer",(function(){return gi})),n.d(t,"SolidPolygonLayer",(function(){return jr})),n.d(t,"_MultiIconLayer",(function(){return Jr}))}])}));