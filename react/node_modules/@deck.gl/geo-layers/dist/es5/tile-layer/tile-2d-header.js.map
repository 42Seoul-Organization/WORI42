{"version":3,"sources":["../../../src/tile-layer/tile-2d-header.js"],"names":["Tile2DHeader","x","y","z","onTileLoad","onTileError","isVisible","isSelected","parent","children","content","_isLoaded","_isCancelled","getTileData","requestScheduler","bbox","scheduleRequest","tile","requestToken","tileData","error","done","_loader","_loadData","result","byteLength","Number","isFinite","log"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;IAEqBA,Y;AACnB,8BAAgD;AAAA,QAAnCC,CAAmC,QAAnCA,CAAmC;AAAA,QAAhCC,CAAgC,QAAhCA,CAAgC;AAAA,QAA7BC,CAA6B,QAA7BA,CAA6B;AAAA,QAA1BC,UAA0B,QAA1BA,UAA0B;AAAA,QAAdC,WAAc,QAAdA,WAAc;AAAA;AAC9C,SAAKJ,CAAL,GAASA,CAAT;AACA,SAAKC,CAAL,GAASA,CAAT;AACA,SAAKC,CAAL,GAASA,CAAT;AACA,SAAKG,SAAL,GAAiB,KAAjB;AACA,SAAKC,UAAL,GAAkB,KAAlB;AACA,SAAKC,MAAL,GAAc,IAAd;AACA,SAAKC,QAAL,GAAgB,EAAhB;AAEA,SAAKC,OAAL,GAAe,IAAf;AACA,SAAKC,SAAL,GAAiB,KAAjB;AACA,SAAKC,YAAL,GAAoB,KAApB;AAEA,SAAKR,UAAL,GAAkBA,UAAlB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACD;;;;;wGAsBeQ,W,EAAaC,gB;;;;;;AACpBb,gBAAAA,C,GAAiB,I,CAAjBA,C,EAAGC,C,GAAc,I,CAAdA,C,EAAGC,C,GAAW,I,CAAXA,C,EAAGY,I,GAAQ,I,CAARA,I;;uBAEWD,gBAAgB,CAACE,eAAjB,CAAiC,IAAjC,EAAuC,UAAAC,IAAI,EAAI;AACxE,yBAAOA,IAAI,CAACV,UAAL,GAAkB,CAAlB,GAAsB,CAAC,CAA9B;AACD,iBAF0B,C;;;AAArBW,gBAAAA,Y;;oBAIDA,Y;;;;;AACH,qBAAKN,YAAL,GAAoB,IAApB;;;;AAIF,qBAAKA,YAAL,GAAoB,KAApB;;;uBAImBC,WAAW,CAAC;AAACZ,kBAAAA,CAAC,EAADA,CAAD;AAAIC,kBAAAA,CAAC,EAADA,CAAJ;AAAOC,kBAAAA,CAAC,EAADA,CAAP;AAAUY,kBAAAA,IAAI,EAAJA;AAAV,iBAAD,C;;;AAA5BI,gBAAAA,Q;;;;;;;AAEAC,gBAAAA,KAAK,GAAG,eAAO,IAAf;;;;AAEAF,gBAAAA,YAAY,CAACG,IAAb;AACA,qBAAKV,SAAL,GAAiB,IAAjB;;;;AAGF,oBAAIS,KAAJ,EAAW;AACT,uBAAKf,WAAL,CAAiBe,KAAjB,EAAwB,IAAxB;AACD,iBAFD,MAEO;AACL,uBAAKV,OAAL,GAAeS,QAAf;AACA,uBAAKf,UAAL,CAAgB,IAAhB;AACD;;;;;;;;;;;;;;;;;;6BAGMS,W,EAAaC,gB,EAAkB;AACtC,UAAI,CAACD,WAAL,EAAkB;AAChB;AACD;;AAED,WAAKS,OAAL,GAAe,KAAKC,SAAL,CAAeV,WAAf,EAA4BC,gBAA5B,CAAf;AACD;;;wBA1DU;AACT,aAAO,KAAKH,SAAL,GAAiB,KAAKD,OAAtB,GAAgC,KAAKY,OAA5C;AACD;;;wBAEc;AACb,aAAO,KAAKX,SAAZ;AACD;;;wBAEiB;AAChB,aAAO,KAAKC,YAAZ;AACD;;;wBAEgB;AACf,UAAMY,MAAM,GAAG,KAAKd,OAAL,GAAe,KAAKA,OAAL,CAAae,UAA5B,GAAyC,CAAxD;;AACA,UAAI,CAACC,MAAM,CAACC,QAAP,CAAgBH,MAAhB,CAAL,EAA8B;AAC5BI,kBAAIR,KAAJ,CAAU,qCAAV;AACD;;AACD,aAAOI,MAAP;AACD","sourcesContent":["import {log} from '@deck.gl/core';\n\nexport default class Tile2DHeader {\n  constructor({x, y, z, onTileLoad, onTileError}) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.isVisible = false;\n    this.isSelected = false;\n    this.parent = null;\n    this.children = [];\n\n    this.content = null;\n    this._isLoaded = false;\n    this._isCancelled = false;\n\n    this.onTileLoad = onTileLoad;\n    this.onTileError = onTileError;\n  }\n\n  get data() {\n    return this._isLoaded ? this.content : this._loader;\n  }\n\n  get isLoaded() {\n    return this._isLoaded;\n  }\n\n  get isCancelled() {\n    return this._isCancelled;\n  }\n\n  get byteLength() {\n    const result = this.content ? this.content.byteLength : 0;\n    if (!Number.isFinite(result)) {\n      log.error('byteLength not defined in tile data')();\n    }\n    return result;\n  }\n\n  async _loadData(getTileData, requestScheduler) {\n    const {x, y, z, bbox} = this;\n\n    const requestToken = await requestScheduler.scheduleRequest(this, tile => {\n      return tile.isSelected ? 1 : -1;\n    });\n\n    if (!requestToken) {\n      this._isCancelled = true;\n      return;\n    }\n\n    this._isCancelled = false;\n    let tileData;\n    let error;\n    try {\n      tileData = await getTileData({x, y, z, bbox});\n    } catch (err) {\n      error = err || true;\n    } finally {\n      requestToken.done();\n      this._isLoaded = true;\n    }\n\n    if (error) {\n      this.onTileError(error, this);\n    } else {\n      this.content = tileData;\n      this.onTileLoad(this);\n    }\n  }\n\n  loadData(getTileData, requestScheduler) {\n    if (!getTileData) {\n      return;\n    }\n\n    this._loader = this._loadData(getTileData, requestScheduler);\n  }\n}\n"],"file":"tile-2d-header.js"}