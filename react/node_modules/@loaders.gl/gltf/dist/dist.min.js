!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";(function(e,n){r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a}));const s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document},i=s.global||s.self||s.window,o="object"!=typeof n||"[object process]"!==String(n)||n.browser,a="function"==typeof importScripts,u=void 0!==n&&n.version&&n.version.match(/v([0-9]*)/);u&&parseFloat(u[1])}).call(this,r(3),r(6))},,function(e,t,r){"use strict";(function(e,n){r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return o}));const s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document},i=s.global||s.self||s.window,o="object"!=typeof n||"[object process]"!==String(n)||n.browser,a=void 0!==n&&n.version&&n.version.match(/v([0-9]*)/);a&&parseFloat(a[1])}).call(this,r(3),r(6))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){},,function(e,t){var r,n,s=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u,c=[],f=!1,d=-1;function l(){f&&u&&(f=!1,u.length?c=u.concat(c):d=-1,c.length&&h())}function h(){if(!f){var e=a(l);f=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,f=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new g(e,t)),1!==c.length||f||a(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,r){(function(t){const n=r(8),s="undefined"==typeof window?t:window;s.loaders=s.loaders||{},e.exports=Object.assign(s.loaders,n)}).call(this,r(3))},function(e,t,r){"use strict";r.r(t),r.d(t,"KHR_DRACO_MESH_COMPRESSION",(function(){return a})),r.d(t,"UBER_POINT_CLOUD_EXTENSION",(function(){return u})),r.d(t,"GLTFLoader",(function(){return Se})),r.d(t,"GLTFWriter",(function(){return De})),r.d(t,"GLBLoader",(function(){return Pe})),r.d(t,"GLBWriter",(function(){return Ge})),r.d(t,"GLTFScenegraph",(function(){return ie})),r.d(t,"postProcessGLTF",(function(){return Ie})),r.d(t,"GLBBuilder",(function(){return qe})),r.d(t,"encodeGLTFSync",(function(){return ke}));var n={};r.r(n),r.d(n,"decode",(function(){return ae})),r.d(n,"encode",(function(){return ue}));var s={};r.r(s),r.d(s,"decode",(function(){return de})),r.d(s,"encode",(function(){return le}));var i={};r.r(i),r.d(i,"decode",(function(){return he})),r.d(i,"encode",(function(){return ge}));var o={};r.r(o),r.d(o,"decode",(function(){return me})),r.d(o,"encode",(function(){return be}));const a="KHR_draco_mesh_compression",u="UBER_draco_point_cloud_compression";function c(e,t){if(!e)throw new Error(t)}var f=r(2);const{_parseImageNode:d}=f.a,l="undefined"!=typeof Image,h="undefined"!=typeof ImageBitmap,g=Boolean(d),m=!!f.b||g;function b(e){const t=y(e);if(!t)throw new Error("Not an image");return t}function y(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}const p=/^data:image\/svg\+xml/,w=/\.svg((\?|#).*)?$/;function A(e){return e&&(p.test(e)||w.test(e))}function T(e,t){if(A(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function x(e,t,r){const n=function(e,t){if(A(t)){const t=(new TextDecoder).decode(e);return"data:image/svg+xml;base64,"+btoa(t)}return T(e,t)}(e,r),s=self.URL||self.webkitURL,i="string"!=typeof n&&s.createObjectURL(n);try{return await async function(e,t){const r=new Image;if(r.src=e,t.image&&t.image.decode&&r.decode)return await r.decode(),r;return await new Promise((t,n)=>{try{r.onload=()=>t(r),r.onerror=t=>n(new Error(`Could not load image ${e}: ${t}`))}catch(e){n(e)}})}(i||n,t)}finally{i&&s.revokeObjectURL(i)}}const j={};let _=!0;async function v(e,t,r){let n;if(A(r)){n=await x(e,t,r)}else n=T(e,r);const s=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||j)return!0;return!1}(t)&&_||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),_=!1}return await createImageBitmap(e)}(n,s)}function E(e){const t=O(e);return function(e){const t=O(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,!1)))return null;return{mimeType:"image/png",width:t.getUint32(16,!1),height:t.getUint32(20,!1)}}(t)||function(e){const t=O(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:n}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let s=2;for(;s+9<t.byteLength;){const e=t.getUint16(s,!1);if(n.has(e))return{mimeType:"image/jpeg",height:t.getUint16(s+5,!1),width:t.getUint16(s+7,!1)};if(!r.has(e))return null;s+=2,s+=t.getUint16(s,!1)}return null}(t)||function(e){const t=O(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,!1)))return null;return{mimeType:"image/gif",width:t.getUint16(6,!0),height:t.getUint16(8,!0)}}(t)||function(e){const t=O(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,!1)&&t.getUint32(2,!0)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}(t)}function O(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}var U={id:"image",name:"Images",version:"2.2.7",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vndmicrosofticon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){const n=((t=t||{}).image||{}).type||"auto",{url:s}=r||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(h)return"imagebitmap";if(l)return"image";if(m)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return h||l||m;case"imagebitmap":return h;case"image":return l;case"data":return m;case"html":return l;case"ndarray":return m;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":i=await v(e,t,s);break;case"image":i=await x(e,t,s);break;case"data":i=await function(e,t){const{mimeType:r}=E(e)||{},{_parseImageNode:n}=f.a;return c(n),n(e,r,t)}(e,t);break;default:c(!1)}return"data"===n&&(i=function(e){switch(b(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.drawImage(e,0,0);return r.getImageData(0,0,e.width,e.height);default:return c(!1)}}(i)),i},test:e=>Boolean(E(new DataView(e))),options:{image:{type:"auto",decode:!0}}};function R(e,t,r){if(e.byteLength<=t+r)return"";const n=new DataView(e);let s="";for(let e=0;e<r;e++)s+=String.fromCharCode(n.getUint8(t+e));return s}function I(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return R(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return R(e,0,t)}return""}(e)}"`)}}function B(e){return e+3&-4}function L(e,t,r){const n=r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function V(e,t,r){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const t=e.byteOffset,r=e.byteLength;n=new Uint8Array(e.buffer,t,r)}return t.set(n,r),r+B(n.byteLength)}function S(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function C(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url "+e);return r.substr(0,r.lastIndexOf("/")+1)+e}function M(e,t,r){const n=e.bufferViews[r];S(n);const s=t[n.buffer];S(s);const i=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,n.byteLength)}var F=r(0),k=r(4);function D(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const P={};async function N(e,t=null,r={}){return t&&(e=function(e,t,r){const n=r.modules||{};if(n[e])return n[e];if(!F.b)return`modules/${t}/dist/libs/${e}`;if(r.CDN)return D(r.CDN.startsWith("http")),`${r.CDN}/${t}@2.2.7/dist/libs/${e}`;if(F.c)return"../src/libs/"+e;return`modules/${t}/src/libs/${e}`}(e,t,r)),P[e]=P[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!F.b)return Object(k.requireFromFile)(e);if(F.c)return importScripts(e);const t=await fetch(e);return function(e,t){if(!F.b)return Object(k.requireFromString)(e,t);if(F.c)return eval.call(F.a,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await t.text(),e)}(e),await P[e]}let G;async function q(e){const t=e.modules||{};return t.draco3d?{draco:t.draco3d.createDecoderModule()}:(G=G||async function(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await N("draco_decoder.js","draco",e);break;case"wasm":default:[t,r]=await Promise.all([await N("draco_wasm_wrapper.js","draco",e),await N("draco_decoder.wasm","draco",e)])}return t=t||F.a.DracoDecoderModule,await function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise(t=>{e({...r,onModuleLoaded:e=>t({draco:e})})})}(t,r)}(e),await G)}function H(e){if(!e||!e.POSITION)return null;let t=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0;const a=e.POSITION.value,u=a&&a.length;if(!u)return null;for(let e=0;e<u;e+=3){const u=a[e],c=a[e+1],f=a[e+2];t=u<t?u:t,r=c<r?c:r,n=f<n?f:n,s=u>s?u:s,i=c>i?c:i,o=f>o?f:o}return[[t,r,n],[s,i,o]]}const z=0,K=1,$={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},W={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class X{constructor(e){this.draco=e,this.drawMode="TRIANGLE"}destroy(){}destroyGeometry(e){e&&this.draco.destroy(e.dracoGeometry)}parseSync(e,t){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength);const n=new this.draco.Decoder,s={};let i,o,a;try{const e=n.GetEncodedGeometryType(r);switch(e){case this.draco.TRIANGULAR_MESH:o=new this.draco.Mesh,i=n.DecodeBufferToMesh(r,o),a={type:z,faceCount:o.num_faces(),attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;case this.draco.POINT_CLOUD:o=new this.draco.PointCloud,i=n.DecodeBufferToPointCloud(r,o),a={type:K,attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!i.ok()||!o.ptr){const e="DRACO decompression failed: "+i.error_msg();throw o&&this.draco.destroy(o),new Error(e)}s.loaderData={header:a},this.extractDRACOGeometry(n,o,e,s),s.header={vertexCount:a.vertexCount,boundingBox:H(s.attributes)}}finally{this.draco.destroy(n),this.draco.destroy(r)}return s}extractDRACOGeometry(e,t,r,n){const s=this.getAttributes(e,t),i=s.POSITION;if(!i)throw new Error("DRACO decompressor: No position attribute found.");return this.getPositionAttributeMetadata(i),r===this.draco.TRIANGULAR_MESH?(s.indices="TRIANGLE_STRIP"===this.drawMode?this.getMeshStripIndices(e,t):this.getMeshFaceIndices(e,t),n.mode="TRIANGLE_STRIP"===this.drawMode?5:4):n.mode=0,s.indices&&(n.indices={value:s.indices,size:1},delete s.indices),n.attributes=s,n}getPositionAttributeMetadata(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};const t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(let e=0;e<3;++e)this.metadata.attributes.position.minValues[e]=t.min_value(e)}this.draco.destroy(t)}getAttributes(e,t){const r={},n=t.num_points();for(const s in $){const i=this.draco[s],o=e.GetAttributeId(t,i);if(-1!==o){const i=e.GetAttribute(t,o),{typedArray:a}=this.getAttributeTypedArray(e,t,i,s);r[$[s]]={value:a,size:a.length/n}}}return r}getMeshFaceIndices(e,t){const r=t.num_faces(),n=new Uint32Array(3*r),s=new this.draco.DracoInt32Array;for(let i=0;i<r;++i){e.GetFaceFromMesh(t,i,s);const r=3*i;n[r]=s.GetValue(0),n[r+1]=s.GetValue(1),n[r+2]=s.GetValue(2)}return this.draco.destroy(s),n}getMeshStripIndices(e,t){const r=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,r);const n=new Uint32Array(r.size());for(let e=0;e<r.size();++e)n[e]=r.GetValue(e);return this.draco.destroy(r),n}getAttributeTypedArray(e,t,r,n){if(0===r.ptr){throw new Error("DRACO decode bad attribute "+n)}const s=W[r.data_type()],i=r.num_components(),o=t.num_points()*i;let a,u;switch(s){case Float32Array:a=new this.draco.DracoFloat32Array,e.GetAttributeFloatForAllPoints(t,r,a),u=new Float32Array(o);break;case Int8Array:a=new this.draco.DracoInt8Array,e.GetAttributeInt8ForAllPoints(t,r,a),u=new Int8Array(o);break;case Int16Array:a=new this.draco.DracoInt16Array,e.GetAttributeInt16ForAllPoints(t,r,a),u=new Int16Array(o);break;case Int32Array:a=new this.draco.DracoInt32Array,e.GetAttributeInt32ForAllPoints(t,r,a),u=new Int32Array(o);break;case Uint8Array:a=new this.draco.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(t,r,a),u=new Uint8Array(o);break;case Uint16Array:a=new this.draco.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(t,r,a),u=new Uint16Array(o);break;case Uint32Array:a=new this.draco.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(t,r,a),u=new Uint32Array(o);break;default:throw new Error("DRACO decoder: unexpected attribute type.")}for(let e=0;e<o;e++)u[e]=a.GetValue(e);return this.draco.destroy(a),{typedArray:u,components:i}}decode(e,t){return this.parseSync(e,t)}}const J={...{id:"draco",name:"Draco",version:"2.2.7",extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,test:"DRACO",options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",workerUrl:"https://unpkg.com/@loaders.gl/draco@2.2.7/dist/draco-loader.worker.js",localWorkerUrl:"modules/draco/dist/draco-loader.worker.dev.js"}}},parse:async function(e,t,r,n){const{draco:s}=await q(t),i=new X(s);try{return i.parseSync(e)}finally{i.destroy()}}};const Q=["SCALAR","VEC2","VEC3","VEC4"],Y=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),Z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ee={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},te={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function re(e){return Q[e-1]||Q[0]}function ne(e){const t=Y.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function se(e,t){const r=te[e.componentType],n=Z[e.type],s=ee[e.componentType],i=e.count*n,o=e.count*n*s;return S(o>=0&&o<=t.byteLength),{ArrayType:r,length:i,byteLength:o}}class ie{constructor(e){if(e instanceof ie)return e;e||(e={json:{version:2,buffers:[]},buffers:[]}),this.gltf=e,S(this.gltf.json)}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(t=>t===e),r=this.json.extensions||{};return t?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getCamera(e){return null}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];S(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,{ArrayType:n,length:s}=se(e,t);return new n(r,t.byteOffset+e.byteOffset,s)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(r,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return S(r),e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}removeObjectExtension(e,t){return delete(e.extensions||{})[t],this}addExtension(e,t={}){return S(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return S(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setObjectExtension(e,t,r){(e.extensions||{})[t]=r}addMesh(e,t,r=4){const n={primitives:[{attributes:this._addAttributes(e),indices:t,mode:r}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){t=t||function(e){const t=E(e);return t?t.mimeType:null}(e);const r={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){const t=e.byteLength;S(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=B(t),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:re(t.size),componentType:t.componentType,count:t.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const r=this.addBufferView(e),n={size:t.size,componentType:ne(e),count:Math.round(e.length/t.size)};return this.addAccessor(r,Object.assign(n,t))}createBinaryChunk(){if(this.arrayBuffer)return;const e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t);let n=0;for(let e=0;e<this.sourceBuffers.length;e++){n=V(this.sourceBuffers[e],r,n)}this.json.buffers[0].byteLength=e,this.arrayBuffer=t,this.sourceBuffers=[]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}}function oe(e,t){const{buffer:r,size:n,count:s}=function(e,t){let r=e,n=1,s=0;e&&e.value&&(r=e.value,n=e.size||1);r&&(ArrayBuffer.isView(r)||(r=function(e,t,r=!1){if(!e)return null;if(Array.isArray(e))return new t(e);if(r&&!(e instanceof t))return new t(e);return e}(r,Float32Array)),s=r.length/n);return{buffer:r,size:n,count:s}}(e);return{value:r,size:n,bufferView:null,byteOffset:0,count:s,type:re(n),componentType:ne(r)}}async function ae(e,t,r){if(!t.gltf.decompressMeshes)return;const n=new ie(e),s=[];for(const e of function*(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}(n))n.getObjectExtension(e,a)&&s.push(ce(e,n,t,r));await Promise.all(s),n.removeExtension(a)}function ue(e,t={}){const r=new ie(e);for(const e of r.json.meshes||[])fe(e,t),r.addRequiredExtension(a)}async function ce(e,t,r,n){const s=t.getObjectExtension(e,a),i=t.getTypedArrayForBufferView(s.bufferView),o=L(i.buffer,i.byteOffset),{parse:u}=n,c=await u(o,J,r,n);e.attributes=function(e){const t={};for(const r in e){const n=e[r];if("indices"!==r){const e=oe(n);t[r]=e}}return t}(c.attributes),c.indices&&(e.indices=oe(c.indices)),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(e)}function fe(e,t,r=4,n,s){if(!n.DracoWriter||!n.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");const i=n.DracoWriter.encodeSync({attributes:e}),{parseSync:o}=s,u=o({attributes:e}),c=n._addFauxAttributes(u.attributes),f=n.addBufferView(i);return{primitives:[{attributes:c,mode:r,extensions:{[a]:{bufferView:f,attributes:c}}}]}}function de(e,t){const r=new ie(e),{json:n}=r,s=r.getExtension("KHR_lights_punctual");s&&(r.json.lights=s.lights,r.removeExtension("KHR_lights_punctual"));for(const e of n.nodes||[]){const t=r.getObjectExtension(e,"KHR_lights_punctual");t&&(e.light=t.light),r.removeObjectExtension(e,"KHR_lights_punctual")}}function le(e,t){const r=new ie(e),{json:n}=r;if(n.lights){const e=r.addExtension("KHR_lights_punctual");S(!e.lights),e.lights=n.lights,delete n.lights}if(r.json.lights){for(const e of r.json.lights){const t=e.node;r.addObjectExtension(t,"KHR_lights_punctual",e)}delete r.json.lights}}function he(e,t){const r=new ie(e),{json:n}=r;r.removeExtension("KHR_materials_unlit");for(const e of n.materials||[]){e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),r.removeObjectExtension(e,"KHR_materials_unlit")}}function ge(e,t){const r=new ie(e),{json:n}=r;if(r.materials)for(const e of n.materials)e.unlit&&(delete e.unlit,r.addObjectExtension(e,"KHR_materials_unlit"),r.addExtension("KHR_materials_unlit"))}function me(e,t){const r=new ie(e),{json:n}=r,s=r.getExtension("KHR_techniques_webgl");if(s){const e=function({programs:e=[],shaders:t=[],techniques:r=[]},n){const s=new TextDecoder;return t.forEach(e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=s.decode(n.getTypedArrayForBufferView(e.bufferView))}),e.forEach(e=>{e.fragmentShader=t[e.fragmentShader],e.vertexShader=t[e.vertexShader]}),r.forEach(t=>{t.program=e[t.program]}),r}(s,r);for(const t of n.materials||[]){const n=r.getObjectExtension(t,"KHR_techniques_webgl");n&&(t.technique=Object.assign({},n,e[n.technique]),t.technique.values=ye(t.technique,r)),r.removeObjectExtension(t,"KHR_techniques_webgl")}r.removeExtension("KHR_techniques_webgl")}}function be(e,t){}function ye(e,t){const r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(t=>{e.uniforms[t].value&&!(t in r)&&(r[t]=e.uniforms[t].value)}),Object.keys(r).forEach(e=>{"object"==typeof r[e]&&void 0!==r[e].index&&(r[e].texture=t.getTexture(r[e].index))}),r}const pe={KHR_draco_mesh_compression:n,KHR_lights_punctual:s,KHR_materials_unlit:i,KHR_techniques_webgl:o};const we=1735152710;function Ae(e,t=0,r={}){const n=new DataView(e),{magic:s=we}=r,i=n.getUint32(t,!1);return i===s||i===we}function Te(e,t,r=0,n={}){const s=new DataView(t);e.type=function(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(s,r+0),e.version=s.getUint32(r+4,!0);const i=s.getUint32(r+8,!0);return e.header={byteOffset:r,byteLength:i},D(2===e.version,`Invalid GLB version ${e.version}. Only supports v2.`),D(e.header.byteLength>20),e.json={},e.binChunks=[],function(e,t,r,n){for(;r+8<=e.header.byteLength;){const s=t.getUint32(r+0,!0),i=t.getUint32(r+4,!0);switch(r+=8,i){case 1313821514:xe(e,t,r,s,n);break;case 5130562:je(e,t,r,s,n);break;case 0:n.glb.strict||xe(e,t,r,s,n);break;case 1:n.glb.strict||je(e,t,r,s,n)}r+=B(s)}}(e,s,r+12,n),r+e.header.byteLength}function xe(e,t,r,n,s){const i=new Uint8Array(t.buffer,r,n),o=new TextDecoder("utf8").decode(i);e.json=JSON.parse(o)}function je(e,t,r,n,s){e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer})}const _e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ve={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ee={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Oe={magFilter:Ee.TEXTURE_MAG_FILTER,minFilter:Ee.TEXTURE_MIN_FILTER,wrapS:Ee.TEXTURE_WRAP_S,wrapT:Ee.TEXTURE_WRAP_T},Ue={[Ee.TEXTURE_MAG_FILTER]:Ee.LINEAR,[Ee.TEXTURE_MIN_FILTER]:Ee.NEAREST_MIPMAP_LINEAR,[Ee.TEXTURE_WRAP_S]:Ee.REPEAT,[Ee.TEXTURE_WRAP_]:Ee.REPEAT};class Re{postProcess(e,t={}){const{json:r,buffers:n=[],images:s=[],baseUri:i=""}=e;return S(r),this.baseUri=i,this.json=r,this.buffers=n,this.images=s,this._resolveTree(this.json,t),this.json}_resolveTree(e,t={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map((e,t)=>this._resolveBufferView(e,t))),e.images&&(e.images=e.images.map((e,t)=>this._resolveImage(e,t))),e.samplers&&(e.samplers=e.samplers.map((e,t)=>this._resolveSampler(e,t))),e.textures&&(e.textures=e.textures.map((e,t)=>this._resolveTexture(e,t))),e.accessors&&(e.accessors=e.accessors.map((e,t)=>this._resolveAccessor(e,t))),e.materials&&(e.materials=e.materials.map((e,t)=>this._resolveMaterial(e,t))),e.meshes&&(e.meshes=e.meshes.map((e,t)=>this._resolveMesh(e,t))),e.nodes&&(e.nodes=e.nodes.map((e,t)=>this._resolveNode(e,t))),e.skins&&(e.skins=e.skins.map((e,t)=>this._resolveSkin(e,t))),e.scenes&&(e.scenes=e.scenes.map((e,t)=>this._resolveScene(e,t))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if("object"==typeof t)return t;const r=this.json[e]&&this.json[e][t];return r||console.warn(`glTF file error: Could not find ${e}[${t}]`),r}_resolveScene(e,t){return e.id=e.id||"scene-"+t,e.nodes=(e.nodes||[]).map(e=>this.getNode(e)),e}_resolveNode(e,t){return e.id=e.id||"node-"+t,e.children&&(e.children=e.children.map(e=>this.getNode(e))),void 0!==e.mesh&&(e.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-"+t,e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-"+t,e.primitives&&(e.primitives=e.primitives.map(e=>{const t=(e={...e}).attributes;e.attributes={};for(const r in t)e.attributes[r]=this.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-"+t,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){var r,n;if(e.id=e.id||"accessor-"+t,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(r=e.componentType,ve[r]),e.components=(n=e.type,_e[n]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:r,length:n}=se(e,e.bufferView),s=(e.bufferView.byteOffset||0)+t.byteOffset;e.value=new r(t.arrayBuffer,s,n)}return e}_resolveTexture(e,t){return e.id=e.id||"texture-"+t,e.sampler="sampler"in e?this.getSampler(e.sampler):Ue,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-"+t,e.parameters={};for(const t in e){const r=this._enumSamplerParameter(t);void 0!==r&&(e.parameters[r]=e[t])}return e}_enumSamplerParameter(e){return Oe[e]}_resolveImage(e,t){e.id=e.id||"image-"+t,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[t];return r&&(e.image=r),e}_resolveBufferView(e,t){e.id=e.id||"bufferView-"+t;const r=e.buffer;e.buffer=this.buffers[r];const n=this.buffers[r].arrayBuffer;let s=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(s+=e.byteOffset),e.data=new Uint8Array(n,s,e.byteLength),e}_resolveCamera(e,t){return e.id=e.id||"camera-"+t,e.perspective,e.orthographic,e}}function Ie(e,t){return(new Re).postProcess(e,t)}async function Be(e,t,r=0,n,s){!function(e,t,r,n){n.uri&&(e.baseUri=n.uri);if(t instanceof ArrayBuffer&&!Ae(t,r,n)){const e=new TextDecoder;t=e.decode(t)}if("string"==typeof t)e.json=I(t);else if(t instanceof ArrayBuffer){const s={};r=Te(s,t,r,n),S("glTF"===s.type,"Invalid GLB magic string "+s.type),e._glb=s,e.json=s.json}else S(!1,"GLTF: must be ArrayBuffer or string");const s=e.json.buffers||[];if(e.buffers=new Array(s.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const i=e.json.images||[];e.images=new Array(i.length).fill({})}(e,t,r,n);const i=[];if(n.gltf.loadImages){const t=async function(e,t,r){const n=e.json.images||[],s=[];for(let i=0;i<n.length;++i)s.push(Le(e,n[i],i,t,r));return await Promise.all(s)}(e,n,s);i.push(t)}n.gltf.loadBuffers&&await async function(e,t,r){for(let n=0;n<e.json.buffers.length;++n){const s=e.json.buffers[n];if(s.uri){const{fetch:i}=r;S(i);const o=C(s.uri,t),a=await i(o),u=await a.arrayBuffer();e.buffers[n]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete s.uri}}}(e,n,s);const o=async function(e,t={},r){t.gltf=t.gltf||{};for(const n in pe){const s=t.gltf.excludeExtensions||{};if(!(n in s&&!s[n])){const s=pe[n];await s.decode(e,t,r)}}}(e,n,s);return i.push(o),await Promise.all(i),n.gltf.postProcess?Ie(e,n):e}async function Le(e,t,r,n,s){const{fetch:i,parse:o}=s;let a;if(t.uri){const e=C(t.uri,n),r=await i(e);a=await r.arrayBuffer()}if(Number.isFinite(t.bufferView)){const r=M(e.json,e.buffers,t.bufferView);a=L(r.buffer,r.byteOffset,r.byteLength)}S(a,"glTF image has no data");const u=await o(a,U,{},s);e.images[r]=u}const Ve={id:"gltf",name:"glTF",version:"2.2.7",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,test:"glTF",parse:async function(e,t={},r){(t={...Ve.options,...t}).gltf={...Ve.options.gltf,...t.gltf},function(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages);"createImages"in e&&(e.gltf.loadImages=e.createImages);"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources);"decompress"in e&&(e.gltf.decompressMeshes=e.decompress);"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress);"postProcess"in e&&(e.gltf.postProcess=e.postProcess)}(t);const{byteOffset:n=0}=t;return await Be({},e,n,t,r)},options:{gltf:{loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};var Se=Ve;function Ce(e,t,r){const n=B(r.byteLength),s=n-r.byteLength;if(e){const n=new Uint8Array(e.buffer,e.byteOffset+t,r.byteLength),i=new Uint8Array(r);n.set(i);for(let n=0;n<s;++n)e.setUint8(t+r.byteLength+n,32)}return t+=n}const Me=1179937895;function Fe(e,t,r=0,n={}){const{magic:s=Me,version:i=2,json:o={},binary:a}=e,u=r;t&&(t.setUint32(r+0,s,!0),t.setUint32(r+4,i,!0),t.setUint32(r+8,0,!0));const c=r+8,f=r+=12;t&&(t.setUint32(r+0,0,!0),t.setUint32(r+4,1313821514,!0));if(r=function(e,t,r){return t=Ce(e,t,(new TextEncoder).encode(r))}(t,r+=8,JSON.stringify(o)),t){const e=r-f-8;t.setUint32(f+0,e,!0)}if(a){const e=r;if(t&&(t.setUint32(r+0,0,!0),t.setUint32(r+4,5130562,!0)),r=Ce(t,r+=8,a),t){const n=r-e-8;t.setUint32(e+0,n,!0)}}if(t){const e=r-u;t.setUint32(c,e,!0)}return r}function ke(e,t,r,n){return function(e,{firstBuffer:t=0}={}){if(e.buffers&&e.buffers.length>t)throw new Error("encodeGLTF: multiple buffers not yet implemented")}(e),Fe(e,t,r,n)}var De={name:"glTF",extensions:["glb"],mimeTypes:["model/gltf-binary"],encodeSync:function(e,t={}){const{byteOffset:r=0}=t,n=ke(e,null,r,t),s=new ArrayBuffer(n),i=new DataView(s);return ke(e,i,r,t),s},binary:!0,options:{}};var Pe={id:"glb",name:"GLB",version:"2.2.7",extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,parse:async(e,t)=>Ne(e,t),parseSync:Ne,options:{glb:{strict:!1}}};function Ne(e,t){const{byteOffset:r=0}=t,n={};return Te(n,e,r,t),n}var Ge={name:"GLB",extensions:["glb"],mimeTypes:["model/gltf-binary"],encodeSync:function(e,t){const{byteOffset:r=0}=t,n=Fe(e,null,r,t),s=new ArrayBuffer(n),i=new DataView(s);return Fe(e,i,r,t),s},binary:!0,options:{glb:{}}};class qe{constructor(e={}){this.byteLength=0,this.json={buffers:[{byteLength:0}],bufferViews:[],accessors:[],images:[],meshes:[]},this.sourceBuffers=[],this.log=e.log||console}getByteLength(){return this.byteLength}isImage(e){return Boolean(y(e))}encodeSync(e={}){return this.encodeAsGLB(e)}encodeAsGLB(e={}){this._packBinaryChunk(),e.magic&&console.warn("Custom glTF magic number no longer supported");const t={version:2,json:this.json,binary:this.arrayBuffer},r=Fe(t,null,0,e),n=new ArrayBuffer(r);return Fe(t,new DataView(n),0,e),n}addApplicationData(e,t,r={}){return this.json[e]=t,this}addBuffer(e,t={size:3}){const r=this.addBufferView(e),n={size:t.size,componentType:ne(e),count:Math.round(e.length/t.size)};return this.addAccessor(r,Object.assign(n,t))}addBufferView(e){const t=e.byteLength||e.length;return this.json.bufferViews.push({buffer:0,byteOffset:this.byteLength,byteLength:t}),this.byteLength+=B(t),this.sourceBuffers.push(e),this.json.bufferViews.length-1}addAccessor(e,t){return this.json.accessors.push({bufferView:e,type:re(t.size),componentType:t.componentType,count:t.count}),this.json.accessors.length-1}_pack(){return this._packBinaryChunk(),{arrayBuffer:this.arrayBuffer,json:this.json}}_packBinaryChunk(){if(this.arrayBuffer)return;const e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t);let n=0;for(let e=0;e<this.sourceBuffers.length;e++){n=V(this.sourceBuffers[e],r,n)}this.json.buffers[0].byteLength=e,this.arrayBuffer=t,this.sourceBuffers=[]}_getInternalCounts(){return{buffers:this.json.buffers.length,bufferViews:this.json.bufferViews.length,accessors:this.json.accessors.length,images:this.json.images.length}}}}])}));