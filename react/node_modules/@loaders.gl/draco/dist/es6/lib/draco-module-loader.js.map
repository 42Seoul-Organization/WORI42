{"version":3,"sources":["../../../src/lib/draco-module-loader.js"],"names":["loadLibrary","global","loadDecoderPromise","loadEncoderPromise","loadDracoDecoderModule","options","modules","draco3d","draco","createDecoderModule","loadDracoDecoder","loadDracoEncoderModule","createEncoderModule","loadDracoEncoder","DracoDecoderModule","wasmBinary","decoderType","Promise","all","initializeDracoDecoder","resolve","onModuleLoaded","DracoEncoderModule"],"mappings":";;;;;;AAIA,SAAQA,WAAR,EAAqBC,MAArB,QAAkC,0BAAlC;AAEA,IAAIC,kBAAJ;AACA,IAAIC,kBAAJ;AAEA,OAAO,eAAeC,sBAAf,CAAsCC,OAAtC,EAA+C;AACpD,QAAMC,OAAO,GAAGD,OAAO,CAACC,OAAR,IAAmB,EAAnC;;AAGA,MAAIA,OAAO,CAACC,OAAZ,EAAqB;AACnB,WAAO;AACLC,MAAAA,KAAK,EAAEF,OAAO,CAACC,OAAR,CAAgBE,mBAAhB;AADF,KAAP;AAGD;;AAGDP,EAAAA,kBAAkB,GAAGA,kBAAkB,IAAIQ,gBAAgB,CAACL,OAAD,CAA3D;AACA,SAAO,MAAMH,kBAAb;AACD;AAED,OAAO,eAAeS,sBAAf,CAAsCN,OAAtC,EAA+C;AACpD,QAAMC,OAAO,GAAGD,OAAO,CAACC,OAAR,IAAmB,EAAnC;;AAGA,MAAIA,OAAO,CAACC,OAAZ,EAAqB;AACnB,WAAO;AACLC,MAAAA,KAAK,EAAEF,OAAO,CAACC,OAAR,CAAgBK,mBAAhB;AADF,KAAP;AAGD;;AAGDT,EAAAA,kBAAkB,GAAGA,kBAAkB,IAAIU,gBAAgB,CAACR,OAAD,CAA3D;AACA,SAAO,MAAMF,kBAAb;AACD;;AAID,eAAeO,gBAAf,CAAgCL,OAAhC,EAAyC;AACvC,MAAIS,kBAAJ;AACA,MAAIC,UAAJ;;AACA,UAAQV,OAAO,CAACG,KAAR,IAAiBH,OAAO,CAACG,KAAR,CAAcQ,WAAvC;AACE,SAAK,IAAL;AACEF,MAAAA,kBAAkB,GAAG,MAAMd,WAAW,CAAC,kBAAD,EAAqB,OAArB,EAA8BK,OAA9B,CAAtC;AACA;;AAEF,SAAK,MAAL;AACA;AACE,OAACS,kBAAD,EAAqBC,UAArB,IAAmC,MAAME,OAAO,CAACC,GAAR,CAAY,CACnD,MAAMlB,WAAW,CAAC,uBAAD,EAA0B,OAA1B,EAAmCK,OAAnC,CADkC,EAEnD,MAAML,WAAW,CAAC,oBAAD,EAAuB,OAAvB,EAAgCK,OAAhC,CAFkC,CAAZ,CAAzC;AAPJ;;AAcAS,EAAAA,kBAAkB,GAAGA,kBAAkB,IAAIb,MAAM,CAACa,kBAAlD;AACA,SAAO,MAAMK,sBAAsB,CAACL,kBAAD,EAAqBC,UAArB,CAAnC;AACD;;AAED,SAASI,sBAAT,CAAgCL,kBAAhC,EAAoDC,UAApD,EAAgE;AAC9D,QAAMV,OAAO,GAAG,EAAhB;;AACA,MAAIU,UAAJ,EAAgB;AACdV,IAAAA,OAAO,CAACU,UAAR,GAAqBA,UAArB;AACD;;AAED,SAAO,IAAIE,OAAJ,CAAYG,OAAO,IAAI;AAC5BN,IAAAA,kBAAkB,iCACbT,OADa;AAEhBgB,MAAAA,cAAc,EAAEb,KAAK,IAAIY,OAAO,CAAC;AAACZ,QAAAA;AAAD,OAAD;AAFhB,OAAlB;AAID,GALM,CAAP;AAMD;;AAID,eAAeK,gBAAf,CAAgCR,OAAhC,EAAyC;AACvC,MAAIiB,kBAAkB,GAAG,MAAMtB,WAAW,CAAC,kBAAD,EAAqB,OAArB,EAA8BK,OAA9B,CAA1C;AAEAiB,EAAAA,kBAAkB,GAAGA,kBAAkB,IAAIrB,MAAM,CAACqB,kBAAlD;AAEA,SAAO,IAAIL,OAAJ,CAAYG,OAAO,IAAI;AAC5BE,IAAAA,kBAAkB,CAAC;AACjBD,MAAAA,cAAc,EAAEb,KAAK,IAAIY,OAAO,CAAC;AAACZ,QAAAA;AAAD,OAAD;AADf,KAAD,CAAlB;AAGD,GAJM,CAAP;AAKD","sourcesContent":["// Dynamic DRACO module loading inspired by THREE.DRACOLoader\n// https://github.com/mrdoob/three.js/blob/398c4f39ebdb8b23eefd4a7a5ec49ec0c96c7462/examples/jsm/loaders/DRACOLoader.js\n// by Don McCurdy / https://www.donmccurdy.com / MIT license\n\nimport {loadLibrary, global} from '@loaders.gl/loader-utils';\n\nlet loadDecoderPromise;\nlet loadEncoderPromise;\n\nexport async function loadDracoDecoderModule(options) {\n  const modules = options.modules || {};\n\n  // Check if a bundled draco3d library has been supplied by application\n  if (modules.draco3d) {\n    return {\n      draco: modules.draco3d.createDecoderModule()\n    };\n  }\n\n  // If not, dynamically load the WASM script from our CDN\n  loadDecoderPromise = loadDecoderPromise || loadDracoDecoder(options);\n  return await loadDecoderPromise;\n}\n\nexport async function loadDracoEncoderModule(options) {\n  const modules = options.modules || {};\n\n  // Check if a bundled draco3d library has been supplied by application\n  if (modules.draco3d) {\n    return {\n      draco: modules.draco3d.createEncoderModule()\n    };\n  }\n\n  // If not, dynamically load the WASM script from our CDN\n  loadEncoderPromise = loadEncoderPromise || loadDracoEncoder(options);\n  return await loadEncoderPromise;\n}\n\n// DRACO DECODER LOADING\n\nasync function loadDracoDecoder(options) {\n  let DracoDecoderModule;\n  let wasmBinary;\n  switch (options.draco && options.draco.decoderType) {\n    case 'js':\n      DracoDecoderModule = await loadLibrary('draco_decoder.js', 'draco', options);\n      break;\n\n    case 'wasm':\n    default:\n      [DracoDecoderModule, wasmBinary] = await Promise.all([\n        await loadLibrary('draco_wasm_wrapper.js', 'draco', options),\n        await loadLibrary('draco_decoder.wasm', 'draco', options)\n      ]);\n  }\n  // Depends on how import happened...\n  // @ts-ignore\n  DracoDecoderModule = DracoDecoderModule || global.DracoDecoderModule;\n  return await initializeDracoDecoder(DracoDecoderModule, wasmBinary);\n}\n\nfunction initializeDracoDecoder(DracoDecoderModule, wasmBinary) {\n  const options = {};\n  if (wasmBinary) {\n    options.wasmBinary = wasmBinary;\n  }\n\n  return new Promise(resolve => {\n    DracoDecoderModule({\n      ...options,\n      onModuleLoaded: draco => resolve({draco}) // Module is Promise-like. Wrap in object to avoid loop.\n    });\n  });\n}\n\n// ENCODER\n\nasync function loadDracoEncoder(options) {\n  let DracoEncoderModule = await loadLibrary('draco_encoder.js', 'draco', options);\n  // @ts-ignore\n  DracoEncoderModule = DracoEncoderModule || global.DracoEncoderModule;\n\n  return new Promise(resolve => {\n    DracoEncoderModule({\n      onModuleLoaded: draco => resolve({draco}) // Module is Promise-like. Wrap in object to avoid loop.\n    });\n  });\n}\n"],"file":"draco-module-loader.js"}