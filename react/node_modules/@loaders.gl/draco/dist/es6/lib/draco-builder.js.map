{"version":3,"sources":["../../../src/lib/draco-builder.js"],"names":["GLTF_TO_DRACO_ATTRIBUTE_NAME_MAP","POSITION","NORMAL","COLOR_0","TEXCOORD_0","noop","dracoInt8ArrayToArrayBuffer","dracoData","byteLength","size","outputBuffer","ArrayBuffer","outputData","Int8Array","i","GetValue","DracoBuilder","constructor","draco","options","dracoEncoder","Encoder","dracoMeshBuilder","MeshBuilder","log","destroy","destroyEncodedObject","object","encodeSync","mesh","_setOptions","pointcloud","_encodePointCloud","_encodeMesh","_getAttributesFromMesh","attributes","indices","dracoPointCloud","_createDracoPointCloud","DracoInt8Array","encodedLen","EncodePointCloudToDracoBuffer","Error","num_points","num_attributes","dracoMesh","_createDracoMesh","EncodeMeshToDracoBuffer","SetSpeedOptions","speed","dracoMethod","method","SetEncodingMethod","attribute","quantization","bits","dracoPosition","SetAttributeQuantization","Mesh","positions","_getPositionAttribute","vertexCount","length","attributeName","_addAttributeToMesh","error","PointCloud","isView","dracoAttributeType","_getDracoAttributeType","numFaces","AddFacesToMesh","name","AddInt8Attribute","AddInt16Attribute","AddInt32Attribute","AddUInt8Attribute","AddUInt16Attribute","AddUInt32Attribute","AddFloatAttribute","toLowerCase","COLOR","TEX_COORD","GENERIC","dracoType"],"mappings":"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","sourcesContent":["// This code is a fork of example code from the DRACO repository\n// Copyright 2017 The Draco Authors.\n// Licensed under the Apache License, Version 2.0 (the 'License');\n\n// TODO - seems to be some valid TS failures in this file\n// @ts-nocheck\n\n// const DEFAULT_ENCODING_OPTIONS = {\n//   method: 'MESH_EDGEBREAKER_ENCODING',\n//   speed: [5, 5],\n//   quantization: {\n//     POSITION: 10\n//   }\n// };\n\n// Native Draco attribute names to GLTF attribute names.\nconst GLTF_TO_DRACO_ATTRIBUTE_NAME_MAP = {\n  POSITION: 'POSITION',\n  NORMAL: 'NORMAL',\n  COLOR_0: 'COLOR',\n  TEXCOORD_0: 'TEX_COORD'\n};\n\nfunction noop() {}\n\n// Copy encoded data to buffer\nfunction dracoInt8ArrayToArrayBuffer(dracoData) {\n  const byteLength = dracoData.size();\n  const outputBuffer = new ArrayBuffer(byteLength);\n  const outputData = new Int8Array(outputBuffer);\n  for (let i = 0; i < byteLength; ++i) {\n    outputData[i] = dracoData.GetValue(i);\n  }\n  return outputBuffer;\n}\n\n/* Encoder API:\nhttps://github.com/google/draco/blob/master/src/draco/javascript/emscripten/draco_web_encoder.idl\n   Example:\nhttps://github.com/google/draco/blob/master/javascript/npm/draco3d/draco_nodejs_example.js\n */\nexport default class DracoBuilder {\n  // draco - the draco decoder, either import `draco3d` or load dynamically\n  constructor(draco, options = {}) {\n    this.draco = draco;\n    this.dracoEncoder = new this.draco.Encoder();\n    this.dracoMeshBuilder = new this.draco.MeshBuilder();\n    this.log = options.log || noop;\n  }\n\n  destroy() {\n    this.destroyEncodedObject(this.dracoMeshBuilder);\n    this.destroyEncodedObject(this.dracoEncoder);\n    this.dracoMeshBuilder = null;\n    this.dracoEncoder = null;\n    this.draco = null;\n  }\n\n  // TBD - when does this need to be called?\n  destroyEncodedObject(object) {\n    if (object) {\n      this.draco.destroy(object);\n    }\n  }\n\n  // Encode mesh=({})\n  encodeSync(mesh, options) {\n    this._setOptions(options);\n    return options.pointcloud ? this._encodePointCloud(mesh) : this._encodeMesh(mesh);\n  }\n\n  // PRIVATE\n\n  _getAttributesFromMesh(mesh) {\n    // TODO - Change the encodePointCloud interface instead?\n    const attributes = {...mesh, ...mesh.attributes};\n    // Fold indices into the attributes\n    if (mesh.indices) {\n      attributes.indices = mesh.indices;\n    }\n    return attributes;\n  }\n\n  _encodePointCloud(pointcloud) {\n    const attributes = this._getAttributesFromMesh(pointcloud);\n\n    // Build a `DracoPointCloud` from the input data\n    const dracoPointCloud = this._createDracoPointCloud(attributes);\n\n    const dracoData = new this.draco.DracoInt8Array();\n\n    try {\n      const encodedLen = this.dracoEncoder.EncodePointCloudToDracoBuffer(\n        dracoPointCloud,\n        false,\n        dracoData\n      );\n\n      if (!(encodedLen > 0)) {\n        throw new Error('Draco encoding failed.');\n      }\n\n      this.log(`DRACO encoded ${dracoPointCloud.num_points()} points\n        with ${dracoPointCloud.num_attributes()} attributes into ${encodedLen} bytes`);\n\n      return dracoInt8ArrayToArrayBuffer(dracoData);\n    } finally {\n      this.destroyEncodedObject(dracoData);\n      this.destroyEncodedObject(dracoPointCloud);\n    }\n  }\n\n  _encodeMesh(mesh) {\n    const attributes = this._getAttributesFromMesh(mesh);\n    // Build a `DracoMesh` from the input data\n    const dracoMesh = this._createDracoMesh(attributes);\n\n    const dracoData = new this.draco.DracoInt8Array();\n\n    try {\n      const encodedLen = this.dracoEncoder.EncodeMeshToDracoBuffer(dracoMesh, dracoData);\n      if (encodedLen <= 0) {\n        throw new Error('Draco encoding failed.');\n      }\n\n      this.log(`DRACO encoded ${dracoMesh.num_points()} points\n        with ${dracoMesh.num_attributes()} attributes into ${encodedLen} bytes`);\n\n      return dracoInt8ArrayToArrayBuffer(dracoData);\n    } finally {\n      this.destroyEncodedObject(dracoData);\n      this.destroyEncodedObject(dracoMesh);\n    }\n  }\n\n  /**\n   * Set encoding options.\n   * @param {{speed?: any; method?: any; quantization?: any;}} options\n   */\n  _setOptions(options) {\n    if ('speed' in options) {\n      this.dracoEncoder.SetSpeedOptions(...options.speed);\n    }\n    if ('method' in options) {\n      const dracoMethod = this.draco[options.method];\n      // if (dracoMethod === undefined) {}\n      this.dracoEncoder.SetEncodingMethod(dracoMethod);\n    }\n    if ('quantization' in options) {\n      for (const attribute in options.quantization) {\n        const bits = options.quantization[attribute];\n        const dracoPosition = this.draco[attribute];\n        this.dracoEncoder.SetAttributeQuantization(dracoPosition, bits);\n      }\n    }\n  }\n\n  _createDracoMesh(attributes) {\n    const dracoMesh = new this.draco.Mesh();\n\n    try {\n      const positions = this._getPositionAttribute(attributes);\n      if (!positions) {\n        throw new Error('positions');\n      }\n      const vertexCount = positions.length / 3;\n\n      for (let attributeName in attributes) {\n        const attribute = attributes[attributeName];\n        attributeName = GLTF_TO_DRACO_ATTRIBUTE_NAME_MAP[attributeName] || attributeName;\n        this._addAttributeToMesh(dracoMesh, attributeName, attribute, vertexCount);\n      }\n    } catch (error) {\n      this.destroyEncodedObject(dracoMesh);\n      throw error;\n    }\n\n    return dracoMesh;\n  }\n\n  _createDracoPointCloud(attributes) {\n    const dracoPointCloud = new this.draco.PointCloud();\n\n    try {\n      const positions = this._getPositionAttribute(attributes);\n      if (!positions) {\n        throw new Error('positions');\n      }\n      const vertexCount = positions.length / 3;\n\n      for (let attributeName in attributes) {\n        const attribute = attributes[attributeName];\n        attributeName = GLTF_TO_DRACO_ATTRIBUTE_NAME_MAP[attributeName] || attributeName;\n        this._addAttributeToMesh(dracoPointCloud, attributeName, attribute, vertexCount);\n      }\n    } catch (error) {\n      this.destroyEncodedObject(dracoPointCloud);\n      throw error;\n    }\n\n    return dracoPointCloud;\n  }\n\n  _addAttributeToMesh(dracoMesh, attributeName, attribute, vertexCount) {\n    if (!ArrayBuffer.isView(attribute)) {\n      return;\n    }\n\n    const dracoAttributeType = this._getDracoAttributeType(attributeName, attribute);\n    const size = attribute.length / vertexCount;\n\n    if (dracoAttributeType === 'indices') {\n      const numFaces = attribute.length / 3;\n      this.log(`Adding attribute ${attributeName}, size ${numFaces}`);\n      this.dracoMeshBuilder.AddFacesToMesh(dracoMesh, numFaces, attribute);\n      return;\n    }\n\n    this.log(`Adding attribute ${attributeName}, size ${size}`);\n\n    switch (attribute.constructor.name) {\n      case 'Int8Array':\n        this.dracoMeshBuilder.AddInt8Attribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n        break;\n\n      case 'Int16Array':\n        this.dracoMeshBuilder.AddInt16Attribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n        break;\n\n      case 'Int32Array':\n        this.dracoMeshBuilder.AddInt32Attribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n        break;\n\n      case 'Uint8Array':\n      case 'Uint8ClampedArray':\n        this.dracoMeshBuilder.AddUInt8Attribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n        break;\n\n      case 'Uint16Array':\n        this.dracoMeshBuilder.AddUInt16Attribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n        break;\n\n      case 'Uint32Array':\n        this.dracoMeshBuilder.AddUInt32Attribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n        break;\n\n      case 'Float32Array':\n      default:\n        this.dracoMeshBuilder.AddFloatAttribute(\n          dracoMesh,\n          dracoAttributeType,\n          vertexCount,\n          size,\n          attribute\n        );\n    }\n  }\n\n  // DRACO can compress attributes of know type better\n  // TODO - expose an attribute type map?\n  _getDracoAttributeType(attributeName, attribute) {\n    switch (attributeName.toLowerCase()) {\n      case 'indices':\n        return 'indices';\n      case 'position':\n      case 'positions':\n      case 'vertices':\n        return this.draco.POSITION;\n      case 'normal':\n      case 'normals':\n        return this.draco.NORMAL;\n      case 'color':\n      case 'colors':\n        return this.draco.COLOR;\n      case 'texCoord':\n      case 'texCoords':\n        return this.draco.TEX_COORD;\n      default:\n        return this.draco.GENERIC;\n    }\n  }\n\n  _getPositionAttribute(attributes) {\n    for (const attributeName in attributes) {\n      const attribute = attributes[attributeName];\n      const dracoType = this._getDracoAttributeType(attributeName, attribute);\n      if (dracoType === this.draco.POSITION) {\n        return attribute;\n      }\n    }\n    return null;\n  }\n}\n"],"file":"draco-builder.js"}