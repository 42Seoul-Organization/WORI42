!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=26)}([function(e,t){e.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},function(e,t,r){"use strict";var n=r(6);function a(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=r(10),s=r(11),o=r(17),E="8.2.0-beta.1",u=Object(o.a)();var _=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(i.a)(this,e),this.storage=function(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(n),this.id=t,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return Object(s.a)(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function c(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,a=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));var i=e.width*r,s=e.height*r,o=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(a,");"),"background-size:".concat(i,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}var l={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function A(e){return"string"==typeof e?l[e.toUpperCase()]||l.WHITE:e}function f(e,t){if(!e)throw new Error(t||"Assertion failed")}var h=r(5);function T(){var e;if(u&&h.b.performance)e=h.b.performance.now();else if(h.a.hrtime){var t=h.a.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var R={debug:u&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},d={enabled:!0,level:0};function g(){}var N={},m={once:!0};function F(e){for(var t in e)for(var r in e[t])return r||"untitled";return"empty"}var O=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;Object(i.a)(this,e),this.id=t,this.VERSION=E,this._startTs=T(),this._deltaTs=T(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new _("__probe-".concat(this.id,"__"),d),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),a=!0,i=!1,s=void 0;try{for(var o,E=function(){var r=o.value;"function"==typeof e[r]&&(t.find(function(e){return r===e})||(e[r]=e[r].bind(e)))},u=n[Symbol.iterator]();!(a=(o=u.next()).done);a=!0)E()}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}}(this),Object.seal(this)}return Object(s.a)(e,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((T()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((T()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"assert",value:function(e,t){f(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,R.warn,arguments,m)}},{key:"error",value:function(e){return this._getLogFunction(0,e,R.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,R.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,R.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){return this._getLogFunction(e,t,R.debug||R.info,arguments,m)}},{key:"table",value:function(e,t,r){return t?this._getLogFunction(e,t,console.table||g,r&&[r],{tag:F(t)}):g}},{key:"image",value:function(e){var t=e.logLevel,n=e.priority,i=e.image,s=e.message,o=void 0===s?"":s,E=e.scale,_=void 0===E?1:E;return this._shouldLog(t||n)?u?function(e){var t=e.image,r=e.message,n=void 0===r?"":r,i=e.scale,s=void 0===i?1:i;if("string"==typeof t){var o=new Image;return o.onload=function(){var e,t=c(o,n,s);(e=console).log.apply(e,a(t))},o.src=t,g}var E=t.nodeName||"";if("img"===E.toLowerCase()){var u;return(u=console).log.apply(u,a(c(t,n,s))),g}if("canvas"===E.toLowerCase()){var _=new Image;return _.onload=function(){var e;return(e=console).log.apply(e,a(c(_,n,s)))},_.src=t.toDataURL(),g}return g}({image:i,message:o,scale:_}):function(e){var t=e.image,n=(e.message,e.scale),a=void 0===n?1:n,i=null;try{i=r(31)}catch(e){}if(i)return function(){return i(t,{fit:"box",width:"".concat(Math.round(80*a),"%")}).then(function(e){return console.log(e)})};return g}({image:i,message:o,scale:_}):g}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,t))}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||g)}},{key:"group",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=(r=S({logLevel:e,message:t,opts:r})).collapsed;return r.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}},{key:"groupCollapsed",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||g)}},{key:"withGroup",value:function(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=b(e)}},{key:"_getLogFunction",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(e)){var s;i=S({logLevel:e,message:t,args:n,opts:i}),f(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=T();var o=i.tag||i.message;if(i.once){if(N[o])return g;N[o]=T()}return t=function(e,t,r){if("string"==typeof t){var n=r.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=Math.max(t-e.length,0);return"".concat(" ".repeat(r)).concat(e)}((o=r.total)<10?"".concat(o.toFixed(2),"ms"):o<100?"".concat(o.toFixed(1),"ms"):o<1e3?"".concat(o.toFixed(0),"ms"):"".concat((o/1e3).toFixed(2),"s")):"";t=r.time?"".concat(e,": ").concat(n,"  ").concat(t):"".concat(e,": ").concat(t),a=t,i=r.color,s=r.background,u||"string"!=typeof a||(i&&(i=A(i),a="[".concat(i,"m").concat(a,"[39m")),s&&(i=A(s),a="[".concat(s+10,"m").concat(a,"[49m"))),t=a}var a,i,s;var o;return t}(this.id,i.message,i),(s=r).bind.apply(s,[console,t].concat(a(i.args)))}return g}},{key:"level",set:function(e){this.setLevel(e)},get:function(){return this.getLevel()}},{key:"priority",set:function(e){this.level=e},get:function(){return this.level}}]),e}();function b(e){if(!e)return 0;var t;switch(Object(n.a)(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return f(Number.isFinite(t)&&t>=0),t}function S(e){var t=e.logLevel,r=e.message;e.logLevel=b(t);for(var a=e.args?Array.from(e.args):[];a.length&&a.shift()!==r;);switch(e.args=a,Object(n.a)(t)){case"string":case"function":void 0!==r&&a.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var i=Object(n.a)(e.message);return f("string"===i||"object"===i),Object.assign(e,e.opts)}function I(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function L(e){for(const t in e)return!1;return!0}function B(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}function C(e){const t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}O.VERSION=E;function M(e){return Boolean(e&&Number.isFinite(e._version))}function p(e){return Boolean(e&&2===e._version)}r.d(t,"g",function(){return U}),r.d(t,"a",function(){return I}),r.d(t,"b",function(){return B}),r.d(t,"d",function(){return L}),r.d(t,"c",function(){return C}),r.d(t,"e",function(){return M}),r.d(t,"f",function(){return p});const U=new O({id:"luma.gl"})},,function(e,t,r){e.exports=r(28)},,function(e,t,r){"use strict";(function(e,n){r.d(t,"b",function(){return s}),r.d(t,"a",function(){return o});var a=r(6),i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":Object(a.a)(n))&&n},s=i.window||i.self||i.global,o=i.process||{};console}).call(this,r(14),r(12))},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)})(e)}r.d(t,"a",function(){return a})},function(e,t,r){"use strict";r.d(t,"c",function(){return s}),r.d(t,"e",function(){return c}),r.d(t,"a",function(){return A}),r.d(t,"b",function(){return f}),r.d(t,"d",function(){return T});var n=r(0),a=r.n(n),i=r(1);const s={[a.a.BLEND]:!1,[a.a.BLEND_COLOR]:new Float32Array([0,0,0,0]),[a.a.BLEND_EQUATION_RGB]:a.a.FUNC_ADD,[a.a.BLEND_EQUATION_ALPHA]:a.a.FUNC_ADD,[a.a.BLEND_SRC_RGB]:a.a.ONE,[a.a.BLEND_DST_RGB]:a.a.ZERO,[a.a.BLEND_SRC_ALPHA]:a.a.ONE,[a.a.BLEND_DST_ALPHA]:a.a.ZERO,[a.a.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[a.a.COLOR_WRITEMASK]:[!0,!0,!0,!0],[a.a.CULL_FACE]:!1,[a.a.CULL_FACE_MODE]:a.a.BACK,[a.a.DEPTH_TEST]:!1,[a.a.DEPTH_CLEAR_VALUE]:1,[a.a.DEPTH_FUNC]:a.a.LESS,[a.a.DEPTH_RANGE]:new Float32Array([0,1]),[a.a.DEPTH_WRITEMASK]:!0,[a.a.DITHER]:!0,[a.a.FRAMEBUFFER_BINDING]:null,[a.a.FRONT_FACE]:a.a.CCW,[a.a.GENERATE_MIPMAP_HINT]:a.a.DONT_CARE,[a.a.LINE_WIDTH]:1,[a.a.POLYGON_OFFSET_FILL]:!1,[a.a.POLYGON_OFFSET_FACTOR]:0,[a.a.POLYGON_OFFSET_UNITS]:0,[a.a.SAMPLE_COVERAGE_VALUE]:1,[a.a.SAMPLE_COVERAGE_INVERT]:!1,[a.a.SCISSOR_TEST]:!1,[a.a.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[a.a.STENCIL_TEST]:!1,[a.a.STENCIL_CLEAR_VALUE]:0,[a.a.STENCIL_WRITEMASK]:4294967295,[a.a.STENCIL_BACK_WRITEMASK]:4294967295,[a.a.STENCIL_FUNC]:a.a.ALWAYS,[a.a.STENCIL_REF]:0,[a.a.STENCIL_VALUE_MASK]:4294967295,[a.a.STENCIL_BACK_FUNC]:a.a.ALWAYS,[a.a.STENCIL_BACK_REF]:0,[a.a.STENCIL_BACK_VALUE_MASK]:4294967295,[a.a.STENCIL_FAIL]:a.a.KEEP,[a.a.STENCIL_PASS_DEPTH_FAIL]:a.a.KEEP,[a.a.STENCIL_PASS_DEPTH_PASS]:a.a.KEEP,[a.a.STENCIL_BACK_FAIL]:a.a.KEEP,[a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:a.a.KEEP,[a.a.STENCIL_BACK_PASS_DEPTH_PASS]:a.a.KEEP,[a.a.VIEWPORT]:[0,0,1024,1024],[a.a.PACK_ALIGNMENT]:4,[a.a.UNPACK_ALIGNMENT]:4,[a.a.UNPACK_FLIP_Y_WEBGL]:!1,[a.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[a.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:a.a.BROWSER_DEFAULT_WEBGL,[a.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:a.a.DONT_CARE,[a.a.READ_FRAMEBUFFER_BINDING]:null,[a.a.RASTERIZER_DISCARD]:!1,[a.a.PACK_ROW_LENGTH]:0,[a.a.PACK_SKIP_PIXELS]:0,[a.a.PACK_SKIP_ROWS]:0,[a.a.UNPACK_ROW_LENGTH]:0,[a.a.UNPACK_IMAGE_HEIGHT]:0,[a.a.UNPACK_SKIP_PIXELS]:0,[a.a.UNPACK_SKIP_ROWS]:0,[a.a.UNPACK_SKIP_IMAGES]:0},o=(e,t,r)=>t?e.enable(r):e.disable(r),E=(e,t,r)=>e.hint(r,t),u=(e,t,r)=>e.pixelStorei(r,t);function _(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const c={[a.a.BLEND]:o,[a.a.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[a.a.BLEND_EQUATION_RGB]:"blendEquation",[a.a.BLEND_EQUATION_ALPHA]:"blendEquation",[a.a.BLEND_SRC_RGB]:"blendFunc",[a.a.BLEND_DST_RGB]:"blendFunc",[a.a.BLEND_SRC_ALPHA]:"blendFunc",[a.a.BLEND_DST_ALPHA]:"blendFunc",[a.a.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[a.a.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[a.a.CULL_FACE]:o,[a.a.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[a.a.DEPTH_TEST]:o,[a.a.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[a.a.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[a.a.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[a.a.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[a.a.DITHER]:o,[a.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:E,[a.a.FRAMEBUFFER_BINDING]:(e,t)=>{const r=Object(i.f)(e)?a.a.DRAW_FRAMEBUFFER:a.a.FRAMEBUFFER;return e.bindFramebuffer(r,t)},[a.a.FRONT_FACE]:(e,t)=>e.frontFace(t),[a.a.GENERATE_MIPMAP_HINT]:E,[a.a.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[a.a.POLYGON_OFFSET_FILL]:o,[a.a.POLYGON_OFFSET_FACTOR]:"polygonOffset",[a.a.POLYGON_OFFSET_UNITS]:"polygonOffset",[a.a.RASTERIZER_DISCARD]:o,[a.a.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[a.a.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[a.a.SCISSOR_TEST]:o,[a.a.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[a.a.STENCIL_TEST]:o,[a.a.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[a.a.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(a.a.FRONT,t),[a.a.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(a.a.BACK,t),[a.a.STENCIL_FUNC]:"stencilFuncFront",[a.a.STENCIL_REF]:"stencilFuncFront",[a.a.STENCIL_VALUE_MASK]:"stencilFuncFront",[a.a.STENCIL_BACK_FUNC]:"stencilFuncBack",[a.a.STENCIL_BACK_REF]:"stencilFuncBack",[a.a.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[a.a.STENCIL_FAIL]:"stencilOpFront",[a.a.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[a.a.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[a.a.STENCIL_BACK_FAIL]:"stencilOpBack",[a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[a.a.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[a.a.VIEWPORT]:(e,t)=>e.viewport(...t),[a.a.PACK_ALIGNMENT]:u,[a.a.UNPACK_ALIGNMENT]:u,[a.a.UNPACK_FLIP_Y_WEBGL]:u,[a.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:u,[a.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:u,[a.a.PACK_ROW_LENGTH]:u,[a.a.PACK_SKIP_PIXELS]:u,[a.a.PACK_SKIP_ROWS]:u,[a.a.READ_FRAMEBUFFER_BINDING]:(e,t)=>e.bindFramebuffer(a.a.READ_FRAMEBUFFER,t),[a.a.UNPACK_ROW_LENGTH]:u,[a.a.UNPACK_IMAGE_HEIGHT]:u,[a.a.UNPACK_SKIP_PIXELS]:u,[a.a.UNPACK_SKIP_ROWS]:u,[a.a.UNPACK_SKIP_IMAGES]:u,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(a.a.FRAMEBUFFER,r)},blend:(e,t)=>t?e.enable(a.a.BLEND):e.disable(a.a.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=_(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=_(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(a.a.CULL_FACE):e.disable(a.a.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(a.a.DEPTH_TEST):e.disable(a.a.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(a.a.DITHER):e.disable(a.a.DITHER),derivativeHint:(e,t)=>{e.hint(a.a.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(a.a.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(a.a.POLYGON_OFFSET_FILL):e.disable(a.a.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(a.a.SCISSOR_TEST):e.disable(a.a.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(a.a.STENCIL_TEST):e.disable(a.a.STENCIL_TEST),stencilMask:(e,t)=>{t=_(t)?t:[t,t];const[r,n]=t;e.stencilMaskSeparate(a.a.FRONT,r),e.stencilMaskSeparate(a.a.BACK,n)},stencilFunc:(e,t)=>{t=_(t)&&3===t.length?[...t,...t]:t;const[r,n,i,s,o,E]=t;e.stencilFuncSeparate(a.a.FRONT,r,n,i),e.stencilFuncSeparate(a.a.BACK,s,o,E)},stencilOp:(e,t)=>{t=_(t)&&3===t.length?[...t,...t]:t;const[r,n,i,s,o,E]=t;e.stencilOpSeparate(a.a.FRONT,r,n,i),e.stencilOpSeparate(a.a.BACK,s,o,E)},viewport:(e,t)=>e.viewport(...t)};function l(e,t,r){return void 0!==t[e]?t[e]:r[e]}const A={blendEquation:(e,t,r)=>e.blendEquationSeparate(l(a.a.BLEND_EQUATION_RGB,t,r),l(a.a.BLEND_EQUATION_ALPHA,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(l(a.a.BLEND_SRC_RGB,t,r),l(a.a.BLEND_DST_RGB,t,r),l(a.a.BLEND_SRC_ALPHA,t,r),l(a.a.BLEND_DST_ALPHA,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(l(a.a.POLYGON_OFFSET_FACTOR,t,r),l(a.a.POLYGON_OFFSET_UNITS,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(l(a.a.SAMPLE_COVERAGE_VALUE,t,r),l(a.a.SAMPLE_COVERAGE_INVERT,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(a.a.FRONT,l(a.a.STENCIL_FUNC,t,r),l(a.a.STENCIL_REF,t,r),l(a.a.STENCIL_VALUE_MASK,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(a.a.BACK,l(a.a.STENCIL_BACK_FUNC,t,r),l(a.a.STENCIL_BACK_REF,t,r),l(a.a.STENCIL_BACK_VALUE_MASK,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(a.a.FRONT,l(a.a.STENCIL_FAIL,t,r),l(a.a.STENCIL_PASS_DEPTH_FAIL,t,r),l(a.a.STENCIL_PASS_DEPTH_PASS,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(a.a.BACK,l(a.a.STENCIL_BACK_FAIL,t,r),l(a.a.STENCIL_BACK_PASS_DEPTH_FAIL,t,r),l(a.a.STENCIL_BACK_PASS_DEPTH_PASS,t,r))},f={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),bindFramebuffer:(e,t,r)=>{switch(t){case a.a.FRAMEBUFFER:return e({[a.a.DRAW_FRAMEBUFFER_BINDING]:r,[a.a.READ_FRAMEBUFFER_BINDING]:r});case a.a.DRAW_FRAMEBUFFER:return e({[a.a.DRAW_FRAMEBUFFER_BINDING]:r});case a.a.READ_FRAMEBUFFER:return e({[a.a.READ_FRAMEBUFFER_BINDING]:r});default:return null}},blendColor:(e,t,r,n,i)=>e({[a.a.BLEND_COLOR]:new Float32Array([t,r,n,i])}),blendEquation:(e,t)=>e({[a.a.BLEND_EQUATION_RGB]:t,[a.a.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,r)=>e({[a.a.BLEND_EQUATION_RGB]:t,[a.a.BLEND_EQUATION_ALPHA]:r}),blendFunc:(e,t,r)=>e({[a.a.BLEND_SRC_RGB]:t,[a.a.BLEND_DST_RGB]:r,[a.a.BLEND_SRC_ALPHA]:t,[a.a.BLEND_DST_ALPHA]:r}),blendFuncSeparate:(e,t,r,n,i)=>e({[a.a.BLEND_SRC_RGB]:t,[a.a.BLEND_DST_RGB]:r,[a.a.BLEND_SRC_ALPHA]:n,[a.a.BLEND_DST_ALPHA]:i}),clearColor:(e,t,r,n,i)=>e({[a.a.COLOR_CLEAR_VALUE]:new Float32Array([t,r,n,i])}),clearDepth:(e,t)=>e({[a.a.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[a.a.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,r,n,i)=>e({[a.a.COLOR_WRITEMASK]:[t,r,n,i]}),cullFace:(e,t)=>e({[a.a.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[a.a.DEPTH_FUNC]:t}),depthRange:(e,t,r)=>e({[a.a.DEPTH_RANGE]:new Float32Array([t,r])}),depthMask:(e,t)=>e({[a.a.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[a.a.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[a.a.LINE_WIDTH]:t}),polygonOffset:(e,t,r)=>e({[a.a.POLYGON_OFFSET_FACTOR]:t,[a.a.POLYGON_OFFSET_UNITS]:r}),sampleCoverage:(e,t,r)=>e({[a.a.SAMPLE_COVERAGE_VALUE]:t,[a.a.SAMPLE_COVERAGE_INVERT]:r}),scissor:(e,t,r,n,i)=>e({[a.a.SCISSOR_BOX]:new Int32Array([t,r,n,i])}),stencilMask:(e,t)=>e({[a.a.STENCIL_WRITEMASK]:t,[a.a.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,r)=>e({[t===a.a.FRONT?a.a.STENCIL_WRITEMASK:a.a.STENCIL_BACK_WRITEMASK]:r}),stencilFunc:(e,t,r,n)=>e({[a.a.STENCIL_FUNC]:t,[a.a.STENCIL_REF]:r,[a.a.STENCIL_VALUE_MASK]:n,[a.a.STENCIL_BACK_FUNC]:t,[a.a.STENCIL_BACK_REF]:r,[a.a.STENCIL_BACK_VALUE_MASK]:n}),stencilFuncSeparate:(e,t,r,n,i)=>e({[t===a.a.FRONT?a.a.STENCIL_FUNC:a.a.STENCIL_BACK_FUNC]:r,[t===a.a.FRONT?a.a.STENCIL_REF:a.a.STENCIL_BACK_REF]:n,[t===a.a.FRONT?a.a.STENCIL_VALUE_MASK:a.a.STENCIL_BACK_VALUE_MASK]:i}),stencilOp:(e,t,r,n)=>e({[a.a.STENCIL_FAIL]:t,[a.a.STENCIL_PASS_DEPTH_FAIL]:r,[a.a.STENCIL_PASS_DEPTH_PASS]:n,[a.a.STENCIL_BACK_FAIL]:t,[a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:r,[a.a.STENCIL_BACK_PASS_DEPTH_PASS]:n}),stencilOpSeparate:(e,t,r,n,i)=>e({[t===a.a.FRONT?a.a.STENCIL_FAIL:a.a.STENCIL_BACK_FAIL]:r,[t===a.a.FRONT?a.a.STENCIL_PASS_DEPTH_FAIL:a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:n,[t===a.a.FRONT?a.a.STENCIL_PASS_DEPTH_PASS:a.a.STENCIL_BACK_PASS_DEPTH_PASS]:i}),viewport:(e,t,r,n,i)=>e({[a.a.VIEWPORT]:[t,r,n,i]})},h=(e,t)=>e.isEnabled(t),T={[a.a.BLEND]:h,[a.a.CULL_FACE]:h,[a.a.DEPTH_TEST]:h,[a.a.DITHER]:h,[a.a.POLYGON_OFFSET_FILL]:h,[a.a.SAMPLE_ALPHA_TO_COVERAGE]:h,[a.a.SAMPLE_COVERAGE]:h,[a.a.SCISSOR_TEST]:h,[a.a.STENCIL_TEST]:h,[a.a.RASTERIZER_DISCARD]:h}},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return u}),r.d(t,"c",function(){return _}),r.d(t,"b",function(){return c});var n=r(7),a=r(9),i=r(1);function s(e,t){const r=e[t].bind(e);e[t]=function(...t){const n=t[0];return n in e.state.cache||(e.state.cache[n]=r(...t)),e.state.enable?e.state.cache[n]:r(...t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function o(e,t,r){const n=e[t].bind(e);e[t]=function(...t){const{valueChanged:a,oldValue:i}=r(e.state._updateCache,...t);return a&&n(...t),i},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}class E{constructor(e,{copyState:t=!1,log:r=(()=>{})}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?Object(a.a)(e):Object.assign({},n.c),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Object(i.a)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Object(a.b)(this.gl,e,this.cache),this.stateStack.pop()}_updateCache(e){let t,r=!1;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const a in e){Object(i.a)(void 0!==a);const s=e[a],o=this.cache[a];Object(i.b)(s,o)||(r=!0,t=o,!n||a in n||(n[a]=o),this.cache[a]=s)}return{valueChanged:r,oldValue:t}}}function u(t,{enable:r=!0,copyState:a}={}){if(Object(i.a)(void 0!==a),!t.state){const i=void 0!==e?e:window;i.polyfillContext&&i.polyfillContext(t),t.state=new E(t,{copyState:a,enable:r}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}(t);for(const e in n.b){o(t,e,n.b[e])}s(t,"getParameter"),s(t,"isEnabled")}return t.state.enable=r,t}function _(e){e.state||u(e,{copyState:!1}),e.state.push()}function c(e){Object(i.a)(e.state),e.state.pop()}}).call(this,r(14))},function(e,t,r){"use strict";r.d(t,"b",function(){return s}),r.d(t,"a",function(){return o}),r.d(t,"c",function(){return E});var n=r(7),a=r(8),i=r(1);function s(e,t){if(Object(i.a)(Object(i.e)(e),"setParameters requires a WebGL context"),Object(i.d)(t))return;const r={};for(const a in t){const i=Number(a),s=n.e[a];s&&("string"==typeof s?r[s]=!0:s(e,t[a],i))}const a=e.state&&e.state.cache;if(a)for(const i in r){(0,n.a[i])(e,t,a)}}function o(e,t){if("number"==typeof(t=t||n.c)){const r=t,a=n.d[r];return a?a(e,r):e.getParameter(r)}const r=Array.isArray(t)?t:Object.keys(t),a={};for(const t of r){const r=n.d[t];a[t]=r?r(e,Number(t)):e.getParameter(Number(t))}return a}function E(e,t,r){if(Object(i.d)(t))return r(e);const{nocatch:n=!0}=t;let o;if(Object(a.c)(e),s(e,t),n)o=r(e),Object(a.b)(e);else try{o=r(e)}finally{Object(a.b)(e)}return o}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"a",function(){return n})},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.d(t,"a",function(){return a})},function(e,t){var r,n,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var E,u=[],_=!1,c=-1;function l(){_&&E&&(_=!1,E.length?u=E.concat(u):c=-1,u.length&&A())}function A(){if(!_){var e=o(l);_=!0;for(var t=u.length;t;){for(E=u,u=[];++c<t;)E&&E[c].run();c=-1,t=u.length}E=null,_=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||_||o(A)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(0),a=r.n(n),i=r(1);const s=e=>Object(i.f)(e)?void 0:0,o={[a.a.READ_BUFFER]:e=>Object(i.f)(e)?void 0:a.a.COLOR_ATTACHMENT0,35723:e=>Object(i.f)(e)?void 0:4352,[a.a.RASTERIZER_DISCARD]:s,[a.a.SAMPLES]:s,36795:(e,t)=>{const r=Object(i.f)(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?t(r.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const r=e.getExtension("WEBGL_debug_renderer_info");return t(r&&r.UNMASKED_VENDOR_WEBGL||a.a.VENDOR)},37446:(e,t)=>{const r=e.getExtension("WEBGL_debug_renderer_info");return t(r&&r.UNMASKED_RENDERER_WEBGL||a.a.RENDERER)},34047:(e,t)=>{const r=e.luma.extensions.EXT_texture_filter_anisotropic;return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[a.a.MAX_3D_TEXTURE_SIZE]:s,[a.a.MAX_ARRAY_TEXTURE_LAYERS]:s,[a.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:s,[a.a.MAX_COLOR_ATTACHMENTS]:(e,t)=>{if(!Object(i.f)(e)){const r=e.getExtension("WEBGL_draw_buffers");return r?t(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[a.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:s,[a.a.MAX_COMBINED_UNIFORM_BLOCKS]:s,[a.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:s,[a.a.MAX_DRAW_BUFFERS]:e=>{if(!Object(i.f)(e)){const t=e.getExtension("WEBGL_draw_buffers");return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[a.a.MAX_ELEMENT_INDEX]:e=>e.getExtension("OES_element_index")?2147483647:65535,[a.a.MAX_ELEMENTS_INDICES]:e=>e.getExtension("OES_element_index")?16777216:65535,[a.a.MAX_ELEMENTS_VERTICES]:e=>16777216,[a.a.MAX_FRAGMENT_INPUT_COMPONENTS]:s,[a.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:s,[a.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:s,[a.a.MAX_SAMPLES]:s,[a.a.MAX_SERVER_WAIT_TIMEOUT]:s,[a.a.MAX_TEXTURE_LOD_BIAS]:s,[a.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:s,[a.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:s,[a.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:s,[a.a.MAX_UNIFORM_BLOCK_SIZE]:s,[a.a.MAX_UNIFORM_BUFFER_BINDINGS]:s,[a.a.MAX_VARYING_COMPONENTS]:s,[a.a.MAX_VERTEX_OUTPUT_COMPONENTS]:s,[a.a.MAX_VERTEX_UNIFORM_BLOCKS]:s,[a.a.MAX_VERTEX_UNIFORM_COMPONENTS]:s,[a.a.MIN_PROGRAM_TEXEL_OFFSET]:s,[a.a.MAX_PROGRAM_TEXEL_OFFSET]:s,[a.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:s};r.d(t,"b",function(){return E}),r.d(t,"a",function(){return u});const E={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Object(i.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},ANGLE_instanced_arrays:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Object(i.a)(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Object(i.a)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Object(i.a)(!1)},deleteQuery:()=>{Object(i.a)(!1)},beginQuery:()=>{Object(i.a)(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},u={readBuffer:(e,t,r)=>{Object(i.f)(e)&&t(r)},getVertexAttrib:(e,t,r,n)=>{const{webgl2:s,ext:o}=function(e,t){return{webgl2:Object(i.f)(e),ext:e.getExtension(t)}}(e,"ANGLE_instanced_arrays");let E;switch(n){case a.a.VERTEX_ATTRIB_ARRAY_INTEGER:E=!!s&&void 0;break;case a.a.VERTEX_ATTRIB_ARRAY_DIVISOR:E=s||o?void 0:0}return void 0!==E?E:t(r,n)},getProgramParameter:(e,t,r,n)=>{if(!Object(i.f)(e))switch(n){case a.a.TRANSFORM_FEEDBACK_BUFFER_MODE:return a.a.SEPARATE_ATTRIBS;case a.a.TRANSFORM_FEEDBACK_VARYINGS:case a.a.ACTIVE_UNIFORM_BLOCKS:return 0}return t(r,n)},getInternalformatParameter:(e,t,r,n,s)=>{if(!Object(i.f)(e))switch(s){case a.a.SAMPLES:return new Int32Array([0])}return e.getInternalformatParameter(r,n,s)},getTexParameter(e,t,r,n){switch(n){case a.a.TEXTURE_MAX_ANISOTROPY_EXT:const{extensions:t}=e.luma,r=t.EXT_texture_filter_anisotropic;n=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||a.a.TEXTURE_MAX_ANISOTROPY_EXT}return t(r,n)},getParameter:function(e,t,r){const n=o[r],a="function"==typeof n?n(e,t,r):n;return void 0!==a?a:t(r)},hint:(e,t,r,n)=>t(r,n)}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";(function(e){function n(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if(void 0!==e&&e.hrtime){var r=e.hrtime();t=1e3*r[0]+r[1]/1e6}else t=Date.now();return t}r.d(t,"a",function(){return n})}).call(this,r(12))},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return i});var n=r(6),a=r(18);function i(){return!("object"===(void 0===e?"undefined":Object(n.a)(e))&&"[object process]"===String(e)&&!e.browser)||Object(a.a)()}}).call(this,r(12))},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return a});var n=r(6);function a(t){if("undefined"!=typeof window&&"object"===Object(n.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===Object(n.a)(e.versions)&&Boolean(e.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":Object(n.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,a=t||r;return!!(a&&a.indexOf("Electron")>=0)}}).call(this,r(12))},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?e.exports=n=function(e){return r(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},n(t)}e.exports=n},function(e,t,r){"use strict";(function(e){var n=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){if("undefined"!=typeof window&&"object"===(0,a.default)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===(0,a.default)(e.versions)&&Boolean(e.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":(0,a.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=t||r;if(n&&n.indexOf("Electron")>=0)return!0;return!1};var a=n(r(19))}).call(this,r(12))},,function(e,t,r){"use strict";(function(e){var t=r(25),n=r(1),a=r(13);function i(e,{extension:t,target:r,target2:i}){const s=a.b[t];Object(n.a)(s);const{meta:o={}}=s,{suffix:E=""}=o,u=e.getExtension(t);for(const t of Object.keys(s)){const n=`${t}${E}`;let a=null;"meta"===t||"function"==typeof e[t]||(u&&"function"==typeof u[n]?a=(...e)=>u[n](...e):"function"==typeof s[t]&&(a=s[t].bind(r))),a&&(r[t]=a,i[t]=a)}}(void 0!==e?e:window).polyfillContext=function(e){return e.luma=e.luma||{},e.luma.polyfilled||(Object(t.a)(e),function(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const r of t)e.luma[r]=e.getExtension(r)}(e),function(e,t){for(const r of Object.getOwnPropertyNames(t))"overrides"!==r&&i(e,{extension:r,target:e.luma,target2:e})}(e,a.b),function(e,{target:t,target2:r}){Object.keys(a.a).forEach(n=>{if("function"==typeof a.a[n]){const i=e[n]?e[n].bind(e):()=>{},s=a.a[n].bind(null,e,i);t[n]=s,r[n]=s}})}(e,{target:e.luma,target2:e}),e.luma.polyfilled=!0),e}}).call(this,r(14))},function(e,t,r){"use strict";(function(e,n){var a=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.console=t.process=t.document=t.global=t.window=t.self=void 0;var i=a(r(19)),s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":(0,i.default)(n))&&n},o=s.self||s.window||s.global;t.self=o;var E=s.window||s.self||s.global;t.window=E;var u=s.global||s.self||s.window;t.global=u;var _=s.document||{};t.document=_;var c=s.process||{};t.process=c;var l=console;t.console=l}).call(this,r(14),r(12))},function(e,t,r){"use strict";(function(e){var n=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.isBrowserMainThread=function(){return s()&&"undefined"!=typeof document};var a=n(r(19)),i=n(r(20));function s(){return!("object"===(void 0===e?"undefined":(0,a.default)(e))&&"[object process]"===String(e)&&!e.browser)||(0,i.default)()}}).call(this,r(12))},function(e,t,r){"use strict";r.d(t,"a",function(){return E});var n=r(3);const a={};function i(e,t){var r;a[e]=!0,void 0!==t&&(r=t,n.global.console&&n.global.console.error&&n.global.console.error(r))}const s=function e(t){const r=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let t=0;t<this.attribs.length;t++){const n=new e.VertexAttrib(r);this.attribs[t]=n}this.maxAttrib=0};(s.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const o=function(e){const t=this;this.gl=e,function(e){const t=e.getError;e.getError=function(){let r;do{(r=t.apply(e))!==e.NO_ERROR&&(a[r]=!0)}while(r!==e.NO_ERROR);for(r in a)if(a[r])return delete a[r],parseInt(r,10);return e.NO_ERROR}}(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const n=t.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,e),n.attribs[e].enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const n=t.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,e),n.attribs[e].enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(n,a){switch(n){case e.ARRAY_BUFFER:t.currentArrayBuffer=a;break;case e.ELEMENT_ARRAY_BUFFER:t.currentVertexArrayObject.elementArrayBuffer=a}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(n,a){const i=t.currentVertexArrayObject.attribs[n];switch(a){case e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case e.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case e.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case e.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case e.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case e.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,n,a,i,s,o){const E=t.currentVertexArrayObject;E.maxAttrib=Math.max(E.maxAttrib,e);const u=E.attribs[e];return u.buffer=t.currentArrayBuffer,u.size=n,u.type=a,u.normalized=i,u.stride=s,u.offset=o,u.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{!function(e){n.global.console&&n.global.console.log&&n.global.console.log(e)}("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};function E(e){if("function"==typeof e.createVertexArray)return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const r=e.getExtension;e.getExtension=function(t){const n=r.call(this,t);return n||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new o(this)),this.__OESVertexArrayObject))}}o.prototype.VERTEX_ARRAY_BINDING_OES=34229,o.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new s(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},o.prototype.createVertexArrayOES=function(){const e=new s(this);return this.vertexArrayObjects.push(e),e},o.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},o.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof s&&e.hasBeenBound&&e.ext===this)},o.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void i(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject");const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const a=this.currentVertexArrayObject;if(n===a)return;n&&a.elementArrayBuffer===n.elementArrayBuffer||r.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,a.elementArrayBuffer);let s=this.currentArrayBuffer;const o=Math.max(n?n.maxAttrib:0,a.maxAttrib);for(let e=0;e<=o;e++){const i=a.attribs[e],o=n?n.attribs[e]:null;if(n&&i.enabled===o.enabled||(i.enabled?r.enableVertexAttribArray.call(t,e):r.disableVertexAttribArray.call(t,e)),i.enabled){let a=!1;n&&i.buffer===o.buffer||(s!==i.buffer&&(r.bindBuffer.call(t,t.ARRAY_BUFFER,i.buffer),s=i.buffer),a=!0),(a||i.cached!==o.cached)&&r.vertexAttribPointer.call(t,e,i.size,i.type,i.normalized,i.stride,i.offset)}}this.currentArrayBuffer!==s&&r.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)}},function(e,t,r){(function(t){const n=r(32),a="undefined"==typeof window?t:window;a.loaders=a.luma||{},e.exports=Object.assign(a.luma,n)}).call(this,r(14))},,function(e,t,r){"use strict";var n=r(15),a=r(29);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"self",{enumerable:!0,get:function(){return i.self}}),Object.defineProperty(t,"window",{enumerable:!0,get:function(){return i.window}}),Object.defineProperty(t,"global",{enumerable:!0,get:function(){return i.global}}),Object.defineProperty(t,"document",{enumerable:!0,get:function(){return i.document}}),Object.defineProperty(t,"process",{enumerable:!0,get:function(){return i.process}}),Object.defineProperty(t,"console",{enumerable:!0,get:function(){return i.console}}),Object.defineProperty(t,"isBrowser",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"isBrowserMainThread",{enumerable:!0,get:function(){return s.isBrowserMainThread}}),Object.defineProperty(t,"getBrowser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"isMobile",{enumerable:!0,get:function(){return o.isMobile}}),Object.defineProperty(t,"isElectron",{enumerable:!0,get:function(){return E.default}});var i=r(23),s=a(r(24)),o=a(r(30)),E=n(r(20))},function(e,t){e.exports=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}},function(e,t,r){"use strict";var n=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.isMobile=function(){return void 0!==a.window.orientation},t.default=function(e){if(!e&&!(0,i.default)())return"Node";if((0,s.default)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},r=e||t.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),o=-1!==r.indexOf("Trident/");if(n||o)return"IE";if(a.window.chrome)return"Chrome";if(a.window.safari)return"Safari";if(a.window.mozInnerScreenX)return"Firefox";return"Unknown"};var a=r(23),i=n(r(24)),s=n(r(20))},function(e,t){},function(e,t,r){"use strict";r.r(t);r(22);var n=r(9),a=(r(8),r(0)),i=r.n(a),s=r(3),o=r(1);const E=Object(s.isBrowser)();function u(e){const t=e.getParameter(i.a.VENDOR),r=e.getParameter(i.a.RENDERER),n=e.getExtension("WEBGL_debug_renderer_info");return{vendor:n&&e.getParameter(n.UNMASKED_VENDOR_WEBGL||i.a.VENDOR)||t,renderer:n&&e.getParameter(n.UNMASKED_RENDERER_WEBGL||i.a.RENDERER)||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(i.a.VERSION),shadingLanguageVersion:e.getParameter(i.a.SHADING_LANGUAGE_VERSION)}}var _=r(10),c=r(11),l=r(16),A=function(){function e(t,r){Object(_.a)(this,e),this.name=t,this.type=r,this.sampleSize=1,this.reset()}return Object(c.a)(e,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(l.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(l.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),e}(),f=function(){function e(t){var r=t.id,n=t.stats;Object(_.a)(this,e),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return Object(c.a)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var t in this.stats)e(this.stats[t])}},{key:"getTable",value:function(){var e={};return this.forEach(function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){return e._getOrCreate(t)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var t=e.name,r=e.type;return this.stats[t]||(this.stats[t]=e instanceof A?e:new A(t,r)),this.stats[t]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),e}();const h="8.2.0-beta.1";const T=new class{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new f({id:e})),this.stats.get(e)}};if(s.global.luma&&s.global.luma.VERSION!==h)throw new Error(`luma.gl - multiple VERSIONs detected: ${s.global.luma.VERSION} vs ${h}`);s.global.luma||(Object(s.isBrowser)()&&o.g.log(1,`luma.gl ${h} - set luma.log.level=1 (or higher) to trace rendering`)(),s.global.luma=s.global.luma||{VERSION:h,version:h,log:o.g,stats:T,globals:{modules:{},nodeIO:{}}});s.global.luma;function R(e){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function d(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function g(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const N="Invalid WebGLRenderingContext",m="Requires WebGL2";function F(e){g(Object(o.e)(e),N)}function O(e){g(Object(o.f)(e),m)}function b(e,t){if("string"!=typeof t)return t;const r=Number(t);if(!isNaN(r))return r;const n=e[t=t.replace(/^.*\./,"")];return g(void 0!==n,`Accessing undefined constant GL.${t}`),n}function S(e,t){t=Number(t);for(const r in e)if(e[r]===t)return`GL.${r}`;return String(t)}const I={};function L(e="id"){return I[e]=I[e]||1,`${e}-${I[e]++}`}function B(e){return g("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function C(e){let t=!0;for(const r in e){t=!1;break}return t}function M(e,t,r,n){const a=`See luma.gl ${r} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,i=Object.getPrototypeOf(e);n.forEach(e=>{i.methodName||(i[e]=()=>{throw o.g.removed(`Calling removed method ${t}.${e}: `,a)(),new Error(e)})})}const p="Resource subclass must define virtual methods";class U{constructor(e,t={}){F(e);const{id:r,userData:n={}}=t;this.gl=e,this.id=r||L(this.constructor.name),this.userData=n,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(e=>{e.delete()}),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){g(e=b(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const e=Object(o.f)(this.gl);if(!((!("webgl2"in r)||e)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const t=r.webgl1,n="webgl2"in r?r.webgl2:r.webgl1;return e?n:t}}return this._getParameter(e,t)}getParameters(e={}){const{parameters:t,keys:r}={},n=this.constructor.PARAMETERS||{},a=Object(o.f)(this.gl),i={},s=t||Object.keys(n);for(const t of s){const s=n[t];if(s&&(!("webgl2"in s)||a)&&(!("extension"in s)||this.gl.getExtension(s.extension))){const n=r?S(this.gl,t):t;i[n]=this.getParameter(t,e),r&&"GLenum"===s.type&&(i[n]=S(this.gl,i[n]))}}return i}setParameter(e,t){g(e=b(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const e=Object(o.f)(this.gl);if(!((!("webgl2"in r)||e)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(t=b(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return M(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(p)}_deleteHandle(){throw new Error(p)}_bindHandle(){throw new Error(p)}_getOptsFromHandle(){throw new Error(p)}_getParameter(e,t){throw new Error(p)}_setParameter(e,t){throw new Error(p)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,t=T.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this.constructor.name;T.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,t=this.constructor.name){const r=T.get("Memory Usage");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const t=T.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const y="Failed to deduce GL constant from typed array";function P(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return i.a.FLOAT;case Uint16Array:return i.a.UNSIGNED_SHORT;case Uint32Array:return i.a.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return i.a.UNSIGNED_BYTE;case Int8Array:return i.a.BYTE;case Int16Array:return i.a.SHORT;case Int32Array:return i.a.INT;default:throw new Error(y)}}function D(e,{clamped:t=!0}={}){switch(e){case i.a.FLOAT:return Float32Array;case i.a.UNSIGNED_SHORT:case i.a.UNSIGNED_SHORT_5_6_5:case i.a.UNSIGNED_SHORT_4_4_4_4:case i.a.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case i.a.UNSIGNED_INT:return Uint32Array;case i.a.UNSIGNED_BYTE:return t?Uint8ClampedArray:Uint8Array;case i.a.BYTE:return Int8Array;case i.a.SHORT:return Int16Array;case i.a.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function v({data:e,width:t,height:r}){const n=Math.round(t/2),a=Math.round(r/2),i=new Uint8Array(n*a*4);for(let r=0;r<a;r++)for(let a=0;a<n;a++)for(let s=0;s<4;s++)i[4*(r*n+a)+s]=e[4*(2*r*t+2*a)+s];return{data:i,width:n,height:a}}function G(e,t,r){const{removedProps:n={},deprecatedProps:a={},replacedProps:i={}}=r;for(const r in n)if(r in t){const t=n[r]?`${e}.${n[r]}`:"N/A";o.g.removed(`${e}.${r}`,t)()}for(const r in a)if(r in t){const t=a[r];o.g.deprecated(`${e}.${r}`,`${e}.${t}`)()}let s=null;for(const r in i)if(r in t){const n=i[r];o.g.deprecated(`${e}.${r}`,`${e}.${n}`)(),(s=s||Object.assign({},t))[n]=t[r],delete s[r]}return s||t}const x={offset:0,stride:0,type:i.a.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},w={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class H{static getBytesPerElement(e){return D(e.type||i.a.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return g(e.size),D(e.type||i.a.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new H(...[x,...e])}constructor(...e){e.forEach(e=>this._assign(e)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return H.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return H.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=G("Accessor",e,w)).type&&(this.type=e.type,e.type!==i.a.INT&&e.type!==i.a.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const X=10,V={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},j={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:V},W={removedProps:V};class k extends U{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?i.a.COPY_READ_BUFFER:i.a.ARRAY_BUFFER),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/H.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/H.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=G("Buffer",e,j),this.usage=e.usage||i.a.STATIC_DRAW,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=G("Buffer",e,W))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new H(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,a=e.byteLength||e.length;g(t);const s=this.gl.webgl2?i.a.COPY_WRITE_BUFFER:this.target;return this.gl.bindBuffer(s,this.handle),0!==n||void 0!==a?(O(this.gl),this.gl.bufferSubData(this.target,r,t,n,a)):this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:r=0,size:n}){const{gl:a}=this;return O(a),a.bindBuffer(i.a.COPY_READ_BUFFER,e.handle),a.bindBuffer(i.a.COPY_WRITE_BUFFER,this.handle),a.copyBufferSubData(i.a.COPY_READ_BUFFER,i.a.COPY_WRITE_BUFFER,t,r,n),a.bindBuffer(i.a.COPY_READ_BUFFER,null),a.bindBuffer(i.a.COPY_WRITE_BUFFER,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}={}){O(this.gl);const a=D(this.accessor.type||i.a.FLOAT,{clamped:!1}),s=this._getAvailableElementCount(t),o=r;let E,u;e?E=(u=e.length)-o:u=o+(E=Math.min(s,n||s));const _=Math.min(s,E);return g((n=n||_)<=_),e=e||new a(u),this.gl.bindBuffer(i.a.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(i.a.COPY_READ_BUFFER,t,e,r,n),this.gl.bindBuffer(i.a.COPY_READ_BUFFER,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}={}){return e===i.a.UNIFORM_BUFFER||e===i.a.TRANSFORM_FEEDBACK_BUFFER?void 0!==n?this.gl.bindBufferRange(e,t,this.handle,r,n):(g(0===r),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return e===i.a.UNIFORM_BUFFER||e===i.a.TRANSFORM_FEEDBACK_BUFFER?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(X,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=0,r=e.byteLength+t){g(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,X),this.bytesUsed=r,this._trackAllocatedMemory(r);const a=P(e);return g(a),this.setAccessor(new H(this.accessor,{type:a})),this}_setByteLength(e,t=this.usage){g(e>=0),this._trackDeallocatedMemory();let r=e;0===e&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?i.a.COPY_WRITE_BUFFER:this.target}_getAvailableElementCount(e){const t=e/D(this.accessor.type||i.a.FLOAT,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}_inferType(e){this.accessor.type||this.setAccessor(new H(this.accessor,{type:P(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return o.g.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return o.g.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return o.g.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return o.g.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new H(this.accessor,e),this}}const K={[i.a.RGB]:{dataFormat:i.a.RGB,types:[i.a.UNSIGNED_BYTE,i.a.UNSIGNED_SHORT_5_6_5]},[i.a.RGBA]:{dataFormat:i.a.RGBA,types:[i.a.UNSIGNED_BYTE,i.a.UNSIGNED_SHORT_4_4_4_4,i.a.UNSIGNED_SHORT_5_5_5_1]},[i.a.ALPHA]:{dataFormat:i.a.ALPHA,types:[i.a.UNSIGNED_BYTE]},[i.a.LUMINANCE]:{dataFormat:i.a.LUMINANCE,types:[i.a.UNSIGNED_BYTE]},[i.a.LUMINANCE_ALPHA]:{dataFormat:i.a.LUMINANCE_ALPHA,types:[i.a.UNSIGNED_BYTE]},[i.a.R32F]:{dataFormat:i.a.RED,types:[i.a.FLOAT],gl2:!0},[i.a.RG32F]:{dataFormat:i.a.RG,types:[i.a.FLOAT],gl2:!0},[i.a.RGB32F]:{dataFormat:i.a.RGB,types:[i.a.FLOAT],gl2:!0},[i.a.RGBA32F]:{dataFormat:i.a.RGBA,types:[i.a.FLOAT],gl2:!0}},Y={[i.a.RED]:1,[i.a.RED_INTEGER]:1,[i.a.RG]:2,[i.a.RG_INTEGER]:2,[i.a.RGB]:3,[i.a.RGB_INTEGER]:3,[i.a.RGBA]:4,[i.a.RGBA_INTEGER]:4,[i.a.DEPTH_COMPONENT]:1,[i.a.DEPTH_STENCIL]:1,[i.a.ALPHA]:1,[i.a.LUMINANCE]:1,[i.a.LUMINANCE_ALPHA]:2},z={[i.a.FLOAT]:4,[i.a.UNSIGNED_INT]:4,[i.a.INT]:4,[i.a.UNSIGNED_SHORT]:2,[i.a.SHORT]:2,[i.a.HALF_FLOAT]:2,[i.a.BYTE]:1,[i.a.UNSIGNED_BYTE]:1};const $=[i.a.LINEAR,i.a.NEAREST],Z=s.global.WebGLBuffer||function(){};class Q extends U{static isSupported(e,{format:t,linearFiltering:r}={}){let n=!0;return t&&(n=(n=n&&function(e,t){const r=K[t];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;const n=Object(o.f)(e)&&r.gl2||r.gl1;return"string"==typeof n?e.getExtension(n):n}(e,t))&&(!r||function(e,t){const r=K[t];switch(r&&r.types[0]){case i.a.FLOAT:return e.getExtension("OES_texture_float_linear");case i.a.HALF_FLOAT:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,t))),n}constructor(e,t){const{id:r=L("texture"),handle:n,target:a}=t;super(e,{id:r,handle:n}),this.target=a,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let t=e.data;if(t instanceof Promise)return t.then(t=>this.initialize(Object.assign({},e,{pixels:t,data:t}))),this;const{pixels:r=null,format:n=i.a.RGBA,border:a=0,recreate:s=!1,parameters:E={},pixelStore:u={},textureUnit:_}=e;let{mipmaps:c=!0}=e;t||(t=r);let{width:l,height:A,dataFormat:f,type:h}=e;const{depth:T=0}=e;return({width:l,height:A,dataFormat:f,type:h}=this._deduceParameters({format:n,type:h,dataFormat:f,compressed:!1,data:t,width:l,height:A})),this.width=l,this.height=A,this.depth=T,this.format=n,this.type=h,this.dataFormat=f,this.border=a,this.textureUnit=_,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(i.a.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),c&&this._isNPOT()&&(o.g.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),c=!1,this._updateForNPOT(E)),this.mipmaps=c,this.setImageData({data:t,width:l,height:A,depth:T,format:n,type:h,dataFormat:f,border:a,mipmaps:c,parameters:u}),c&&this.generateMipmap(),this.setParameters(E),s&&(this.data=t),this}resize({height:e,width:t,mipmaps:r=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(e={}){return this._isNPOT()?(o.g.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Object(n.c)(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:a=0,format:s=this.format,border:E=this.border,offset:u=0,parameters:_={}}=e;let{data:c=null,type:l=this.type,width:A=this.width,height:f=this.height,dataFormat:h=this.dataFormat,compressed:T=!1}=e;c||(c=r),({type:l,dataFormat:h,compressed:T,width:A,height:f}=this._deduceParameters({format:s,type:l,dataFormat:h,compressed:T,data:c,width:A,height:f}));const{gl:R}=this;R.bindTexture(this.target,this.handle);let d=null;if(({data:c,dataType:d}=this._getDataType({data:c,compressed:T})),Object(n.c)(this.gl,_,()=>{switch(d){case"null":R.texImage2D(t,a,s,A,f,E,h,l,c);break;case"typed-array":R.texImage2D(t,a,s,A,f,E,h,l,c,u);break;case"buffer":O(R),R.bindBuffer(i.a.PIXEL_UNPACK_BUFFER,c.handle||c),R.texImage2D(t,a,s,A,f,E,h,l,u),R.bindBuffer(i.a.PIXEL_UNPACK_BUFFER,null);break;case"browser-object":Object(o.f)(R)?R.texImage2D(t,a,s,A,f,E,h,l,c):R.texImage2D(t,a,s,h,l,c);break;case"compressed":R.compressedTexImage2D(t,a,s,A,f,E,c);break;default:g(!1,"Unknown image data type")}}),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const e=Y[this.dataFormat]||4,t=z[this.type]||1;this._trackAllocatedMemory(this.width*this.height*e*t,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:r=null,x:a=0,y:s=0,width:E=this.width,height:u=this.height,level:_=0,format:c=this.format,type:l=this.type,dataFormat:A=this.dataFormat,compressed:f=!1,offset:h=0,border:T=this.border,parameters:R={}}){if(({type:l,dataFormat:A,compressed:f,width:E,height:u}=this._deduceParameters({format:c,type:l,dataFormat:A,compressed:f,data:r,width:E,height:u})),g(0===this.depth,"texSubImage not supported for 3D textures"),r||(r=t),r&&r.data){const e=r;r=e.data,E=e.shape[0],u=e.shape[1]}r instanceof k&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Object(n.c)(this.gl,R,()=>{f?this.gl.compressedTexSubImage2D(e,_,a,s,E,u,c,r):null===r?this.gl.texSubImage2D(e,_,a,s,E,u,A,l,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(e,_,a,s,E,u,A,l,r,h):r instanceof Z?(O(this.gl),this.gl.bindBuffer(i.a.PIXEL_UNPACK_BUFFER,r),this.gl.texSubImage2D(e,_,a,s,E,u,A,l,h),this.gl.bindBuffer(i.a.PIXEL_UNPACK_BUFFER,null)):Object(o.f)(this.gl)?this.gl.texSubImage2D(e,_,a,s,E,u,A,l,r):this.gl.texSubImage2D(e,_,a,s,A,l,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return o.g.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(i.a.ACTIVE_TEXTURE)-i.a.TEXTURE0}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof k?{data:e.handle,dataType:"buffer"}:e instanceof Z?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:a,dataFormat:i,type:s,compressed:o}=e;const E=K[t];return i=i||E&&E.dataFormat,s=s||E&&E.types[0],o=o||E&&E.compressed,({width:n,height:a}=this._deduceImageSize(r,n,a)),{dataFormat:i,type:s,compressed:o,width:n,height:a,format:t,data:r}}_deduceImageSize(e,t,r){let n;return g(n="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement?{width:e.width,height:e.height}:"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:r}:{width:t>=0?t:1,height:r>=0?r:1},"Could not deduced texture size"),g(void 0===t||n.width===t,"Deduced texture width does not match supplied width"),g(void 0===r||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case i.a.TEXTURE_WIDTH:return this.width;case i.a.TEXTURE_HEIGHT:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case i.a.TEXTURE_MIN_LOD:case i.a.TEXTURE_MAX_LOD:this.gl.texParameterf(this.handle,e,t);break;case i.a.TEXTURE_WIDTH:case i.a.TEXTURE_HEIGHT:g(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!Object(o.f)(this.gl)&&(!(!this.width||!this.height)&&(!B(this.width)||!B(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case i.a.TEXTURE_MIN_FILTER:-1===$.indexOf(t)&&(t=i.a.LINEAR);break;case i.a.TEXTURE_WRAP_S:case i.a.TEXTURE_WRAP_T:t!==i.a.CLAMP_TO_EDGE&&(t=i.a.CLAMP_TO_EDGE)}return t}}let q="";function J(e){q=e}function ee(e,t={}){g("string"==typeof e),e=q+e;const r=t.dataType||"text";return fetch(e,t).then(e=>e[r]())}function te(e,t){return g("string"==typeof e),e=q+e,new Promise((r,n)=>{try{const a=new Image;a.onload=()=>r(a),a.onerror=()=>n(new Error(`Could not load image ${e}.`)),a.crossOrigin=t&&t.crossOrigin||"anonymous",a.src=e}catch(e){n(e)}})}class re extends Q{static isSupported(e,t){return Q.isSupported(e,t)}constructor(e,t={}){F(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:te(t.data)})),super(e,Object.assign({},t,{target:i.a.TEXTURE_2D})),this.initialize(t),Object.seal(this)}}const ne=[i.a.TEXTURE_CUBE_MAP_POSITIVE_X,i.a.TEXTURE_CUBE_MAP_NEGATIVE_X,i.a.TEXTURE_CUBE_MAP_POSITIVE_Y,i.a.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.a.TEXTURE_CUBE_MAP_POSITIVE_Z,i.a.TEXTURE_CUBE_MAP_NEGATIVE_Z];class ae extends Q{constructor(e,t={}){F(e),super(e,Object.assign({},t,{target:i.a.TEXTURE_CUBE_MAP})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:r={}}=e;this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)})}subImage({face:e,data:t,x:r=0,y:n=0,mipmapLevel:a=0}){return this._subImage({target:e,data:t,x:r,y:n,mipmapLevel:a})}async setCubeMapImageData({width:e,height:t,pixels:r,data:n,border:a=0,format:s=i.a.RGBA,type:E=i.a.UNSIGNED_BYTE}){const{gl:u}=this,_=r||n,c=await Promise.all(ne.map(e=>{const t=_[e];return Promise.all(Array.isArray(t)?t:[t])}));this.bind(),ne.forEach((r,n)=>{c[n].length>1&&!1!==this.opts.mipmaps&&o.g.warn(`${this.id} has mipmap and multiple LODs.`)(),c[n].forEach((n,i)=>{e&&t?u.texImage2D(r,i,s,e,t,a,s,E,n):u.texImage2D(r,i,s,s,E,n)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:a,data:s,border:o=0,format:E=i.a.RGBA,type:u=i.a.UNSIGNED_BYTE}=e,{gl:_}=this,c=a||s;return this.bind(),c instanceof Promise?c.then(r=>this.setImageDataForFace(Object.assign({},e,{face:t,data:r,pixels:r}))):this.width||this.height?_.texImage2D(t,0,E,r,n,o,E,u,c):_.texImage2D(t,0,E,E,u,c),this}}ae.FACES=ne;class ie extends Q{static isSupported(e){return Object(o.f)(e)}constructor(e,t={}){O(e),super(e,t=Object.assign({depth:1},t,{target:i.a.TEXTURE_3D,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=i.a.RGBA,width:r,height:a,depth:s=1,border:o=0,format:E,type:u=i.a.UNSIGNED_BYTE,offset:_=0,data:c,parameters:l={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Object(n.c)(this.gl,l,()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,t,r,a,s,o,E,u,c),c instanceof k&&(this.gl.bindBuffer(i.a.PIXEL_UNPACK_BUFFER,c.handle),this.gl.texImage3D(this.target,e,t,r,a,s,o,E,u,_))}),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const e=Y[this.dataFormat]||4,t=z[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*e*t,"Texture")}return this.loaded=!0,this}}const se="EXT_color_buffer_float";var oe={[i.a.DEPTH_COMPONENT16]:{bpp:2},[i.a.DEPTH_COMPONENT24]:{gl2:!0,bpp:3},[i.a.DEPTH_COMPONENT32F]:{gl2:!0,bpp:4},[i.a.STENCIL_INDEX8]:{bpp:1},[i.a.DEPTH_STENCIL]:{bpp:4},[i.a.DEPTH24_STENCIL8]:{gl2:!0,bpp:4},[i.a.DEPTH32F_STENCIL8]:{gl2:!0,bpp:5},[i.a.RGBA4]:{bpp:2},[i.a.RGB565]:{bpp:2},[i.a.RGB5_A1]:{bpp:2},[i.a.R8]:{gl2:!0,bpp:1},[i.a.R8UI]:{gl2:!0,bpp:1},[i.a.R8I]:{gl2:!0,bpp:1},[i.a.R16UI]:{gl2:!0,bpp:2},[i.a.R16I]:{gl2:!0,bpp:2},[i.a.R32UI]:{gl2:!0,bpp:4},[i.a.R32I]:{gl2:!0,bpp:4},[i.a.RG8]:{gl2:!0,bpp:2},[i.a.RG8UI]:{gl2:!0,bpp:2},[i.a.RG8I]:{gl2:!0,bpp:2},[i.a.RG16UI]:{gl2:!0,bpp:4},[i.a.RG16I]:{gl2:!0,bpp:4},[i.a.RG32UI]:{gl2:!0,bpp:8},[i.a.RG32I]:{gl2:!0,bpp:8},[i.a.RGB8]:{gl2:!0,bpp:3},[i.a.RGBA8]:{gl2:!0,bpp:4},[i.a.RGB10_A2]:{gl2:!0,bpp:4},[i.a.RGBA8UI]:{gl2:!0,bpp:4},[i.a.RGBA8I]:{gl2:!0,bpp:4},[i.a.RGB10_A2UI]:{gl2:!0,bpp:4},[i.a.RGBA16UI]:{gl2:!0,bpp:8},[i.a.RGBA16I]:{gl2:!0,bpp:8},[i.a.RGBA32I]:{gl2:!0,bpp:16},[i.a.RGBA32UI]:{gl2:!0,bpp:16},[i.a.R16F]:{gl2:se,bpp:2},[i.a.RG16F]:{gl2:se,bpp:4},[i.a.RGBA16F]:{gl2:se,bpp:8},[i.a.R32F]:{gl2:se,bpp:4},[i.a.RG32F]:{gl2:se,bpp:8},[i.a.RGBA32F]:{gl2:se,bpp:16},[i.a.R11F_G11F_B10F]:{gl2:se,bpp:4}};class Ee extends U{static isSupported(e,{format:t}={}){return!t||function(e,t,r){const n=r[t];if(!n)return!1;const a=Object(o.f)(e)&&n.gl2||n.gl1;return"string"==typeof a?e.getExtension(a):a}(e,t,oe)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(i.a.RENDERBUFFER,t,i.a.SAMPLES)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:r=1,samples:n=0}){return g(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(i.a.RENDERBUFFER,this.handle),0!==n&&Object(o.f)(this.gl)?this.gl.renderbufferStorageMultisample(i.a.RENDERBUFFER,n,e,t,r):this.gl.renderbufferStorage(i.a.RENDERBUFFER,e,t,r),this.format=e,this.width=t,this.height=r,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*oe[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(i.a.RENDERBUFFER,e)}_syncHandle(e){this.format=this.getParameter(i.a.RENDERBUFFER_INTERNAL_FORMAT),this.width=this.getParameter(i.a.RENDERBUFFER_WIDTH),this.height=this.getParameter(i.a.RENDERBUFFER_HEIGHT),this.samples=this.getParameter(i.a.RENDERBUFFER_SAMPLES)}_getParameter(e){return this.gl.bindRenderbuffer(i.a.RENDERBUFFER,this.handle),this.gl.getRenderbufferParameter(i.a.RENDERBUFFER,e)}}const ue=256,_e=1024,ce=16384,le=6144,Ae=6145,fe=6146,he=34041,Te="clear: bad arguments";function Re(e,{framebuffer:t=null,color:r=null,depth:a=null,stencil:i=null}={}){const s={};t&&(s.framebuffer=t);let o=0;r&&(o|=ce,!0!==r&&(s.clearColor=r)),a&&(o|=ue,!0!==a&&(s.clearDepth=a)),i&&(o|=_e,!0!==a&&(s.clearStencil=a)),g(0!==o,Te),Object(n.c)(e,s,()=>{e.clear(o)})}function de(e,{framebuffer:t=null,buffer:r=le,drawBuffer:a=0,value:i=[0,0,0,0]}={}){O(e),Object(n.c)(e,{framebuffer:t},()=>{switch(r){case le:switch(i.constructor){case Int32Array:e.clearBufferiv(r,a,i);break;case Uint32Array:e.clearBufferuiv(r,a,i);break;case Float32Array:default:e.clearBufferfv(r,a,i)}break;case Ae:e.clearBufferfv(Ae,0,[i]);break;case fe:e.clearBufferiv(fe,0,[i]);break;case he:const[t,n]=i;e.clearBufferfi(he,0,t,n);break;default:g(!1,Te)}})}function ge(e){switch(e){case i.a.ALPHA:case i.a.R32F:case i.a.RED:return 1;case i.a.RG32F:case i.a.RG:return 2;case i.a.RGB:case i.a.RGB32F:return 3;case i.a.RGBA:case i.a.RGBA32F:return 4;default:return g(!1),0}}function Ne(e,{sourceX:t=0,sourceY:r=0,sourceFormat:n=i.a.RGBA,sourceAttachment:a=i.a.COLOR_ATTACHMENT0,target:s=null,sourceWidth:o,sourceHeight:E,sourceType:u}={}){const{framebuffer:_,deleteFramebuffer:c}=Ie(e);g(_);const{gl:l,handle:A,attachments:f}=_;o=o||_.width,E=E||_.height,a===i.a.COLOR_ATTACHMENT0&&null===A&&(a=i.a.FRONT),g(f[a]),s=function(e,t,r,n,a){if(e)return e;const s=D(t=t||i.a.UNSIGNED_BYTE,{clamped:!1}),o=ge(r);return new s(n*a*o)}(s,u=u||f[a].type,n,o,E),u=u||P(s);const h=l.bindFramebuffer(i.a.FRAMEBUFFER,A);return l.readPixels(t,r,o,E,n,u,s),l.bindFramebuffer(i.a.FRAMEBUFFER,h||null),c&&_.delete(),s}function me(e,{sourceX:t=0,sourceY:r=0,sourceFormat:a=i.a.RGBA,target:s=null,targetByteOffset:o=0,sourceWidth:E,sourceHeight:u,sourceType:_}){const{framebuffer:c,deleteFramebuffer:l}=Ie(e);g(c);const{gl:A}=c;if(E=E||c.width,u=u||c.height,O(A),_=_||(s?s.type:i.a.UNSIGNED_BYTE),!s){const e=ge(a),t=function(e){switch(e){case i.a.UNSIGNED_BYTE:return 1;case i.a.UNSIGNED_SHORT_5_6_5:case i.a.UNSIGNED_SHORT_4_4_4_4:case i.a.UNSIGNED_SHORT_5_5_5_1:return 2;case i.a.FLOAT:return 4;default:return g(!1),0}}(_);s=new k(A,{byteLength:o+E*u*e*t,accessor:{type:_,size:e}})}return s.bind({target:i.a.PIXEL_PACK_BUFFER}),Object(n.c)(A,{framebuffer:c},()=>{A.readPixels(t,r,E,u,a,_,o)}),s.unbind({target:i.a.PIXEL_PACK_BUFFER}),l&&c.delete(),s}function Fe(e,{sourceAttachment:t=i.a.COLOR_ATTACHMENT0,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}={}){let n=Ne(e,{sourceAttachment:t}),{width:a,height:s}=e;for(;s>r;)({data:n,width:a,height:s}=v({data:n,width:a,height:s}));!function({data:e,width:t,height:r,bytesPerPixel:n=4,temp:a}){const i=t*n;a=a||new Uint8Array(i);for(let t=0;t<r/2;++t){const n=t*i,s=(r-t-1)*i;a.set(e.subarray(n,n+i)),e.copyWithin(n,s,s+i),e.set(a,s)}}({data:n,width:a,height:s});const o=document.createElement("canvas");o.width=a,o.height=s;const E=o.getContext("2d"),u=E.createImageData(a,s);return u.data.set(n),E.putImageData(u,0,0),o.toDataURL()}function Oe(e,{sourceAttachment:t=i.a.COLOR_ATTACHMENT0,targetImage:r=null}={}){const n=Fe(e,{sourceAttachment:t});return(r=r||new Image).src=n,r}function be(e,t,{sourceX:r=0,sourceY:n=0,targetX:a,targetY:s,targetZ:o,targetMipmaplevel:E=0,targetInternalFormat:u=i.a.RGBA,width:_,height:c}={}){const{framebuffer:l,deleteFramebuffer:A}=Ie(e);g(l);const{gl:f,handle:h}=l,T=void 0!==a||void 0!==s||void 0!==o;a=a||0,s=s||0,o=o||0;const R=f.bindFramebuffer(i.a.FRAMEBUFFER,h);g(t);let d=null;if(t instanceof Q&&(d=t,_=Number.isFinite(_)?_:d.width,c=Number.isFinite(c)?c:d.height,d.bind(0),t=d.target),T)switch(t){case i.a.TEXTURE_2D:case i.a.TEXTURE_CUBE_MAP:f.copyTexSubImage2D(t,E,a,s,r,n,_,c);break;case i.a.TEXTURE_2D_ARRAY:case i.a.TEXTURE_3D:f.copyTexSubImage3D(t,E,a,s,o,r,n,_,c)}else f.copyTexImage2D(t,E,u,r,n,_,c,0);return d&&d.unbind(),f.bindFramebuffer(i.a.FRAMEBUFFER,R||null),A&&l.delete(),d}function Se(e,t,{sourceAttachment:r=i.a.COLOR_ATTACHMENT0,sourceX0:n=0,sourceY0:a=0,sourceX1:s,sourceY1:E,targetX0:u=0,targetY0:_=0,targetX1:c,targetY1:l,color:A=!0,depth:f=!1,stencil:h=!1,mask:T=0,filter:R=i.a.NEAREST}={}){const{framebuffer:d,deleteFramebuffer:N}=Ie(e),{framebuffer:m,deleteFramebuffer:F}=Ie(t);g(d),g(m);const{gl:b,handle:S,width:I,height:L,readBuffer:B}=m;O(b),d.handle||r!==i.a.COLOR_ATTACHMENT0||(r=i.a.FRONT),A&&(T|=i.a.COLOR_BUFFER_BIT),f&&(T|=i.a.DEPTH_BUFFER_BIT),h&&(T|=i.a.STENCIL_BUFFER_BIT),(N||F)&&T&(i.a.DEPTH_BUFFER_BIT|i.a.STENCIL_BUFFER_BIT)&&(T=i.a.COLOR_BUFFER_BIT,o.g.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")()),g(T),s=void 0===s?d.width:s,E=void 0===E?d.height:E,c=void 0===c?I:c,l=void 0===l?L:l;const C=b.bindFramebuffer(i.a.DRAW_FRAMEBUFFER,S),M=b.bindFramebuffer(i.a.READ_FRAMEBUFFER,d.handle);return b.readBuffer(r),b.blitFramebuffer(n,a,s,E,u,_,c,l,T,R),b.readBuffer(B),b.bindFramebuffer(i.a.READ_FRAMEBUFFER,M||null),b.bindFramebuffer(i.a.DRAW_FRAMEBUFFER,C||null),N&&d.delete(),F&&m.delete(),m}function Ie(e){return e instanceof De?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:xe(e),deleteFramebuffer:!0}}const Le={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};var Be={[Le.WEBGL2]:[!1,!0],[Le.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Le.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Le.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Le.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Le.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Le.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Le.FLOAT_BLEND]:["EXT_float_blend"],[Le.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Le.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Le.TEXTURE_FLOAT]:["OES_texture_float",!0],[Le.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Le.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Le.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Le.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Le.COLOR_ATTACHMENT_RGBA32F]:[function(e){const t=new re(e,{format:e.RGBA,type:e.FLOAT,dataFormat:e.RGBA}),r=new De(e,{id:"test-framebuffer",check:!1,attachments:{[e.COLOR_ATTACHMENT0]:t}}),n=r.getStatus();return t.delete(),r.delete(),n===e.FRAMEBUFFER_COMPLETE},"EXT_color_buffer_float"],[Le.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Le.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Le.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Le.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Le.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Le.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const Ce=2;function Me(e,t){return pe(e,t)}function pe(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>ye(e,t))}function Ue(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in Be)void 0===e.luma.caps[t]&&(e.luma.caps[t]=ye(e,t));return e.luma.caps}function ye(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[t]&&(e.luma.caps[t]=function(e,t){const r=Be[t];let n;g(r,t);const a=Object(o.f)(e)&&r[1]||r[0];if("function"==typeof a)n=a(e);else if(Array.isArray(a)){n=!0;for(const t of a)n=n&&Boolean(e.getExtension(t))}else"string"==typeof a?n=Boolean(e.getExtension(a)):"boolean"==typeof a?n=a:g(!1);return n}(e,t)),e.luma.caps[t]||o.g.log(Ce,`Feature: ${t} not supported`)(),e.luma.caps[t]}const Pe="Multiple render targets not supported";class De extends U{static isSupported(e,{colorBufferFloat:t,colorBufferHalfFloat:r}={}){let n=!0;return t&&(n=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(n=n&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),n}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new De(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=i.a.COLOR_ATTACHMENT0,this.drawBuffers=[i.a.COLOR_ATTACHMENT0],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[i.a.COLOR_ATTACHMENT0]||null}get texture(){return this.attachments[i.a.COLOR_ATTACHMENT0]||null}get depth(){return this.attachments[i.a.DEPTH_ATTACHMENT]||this.attachments[i.a.DEPTH_STENCIL_ATTACHMENT]||null}get stencil(){return this.attachments[i.a.STENCIL_ATTACHMENT]||this.attachments[i.a.DEPTH_STENCIL_ATTACHMENT]||null}initialize({width:e=1,height:t=1,attachments:r=null,color:n=!0,depth:a=!0,stencil:i=!1,check:s=!0,readBuffer:o,drawBuffers:E}){if(g(e>=0&&t>=0,"Width and height need to be integers"),this.width=e,this.height=t,r)for(const n in r){const a=r[n];(Array.isArray(a)?a[0]:a).resize({width:e,height:t})}else r=this._createDefaultAttachments(n,a,i,e,t);this.update({clearAttachments:!0,attachments:r,readBuffer:o,drawBuffers:E}),r&&s&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();super.delete()}update({attachments:e={},readBuffer:t,drawBuffers:r,clearAttachments:n=!1,resizeAttachments:a=!0}){this.attach(e,{clearAttachments:n,resizeAttachments:a});const{gl:s}=this,o=s.bindFramebuffer(i.a.FRAMEBUFFER,this.handle);return t&&this._setReadBuffer(t),r&&this._setDrawBuffers(r),s.bindFramebuffer(i.a.FRAMEBUFFER,o||null),this}resize({width:e,height:t}={}){if(null===this.handle)return g(void 0===e&&void 0===t),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight),e!==this.width&&t!==this.height&&o.g.log(2,`Resizing framebuffer ${this.id} to ${e}x${t}`)();for(const r in this.attachments)this.attachments[r].resize({width:e,height:t});return this.width=e,this.height=t,this}attach(e,{clearAttachments:t=!1,resizeAttachments:r=!0}={}){const n={};t&&Object.keys(this.attachments).forEach(e=>{n[e]=null}),Object.assign(n,e);const a=this.gl.bindFramebuffer(i.a.FRAMEBUFFER,this.handle);for(const e in n){g(void 0!==e,"Misspelled framebuffer binding point?");const t=Number(e),a=n[t];let i=a;if(i)if(i instanceof Ee)this._attachRenderbuffer({attachment:t,renderbuffer:i});else if(Array.isArray(a)){const[e,r=0,n=0]=a;i=e,this._attachTexture({attachment:t,texture:e,layer:r,level:n})}else this._attachTexture({attachment:t,texture:i,layer:0,level:0});else this._unattach(t);r&&i&&i.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(i.a.FRAMEBUFFER,a||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(e=>!this.attachments[e]).forEach(e=>{delete this.attachments[e]})}checkStatus(){const{gl:e}=this,t=this.getStatus();if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error(function(e){return(De.STATUS||{})[e]||`Framebuffer error ${e}`}(t));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(i.a.FRAMEBUFFER,this.handle),r=e.checkFramebufferStatus(i.a.FRAMEBUFFER);return e.bindFramebuffer(i.a.FRAMEBUFFER,t||null),r}clear({color:e,depth:t,stencil:r,drawBuffers:n=[]}={}){const a=this.gl.bindFramebuffer(i.a.FRAMEBUFFER,this.handle);return(e||t||r)&&Re(this.gl,{color:e,depth:t,stencil:r}),n.forEach((e,t)=>{de({drawBuffer:t,value:e})}),this.gl.bindFramebuffer(i.a.FRAMEBUFFER,a||null),this}readPixels(e={}){return o.g.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return o.g.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return o.g.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return o.g.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return o.g.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return o.g.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:t=0,y:r=0,width:n,height:a}){const{gl:s}=this;O(s);const o=s.bindFramebuffer(i.a.READ_FRAMEBUFFER,this.handle);return 0===t&&0===r&&void 0===n&&void 0===a?s.invalidateFramebuffer(i.a.READ_FRAMEBUFFER,e):s.invalidateFramebuffer(i.a.READ_FRAMEBUFFER,e,t,r,n,a),s.bindFramebuffer(i.a.READ_FRAMEBUFFER,o),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return null===n&&(this.gl.bindFramebuffer(i.a.FRAMEBUFFER,this.handle),n=this.gl.getFramebufferAttachmentParameter(i.a.FRAMEBUFFER,e,t),this.gl.bindFramebuffer(i.a.FRAMEBUFFER,null)),r&&n>1e3&&(n=S(this.gl,n)),n}getAttachmentParameters(e=i.a.COLOR_ATTACHMENT0,t,r=this.constructor.ATTACHMENT_PARAMETERS||[]){const n={};for(const a of r){n[t?S(this.gl,a):a]=this.getAttachmentParameter(e,a,t)}return n}getParameters(e=!0){const t=Object.keys(this.attachments),r={};for(const n of t){const t=Number(n);r[e?S(this.gl,t):t]=this.getAttachmentParameters(t,e)}return r}show(){return"undefined"!=typeof window&&window.open(Fe(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>o.g.level||"undefined"==typeof window)return this;t=t||`Framebuffer ${this.id}`;const r=Fe(this,{maxHeight:100});return o.g.image({logLevel:e,message:t,image:r},t)(),this}bind({target:e=i.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=i.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,a){let s=null;return e&&((s=s||{})[i.a.COLOR_ATTACHMENT0]=new re(this.gl,{id:`${this.id}-color0`,pixels:null,format:i.a.RGBA,type:i.a.UNSIGNED_BYTE,width:n,height:a,mipmaps:!1,parameters:{[i.a.TEXTURE_MIN_FILTER]:i.a.LINEAR,[i.a.TEXTURE_MAG_FILTER]:i.a.LINEAR,[i.a.TEXTURE_WRAP_S]:i.a.CLAMP_TO_EDGE,[i.a.TEXTURE_WRAP_T]:i.a.CLAMP_TO_EDGE}}),this.ownResources.push(s[i.a.COLOR_ATTACHMENT0])),t&&r?((s=s||{})[i.a.DEPTH_STENCIL_ATTACHMENT]=new Ee(this.gl,{id:`${this.id}-depth-stencil`,format:i.a.DEPTH24_STENCIL8,width:n,height:111}),this.ownResources.push(s[i.a.DEPTH_STENCIL_ATTACHMENT])):t?((s=s||{})[i.a.DEPTH_ATTACHMENT]=new Ee(this.gl,{id:`${this.id}-depth`,format:i.a.DEPTH_COMPONENT16,width:n,height:a}),this.ownResources.push(s[i.a.DEPTH_ATTACHMENT])):r&&g(!1),s}_unattach(e){const t=this.attachments[e];t&&(t instanceof Ee?this.gl.framebufferRenderbuffer(i.a.FRAMEBUFFER,e,i.a.RENDERBUFFER,null):this.gl.framebufferTexture2D(i.a.FRAMEBUFFER,e,i.a.TEXTURE_2D,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=i.a.COLOR_ATTACHMENT0,renderbuffer:t}){const{gl:r}=this;r.framebufferRenderbuffer(i.a.FRAMEBUFFER,e,i.a.RENDERBUFFER,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=i.a.COLOR_ATTACHMENT0,texture:t,layer:r,level:n}){const{gl:a}=this;switch(a.bindTexture(t.target,t.handle),t.target){case i.a.TEXTURE_2D_ARRAY:case i.a.TEXTURE_3D:a.framebufferTextureLayer(i.a.FRAMEBUFFER,e,t.target,n,r);break;case i.a.TEXTURE_CUBE_MAP:const s=function(e){return e<i.a.TEXTURE_CUBE_MAP_POSITIVE_X?e+i.a.TEXTURE_CUBE_MAP_POSITIVE_X:e}(r);a.framebufferTexture2D(i.a.FRAMEBUFFER,e,s,t.handle,n);break;case i.a.TEXTURE_2D:a.framebufferTexture2D(i.a.FRAMEBUFFER,e,i.a.TEXTURE_2D,t.handle,n);break;default:g(!1,"Illegal texture type")}a.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const{gl:t}=this;Object(o.f)(t)?t.readBuffer(e):g(e===i.a.COLOR_ATTACHMENT0||e===i.a.BACK,Pe),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this;if(Object(o.f)(t))t.drawBuffers(e);else{const r=t.getExtension("WEBGL.draw_buffers");r?r.drawBuffersWEBGL(e):g(1===e.length&&(e[0]===i.a.COLOR_ATTACHMENT0||e[0]===i.a.BACK),Pe)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=Ue(this.gl);switch(e){case i.a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:return t.WEBGL2?null:0;case i.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE:case i.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:case i.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:case i.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:case i.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:case i.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:return t.WEBGL2?null:8;case i.a.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:return t.WEBGL2?null:i.a.UNSIGNED_INT;case i.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:return t.WEBGL2||t.EXT_sRGB?null:i.a.LINEAR;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(i.a.FRAMEBUFFER,e)}}const ve=[i.a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME,i.a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE,i.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,i.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE,i.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE,i.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE,i.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE,i.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE,i.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE];function Ge(e,t){g(e instanceof re||e instanceof ae||e instanceof ie);const r=e.constructor,{gl:n,width:a,height:i,format:s,type:o,dataFormat:E,border:u,mipmaps:_}=e;return new r(n,Object.assign({width:a,height:i,format:s,type:o,dataFormat:E,border:u,mipmaps:_},t))}function xe(e,t){const{gl:r,width:n,height:a,id:s}=e;return new De(r,Object.assign({},t,{id:`framebuffer-for-${s}`,width:n,height:a,attachments:{[i.a.COLOR_ATTACHMENT0]:e}}))}De.ATTACHMENT_PARAMETERS=ve;var we={[i.a.ALIASED_LINE_WIDTH_RANGE]:{gl1:new Float32Array([1,1])},[i.a.ALIASED_POINT_SIZE_RANGE]:{gl1:new Float32Array([1,1])},[i.a.MAX_TEXTURE_SIZE]:{gl1:64,gl2:2048},[i.a.MAX_CUBE_MAP_TEXTURE_SIZE]:{gl1:16},[i.a.MAX_TEXTURE_IMAGE_UNITS]:{gl1:8},[i.a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]:{gl1:8},[i.a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]:{gl1:0},[i.a.MAX_RENDERBUFFER_SIZE]:{gl1:1},[i.a.MAX_VARYING_VECTORS]:{gl1:8},[i.a.MAX_VERTEX_ATTRIBS]:{gl1:8},[i.a.MAX_VERTEX_UNIFORM_VECTORS]:{gl1:128},[i.a.MAX_FRAGMENT_UNIFORM_VECTORS]:{gl1:16},[i.a.MAX_VIEWPORT_DIMS]:{gl1:new Int32Array([0,0])},[i.a.MAX_3D_TEXTURE_SIZE]:{gl1:0,gl2:256},[i.a.MAX_ARRAY_TEXTURE_LAYERS]:{gl1:0,gl2:256},[i.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:{gl1:0,gl2:0},[i.a.MAX_COLOR_ATTACHMENTS]:{gl1:0,gl2:4},[i.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_COMBINED_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[i.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_DRAW_BUFFERS]:{gl1:0,gl2:4},[i.a.MAX_ELEMENT_INDEX]:{gl1:0,gl2:0},[i.a.MAX_ELEMENTS_INDICES]:{gl1:0,gl2:0},[i.a.MAX_ELEMENTS_VERTICES]:{gl1:0,gl2:0},[i.a.MAX_FRAGMENT_INPUT_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[i.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_SAMPLES]:{gl1:0,gl2:0},[i.a.MAX_SERVER_WAIT_TIMEOUT]:{gl1:0,gl2:0},[i.a.MAX_TEXTURE_LOD_BIAS]:{gl1:0,gl2:0},[i.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:{gl1:0,gl2:0},[i.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_UNIFORM_BLOCK_SIZE]:{gl1:0,gl2:0},[i.a.MAX_UNIFORM_BUFFER_BINDINGS]:{gl1:0,gl2:0},[i.a.MAX_VARYING_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_VERTEX_OUTPUT_COMPONENTS]:{gl1:0,gl2:0},[i.a.MAX_VERTEX_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[i.a.MAX_VERTEX_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[i.a.MIN_PROGRAM_TEXEL_OFFSET]:{gl1:0,gl2:-8,negative:!0},[i.a.MAX_PROGRAM_TEXEL_OFFSET]:{gl1:0,gl2:7},[i.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:{gl1:0,gl2:0}};function He(e){if(e.luma=e.luma||{},!e.luma.limits){e.luma.limits={},e.luma.webgl1MinLimits={},e.luma.webgl2MinLimits={};const t=Object(o.f)(e);for(const r in we){const n=we[r],a=n.gl1,i="gl2"in n?n.gl2:n.gl1,s=t?i:a,o="gl2"in n&&!t||"extension"in n&&!e.getExtension(n.extension)?s:e.getParameter(r);e.luma.limits[r]=o,e.luma.webgl1MinLimits[r]=a,e.luma.webgl2MinLimits[r]=i}}return e.luma.limits}function Xe(e){e.luma=e.luma||{};const t=u(e);return e.luma.info||(e.luma.info={[i.a.UNMASKED_VENDOR_WEBGL]:t.vendor,[i.a.UNMASKED_RENDERER_WEBGL]:t.renderer,[i.a.VENDOR]:t.vendorMasked,[i.a.RENDERER]:t.rendererMasked,[i.a.VERSION]:t.version,[i.a.SHADING_LANGUAGE_VERSION]:t.shadingLanguageVersion}),e.luma.info}function Ve(e){return Object.assign(u(e),{limits:He(e),info:Xe(e),webgl1MinLimits:e.luma.webgl1MinLimits,webgl2MinLimits:e.luma.webgl2MinLimits})}const je={};function We(e,t,r={}){const n=Be[t];if(g(n,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},r=e.userAgent||t.userAgent||"",n=-1!==r.indexOf("MSIE "),a=-1!==r.indexOf("Trident/");return n||a}(r))return!0;if(t in je)return je[t];const a=`#extension GL_${n[0]} : enable\nvoid main(void) {}`,i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,a),e.compileShader(i);const s=e.getShaderParameter(i,e.COMPILE_STATUS);return e.deleteShader(i),je[t]=s,s}function ke(e,t="unnamed"){const r=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:t}const Ke=35632,Ye=35633;function ze(e,t,r,n){const a=e.split(/\r?\n/),i={},s={},o=n||ke(t)||"(unnamed)",E=`${function(e){switch(e){case Ke:return"fragment";case Ye:return"vertex";default:return"unknown type"}}(r)} shader ${o}`;for(let t=0;t<a.length;t++){const r=a[t];if(r.length<=1)continue;const n=r.split(":"),o=n[0],u=parseInt(n[2],10);if(isNaN(u))throw new Error(`GLSL compilation error in ${E}: ${e}`);"WARNING"!==o?i[u]=r:s[u]=r}const u=function(e,t=1,r=": "){const n=e.split(/\r?\n/),a=String(n.length+t-1).length;return n.map((e,n)=>{const i=n+t,s=String(i).length,o=Ze(i,a-s);return o+r+e})}(t);return{shaderName:E,errors:$e(i,u),warnings:$e(s,u)}}function $e(e,t){let r="";for(let n=0;n<t.length;n++){const a=t[n];if((e[n+3]||e[n+2]||e[n+1])&&(r+=`${a}\n`,e[n+1])){const t=e[n+1],a=t.split(":",3),i=a[0],s=parseInt(a[1],10)||0;r+=Ze(`^^^ ${i}: ${t.substring(a.join(":").length+1).trim()}\n\n`,s)}}return r}function Ze(e,t){let r="";for(let e=0;e<t;++e)r+=" ";return`${r}${e}`}const Qe="Shader: GLSL source code must be a JavaScript string";class qe extends U{static getTypeName(e){switch(e){case i.a.VERTEX_SHADER:return"vertex-shader";case i.a.FRAGMENT_SHADER:return"fragment-shader";default:return g(!1),"unknown"}}constructor(e,t){F(e),g("string"==typeof t.source,Qe),super(e,{id:ke(t.source,null)||t.id||L(`unnamed ${qe.getTypeName(t.shaderType)}`)}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){const t=ke(e,null);t&&(this.id=L(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${qe.getTypeName(this.shaderType)}:${this.id}`}getName(){return ke(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL.debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100\n${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(i.a.COMPILE_STATUS)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:t,errors:r,warnings:n}=ze(e,this.source,this.shaderType,this.id);throw o.g.error(`GLSL compilation errors in ${t}\n${r}`)(),o.g.warn(`GLSL compilation warnings in ${t}\n${n}`)(),new Error(`GLSL compilation errors in ${t}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(i.a.SHADER_TYPE),source:this.getSource()}}}class Je extends qe{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:i.a.VERTEX_SHADER}))}_createHandle(){return this.gl.createShader(i.a.VERTEX_SHADER)}}class et extends qe{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:i.a.FRAGMENT_SHADER}))}_createHandle(){return this.gl.createShader(i.a.FRAGMENT_SHADER)}}const tt={[i.a.FLOAT]:ht.bind(null,"uniform1fv",ot,1,Tt),[i.a.FLOAT_VEC2]:ht.bind(null,"uniform2fv",ot,2,Tt),[i.a.FLOAT_VEC3]:ht.bind(null,"uniform3fv",ot,3,Tt),[i.a.FLOAT_VEC4]:ht.bind(null,"uniform4fv",ot,4,Tt),[i.a.INT]:ht.bind(null,"uniform1iv",Et,1,Tt),[i.a.INT_VEC2]:ht.bind(null,"uniform2iv",Et,2,Tt),[i.a.INT_VEC3]:ht.bind(null,"uniform3iv",Et,3,Tt),[i.a.INT_VEC4]:ht.bind(null,"uniform4iv",Et,4,Tt),[i.a.BOOL]:ht.bind(null,"uniform1iv",Et,1,Tt),[i.a.BOOL_VEC2]:ht.bind(null,"uniform2iv",Et,2,Tt),[i.a.BOOL_VEC3]:ht.bind(null,"uniform3iv",Et,3,Tt),[i.a.BOOL_VEC4]:ht.bind(null,"uniform4iv",Et,4,Tt),[i.a.FLOAT_MAT2]:ht.bind(null,"uniformMatrix2fv",ot,4,Rt),[i.a.FLOAT_MAT3]:ht.bind(null,"uniformMatrix3fv",ot,9,Rt),[i.a.FLOAT_MAT4]:ht.bind(null,"uniformMatrix4fv",ot,16,Rt),[i.a.SAMPLER_2D]:ft,[i.a.SAMPLER_CUBE]:ft,[i.a.UNSIGNED_INT]:ht.bind(null,"uniform1uiv",ut,1,Tt),[i.a.UNSIGNED_INT_VEC2]:ht.bind(null,"uniform2uiv",ut,2,Tt),[i.a.UNSIGNED_INT_VEC3]:ht.bind(null,"uniform3uiv",ut,3,Tt),[i.a.UNSIGNED_INT_VEC4]:ht.bind(null,"uniform4uiv",ut,4,Tt),[i.a.FLOAT_MAT2x3]:ht.bind(null,"uniformMatrix2x3fv",ot,6,Rt),[i.a.FLOAT_MAT2x4]:ht.bind(null,"uniformMatrix2x4fv",ot,8,Rt),[i.a.FLOAT_MAT3x2]:ht.bind(null,"uniformMatrix3x2fv",ot,6,Rt),[i.a.FLOAT_MAT3x4]:ht.bind(null,"uniformMatrix3x4fv",ot,12,Rt),[i.a.FLOAT_MAT4x2]:ht.bind(null,"uniformMatrix4x2fv",ot,8,Rt),[i.a.FLOAT_MAT4x3]:ht.bind(null,"uniformMatrix4x3fv",ot,12,Rt),[i.a.SAMPLER_3D]:ft,[i.a.SAMPLER_2D_SHADOW]:ft,[i.a.SAMPLER_2D_ARRAY]:ft,[i.a.SAMPLER_2D_ARRAY_SHADOW]:ft,[i.a.SAMPLER_CUBE_SHADOW]:ft,[i.a.INT_SAMPLER_2D]:ft,[i.a.INT_SAMPLER_3D]:ft,[i.a.INT_SAMPLER_CUBE]:ft,[i.a.INT_SAMPLER_2D_ARRAY]:ft,[i.a.UNSIGNED_INT_SAMPLER_2D]:ft,[i.a.UNSIGNED_INT_SAMPLER_3D]:ft,[i.a.UNSIGNED_INT_SAMPLER_CUBE]:ft,[i.a.UNSIGNED_INT_SAMPLER_2D_ARRAY]:ft},rt={},nt={},at={},it=[0];function st(e,t,r,n){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(it[0]=e,e=it);const a=e.length;if(a%t&&o.g.warn(`Uniform size should be multiples of ${t}`,e)(),e instanceof r)return e;let i=n[a];i||(i=new r(a),n[a]=i);for(let t=0;t<a;t++)i[t]=e[t];return i}function ot(e,t){return st(e,t,Float32Array,rt)}function Et(e,t){return st(e,t,Int32Array,nt)}function ut(e,t){return st(e,t,Uint32Array,at)}function _t(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function ct(e,t,r){const n=tt[r.type];if(!n)throw new Error(`Unknown GLSL uniform type ${r.type}`);return n().bind(null,e,t)}function lt(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;const t=Math.min(e.length,16);for(let r=0;r<t;++r)if(!Number.isFinite(e[r]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof Q||(e instanceof Ee||e instanceof De&&Boolean(e.texture))))}function At(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t]){const n=e[t];for(let e=0,t=r.length;e<t;++e)n[e]=r[e]}else e[t]=r.slice();else e[t]=r}function ft(){let e=null;return(t,r,n)=>{const a=e!==n;return a&&(t.uniform1i(r,n),e=n),a}}function ht(e,t,r,n){let a=null,i=null;return(s,o,E)=>{const u=t(E,r),_=u.length;let c=!1;if(null===a)a=new Float32Array(_),i=_,c=!0;else{g(i===_,"Uniform length cannot change.");for(let e=0;e<_;++e)if(u[e]!==a[e]){c=!0;break}}return c&&(n(s,e,o,u),a.set(u)),c}}function Tt(e,t,r,n){e[t](r,n)}function Rt(e,t,r,n){e[t](r,!1,n)}const dt=5120,gt=5121,Nt=5122,mt=5123,Ft=0,Ot=1,bt=2,St=3,It=4,Lt=5,Bt=6,Ct=5126,Mt={[Ct]:[Ct,1,"float"],35664:[Ct,2,"vec2"],35665:[Ct,3,"vec3"],35666:[Ct,4,"vec4"],5124:[5124,1,"int"],35667:[5124,2,"ivec2"],35668:[5124,3,"ivec3"],35669:[5124,4,"ivec4"],5125:[5125,1,"uint"],36294:[5125,2,"uvec2"],36295:[5125,3,"uvec3"],36296:[5125,4,"uvec4"],35670:[Ct,1,"bool"],35671:[Ct,2,"bvec2"],35672:[Ct,3,"bvec3"],35673:[Ct,4,"bvec4"],35674:[Ct,8,"mat2"],35685:[Ct,8,"mat2x3"],35686:[Ct,8,"mat2x4"],35675:[Ct,12,"mat3"],35687:[Ct,12,"mat3x2"],35688:[Ct,12,"mat3x4"],35676:[Ct,16,"mat4"],35689:[Ct,16,"mat4x2"],35690:[Ct,16,"mat4x3"]};function pt(e){switch(e){case Ft:return Ft;case Ot:case St:case bt:return Ot;case It:case Lt:case Bt:return It;default:return g(!1),0}}function Ut(e){const t=Mt[e];if(!t)return null;const[r,n]=t;return{type:r,components:n}}function yt(e,t){switch(e){case dt:case gt:case Nt:case mt:e=Ct}for(const r in Mt){const[n,a,i]=Mt[r];if(n===e&&a===t)return{glType:r,name:i}}return null}class Pt{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const{name:r,type:a,size:i}=t.getActiveAttrib(e.handle,n),s=t.getAttribLocation(e.handle,r);s>=0&&this._addAttribute(s,r,a,i)}this.attributeInfos.sort((e,t)=>e.location-t.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!Object(o.f)(t))return;const r=t.getProgramParameter(e.handle,t.TRANSFORM_FEEDBACK_VARYINGS);for(let n=0;n<r;n++){const{name:r,type:a,size:i}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,r,a,i)}this.varyingInfos.sort((e,t)=>e.location-t.location)}_addAttribute(e,t,r,n){const{type:a,components:i}=Ut(r),s={type:a,size:n*i};this._inferProperties(e,t,s);const o={location:e,name:t,accessor:new H(s)};this.attributeInfos.push(o),this.attributeInfosByLocation[e]=o,this.attributeInfosByName[o.name]=o}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:a,components:i}=Ut(r),s={location:e,name:t,accessor:new H({type:a,size:n*i})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}const Dt=4,vt=35981,Gt=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class xt extends U{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",Gt),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){const{hash:t,vs:r,fs:n,varyings:a,bufferMode:i=vt}=e;return this.hash=t||"",this.vs="string"==typeof r?new Je(this.gl,{id:`${e.id}-vs`,source:r}):r,this.fs="string"==typeof n?new et(this.gl,{id:`${e.id}-fs`,source:n}):n,g(this.vs instanceof Je),g(this.fs instanceof et),this.uniforms={},this._textureUniforms={},this._texturesRenderable=!0,a&&a.length>0&&(O(this.gl),this.varyings=a,this.gl.transformFeedbackVaryings(this.handle,a,i)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Pt(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=i.a.TRIANGLES,vertexCount:r,offset:a=0,start:s,end:E,isIndexed:u=!1,indexType:_=i.a.UNSIGNED_SHORT,instanceCount:c=0,isInstanced:l=c>0,vertexArray:A=null,transformFeedback:f,framebuffer:h,parameters:T={},uniforms:R,samplers:d}){if((R||d)&&(o.g.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(R||{})),o.g.priority>=e){const n=h?h.id:"default",a=`mode=${S(this.gl,t)} verts=${r} `+`instances=${c} indexType=${S(this.gl,_)} `+`isInstanced=${l} isIndexed=${u} `+`Framebuffer=${n}`;o.g.log(e,a)()}return g(A),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||l&&0===c)&&(A.bindForDraw(r,c,()=>{if(void 0!==h&&(T=Object.assign({},T,{framebuffer:h})),f){const e=pt(t);f.begin(e)}this._bindTextures(),Object(n.c)(this.gl,T,()=>{u&&l?this.gl.drawElementsInstanced(t,r,_,a,c):u&&Object(o.f)(this.gl)&&!isNaN(s)&&!isNaN(E)?this.gl.drawRangeElements(t,s,E,r,_,a):u?this.gl.drawElements(t,r,_,a):l?this.gl.drawArraysInstanced(t,a,r,c):this.gl.drawArrays(t,a,r)}),f&&f.end()}),!0)}setUniforms(e={}){o.g.priority>=2&&function(e,t,r){for(const n in e){const a=e[n];if((!r||Boolean(r[n]))&&!lt(a))throw t=t?`${t} `:"",console.error(`${t} Bad uniform ${n}`,a),new Error(`${t} Bad uniform ${n}`)}}(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let e=r,a=!1;if(e instanceof De&&(e=e.texture),e instanceof Q)if(a=this.uniforms[t]!==r){void 0===n.textureIndex&&(n.textureIndex=this._textureIndexCounter++);const r=e,{textureIndex:a}=n;r.bind(a),e=a,r.loaded||(this._texturesRenderable=!1),this._textureUniforms[t]=r}else e=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(e)||a)&&At(this.uniforms,t,r)}}return this}_areTexturesRenderable(){if(this._texturesRenderable)return!0;this._texturesRenderable=!0;for(const e in this._textureUniforms){const t=this._textureUniforms[e];this._texturesRenderable=this._texturesRenderable&&t.loaded}return this._texturesRenderable}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const e of t){switch(this.gl.getShaderParameter(this.handle,i.a.SHADER_TYPE)){case i.a.VERTEX_SHADER:r.vs=new Je({handle:e});break;case i.a.FRAGMENT_SHADER:r.fs=new et({handle:e})}}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const e=this._getName();this.id=L(e)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=(e=e.replace(/shader/i,""))?`${e}-program`:"program"}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),o.g.time(Dt,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),o.g.timeEnd(Dt,`linkProgram for ${this._getName()}`)(),e.debug||o.g.level>0){if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,e.LINK_STATUS))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(i.a.ACTIVE_UNIFORMS);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n,isArray:a}=_t(r.name);let i=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=ct(e,i,r),r.size>1)for(let t=0;t<r.size;t++)i=e.getUniformLocation(this.handle,`${n}[${t}]`),this._uniformSetters[`${n}[${t}]`]=ct(e,i,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl.uniformBlockBinding(this.handle,e,t)}}const wt=34918,Ht=34919,Xt=35007,Vt=36795,jt=35976,Wt=35887,kt=36202;class Kt extends U{static isSupported(e,t=[]){const r=Object(o.f)(e),n=pe(e,Le.TIMER_QUERY);let a=r||n;for(const e of t)switch(e){case"queries":a=a&&r;break;case"timers":a=a&&n;break;default:g(!1)}return a}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Xt)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?kt:Wt)}beginTransformFeedbackQuery(){return this.begin(jt)}begin(e){return this._queryPending?this:(this.target=e,this.gl.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl.getQueryParameter(this.handle,Ht);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl.getParameter(Vt)}getResult(){return this.gl.getQueryParameter(this.handle,wt)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const a=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}_createHandle(){return Kt.isSupported(this.gl)?this.gl.createQuery():null}_deleteHandle(){this.gl.deleteQuery(this.handle)}}class Yt extends U{static isSupported(e){return Object(o.f)(e)}constructor(e,t={}){O(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,C(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:a,byteOffset:i}=this._getBufferParams(t);return r<0?(this.unused[e]=n,o.g.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,i,a),this)}begin(e=i.a.POINTS){return this.gl.bindTransformFeedback(i.a.TRANSFORM_FEEDBACK,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(i.a.TRANSFORM_FEEDBACK,null),this}_getBufferParams(e){let t,r,n;return e instanceof k==!1?(n=e.buffer,r=e.byteSize,t=e.byteOffset):n=e,void 0===t&&void 0===r||(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,r=0,n){const a=t&&t.handle;return a&&void 0!==n?this.gl.bindBufferRange(i.a.TRANSFORM_FEEDBACK_BUFFER,e,a,r,n):this.gl.bindBufferBase(i.a.TRANSFORM_FEEDBACK_BUFFER,e,a),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(i.a.TRANSFORM_FEEDBACK,this.handle)}}let zt=null;function $t(e,t){var r;return new e((r=e.BYTES_PER_ELEMENT*t,(!zt||zt.byteLength<r)&&(zt=new ArrayBuffer(r)),zt),0,t)}var Zt=r(5),Qt=r(17),qt=r(18);const Jt="elements must be GL.ELEMENT_ARRAY_BUFFER";class er extends U{static isSupported(e,t={}){return!t.constantAttributeZero||(Object(o.f)(e)||"Chrome"===function(e){if(!e&&!Object(Qt.a)())return"Node";if(Object(qt.a)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},r=e||t.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),a=-1!==r.indexOf("Trident/");return n||a?"IE":Zt.b.chrome?"Chrome":Zt.b.safari?"Safari":Zt.b.mozInnerScreenX?"Firefox":"Unknown"}())}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new er(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return er.MAX_ATTRIBUTES=er.MAX_ATTRIBUTES||e.getParameter(e.MAX_VERTEX_ATTRIBS),er.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:er._setConstantFloatArray(e,t,r);break;case Int32Array:er._setConstantIntArray(e,t,r);break;case Uint32Array:er._setConstantUintArray(e,t,r);break;default:g(!1)}}constructor(e,t={}){const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.initialize(t),Object.seal(this)}delete(){super.delete(),this.buffer&&this.buffer.delete()}get MAX_ATTRIBUTES(){return er.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t={}){return g(!e||e.target===i.a.ELEMENT_ARRAY_BUFFER,Jt),this.bind(()=>{this.gl.bindBuffer(i.a.ELEMENT_ARRAY_BUFFER,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===i.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,r);const{size:n,type:a,stride:s,offset:E,normalized:u,integer:_,divisor:c}=r,{gl:l}=this;return e=Number(e),this.bind(()=>{l.bindBuffer(l.ARRAY_BUFFER,t.handle),_?(g(Object(o.f)(l)),l.vertexAttribIPointer(e,n,a,s,E)):l.vertexAttribPointer(e,n,a,u,s,E),l.enableVertexAttribArray(e),l.vertexAttribDivisor(e,c||0)}),this}enable(e,t=!0){return!t&&0===e&&!er.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t,r){const n=this._normalizeConstantArrayValue(t,r),a=n.byteLength*e,i=n.length*e;let s=!this.buffer;if(this.buffer=this.buffer||new k(this.gl,a),s=(s=s||this.buffer.reallocate(a))||!this._compareConstantArrayValues(n,this.bufferValue)){const e=$t(t.constructor,i);!function({target:e,source:t,start:r=0,count:n=1}){const a=t.length,i=n*a;let s=0;for(let n=r;s<a;s++)e[n++]=t[s];for(;s<i;)s<i-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+i-s),s=i)}({target:e,source:n,start:0,count:i}),this.buffer.subData(e),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e,t){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:g(!1)}}static _setConstantIntArray(e,t,r){switch(g(Object(o.f)(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:g(!1)}}static _setConstantUintArray(e,t,r){switch(g(Object(o.f)(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:g(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl.bindVertexArray(e)}_getParameter(e,{location:t}){return g(Number.isFinite(t)),this.bind(()=>{switch(e){case i.a.VERTEX_ATTRIB_ARRAY_POINTER:return this.gl.getVertexAttribOffset(t,e);default:return this.gl.getVertexAttrib(t,e)}})}}const tr="VertexArray: attributes must be Buffers or constants (i.e. typed array)",rr=/^(.+)__LOCATION_([0-9]+)$/,nr=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class ar{constructor(e,t={}){const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new er(e),M(this,"VertexArray","v6.0",nr),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(i.a.ARRAY_BUFFER,null)}),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,r={}){if(t.target===i.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,r);const{location:n,accessor:a}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=a,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,a)),this}setConstant(e,t,r={}){const{location:n,accessor:a}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t,a),this.values[n]=t,this.accessors[n]=a,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new k(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof k&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(i.a.ARRAY_BUFFER,this.buffer.handle),this.gl.vertexAttribPointer(e,1,i.a.FLOAT,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof k&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const{location:a,name:i}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,o.g.once(3,()=>`unused value ${e} in ${this.id}`)(),this;const s=this._getAttributeInfo(i||a);if(!s)return{location:-1,accessor:null};const E=this.accessors[a]||{},u=H.resolve(s.accessor,E,r,n),{size:_,type:c}=u;return g(Number.isFinite(_)&&Number.isFinite(c)),{location:a,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=rr.exec(e),n=r?r[1]:e,a=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+a,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof k)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof k){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else{if(!(t.buffer instanceof k))throw new Error(tr);{const r=t;this.setBuffer(e,r.buffer,r)}}}_setConstantAttributes(e,t){const r=Math.max(0|e,0|t);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)n=this.values[e],ArrayBuffer.isView(n)&&this._setConstantAttribute(e,n)}_setConstantAttributeZero(e,t){if(er.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){er.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:a}=n,i=a>0;if(e.isInstanced=e.isInstanced||i,r instanceof k){const t=r;if(i){const r=t.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,r)}else{const r=t.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,r)}}}setElements(e=null,t={}){return o.g.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}const ir="UniformBufferLayout illegal argument",sr=5126,or=5124,Er=5125;class ur{constructor(e){this.layout={},this.size=0;for(const t in e)this._addUniform(t,e[t]);this.size+=(4-this.size%4)%4;const t=new Float32Array(this.size);this.typedArray={[sr]:t,[or]:new Int32Array(t.buffer),[Er]:new Uint32Array(t.buffer)}}getBytes(){return 4*this.size}getData(){return this.typedArray[sr]}getSubData(e){let t,r;if(void 0===e)t=this.data,r=0;else{const n=this.offsets[e],a=n+this.sizes[e];t=this.data.subarray(n,a),r=4*n}return{data:t,offset:r}}setUniforms(e){for(const t in e)this._setValue(t,e[t]);return this}_setValue(e,t){const r=this.layout[e];g(r,"UniformLayoutStd140 illegal argument");const n=this.typedArray[r.type];1===r.size?n[r.offset]=t:n.set(t,r.offset)}_addUniform(e,t){const r=Ut(t);g(r,ir);const{type:n,components:a}=r;this.size=this._alignTo(this.size,a);const i=this.size;this.size+=a,this.layout[e]={type:n,size:a,offset:i}}_alignTo(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}}function _r(e){let t=100;const r=e.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){const e=parseInt(r[1],10);Number.isFinite(e)&&(t=e)}return t}function cr(e,t={}){const{isInteger:r=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){const{maxElts:r=16,size:n=1}=t;let a="[";for(let i=0;i<e.length&&i<r;++i)i>0&&(a+=`,${i%n==0?" ":""}`),a+=cr(e[i],t);return`${a}${e.length>r?"...":"]"}`}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return r?"0":"0.";if(r)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const n=e.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function lr({header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}={}){g(t);const a=t._uniformSetters,i={},s=Object.keys(a).sort();let o=0;for(const t of s)t.match(".*_.*")||t.match(".*Matrix")||Ar({table:i,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;for(const t of s)t.match(".*Matrix")&&Ar({table:i,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;for(const t of s)i[t]||Ar({table:i,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;let E=0;const u={};if(!n)for(const t in r){const n=r[t];i[t]||(E++,u[t]={Type:`NOT USED: ${n}`,[e]:cr(n)})}return{table:i,count:o,unusedTable:u,unusedCount:E}}function Ar({table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:a}){const i=r[n],s=function(e){return null!=e}(i);return(!a||!s)&&(e[n]={[t]:s?cr(i):"N/A","Uniform Type":s?i:"NOT PROVIDED"},!0)}function fr({vertexArray:e,header:t="Attributes"}={}){if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=hr(e,e.elements,null,t));const n=e.values;for(const a in n){const i=e._getAttributeInfo(a);if(i){let s=`${a}: ${i.name}`;const o=e.accessors[i.location];o&&(s=`${a}: ${Tr(i.name,o)}`),r[s]=hr(e,n[a],o,t)}}return r}function hr(e,t,r,n){const{gl:a}=e;if(!t)return{[n]:"null","Format ":"N/A"};let i,s,o,E="NOT PROVIDED",u="N/A",_="N/A",c="N/A";if(r&&(E=r.type,u=r.size,i=-1!==(E=String(E).replace("Array","")).indexOf("nt")),t instanceof k){const e=t,{data:l,modified:A}=e.getDebugData();let f;if(s=A?"*":"",o=l,_=(c=e.byteLength)/l.BYTES_PER_ELEMENT/u,r){f=`${r.divisor>0?"I ":"P "} ${_} (x${u}=${c} bytes ${S(a,E)})`}else i=!0,f=`${c} bytes`;return{[n]:`${s}${cr(o,{size:u,isInteger:i})}`,"Format ":f}}return{[n]:`${cr(o=t,{size:u=t.length,isInteger:i=-1!==(E=String(t.constructor.name).replace("Array","")).indexOf("nt")})} (constant)`,"Format ":`${u}x${E} (constant)`}}function Tr(e,t){const{type:r,size:n}=t,a=yt(r,n);return a?`${e} (${a.name})`:e}function Rr(e){const t={},r=`Accessors for ${e.id}`;for(const n of e.attributeInfos)if(n){t[`in ${dr(n)}`]={[r]:JSON.stringify(n.accessor)}}for(const n of e.varyingInfos)if(n){t[`out ${dr(n)}`]={[r]:JSON.stringify(n.accessor)}}return t}function dr(e){const{type:t,size:r}=e.accessor,n=yt(t,r);return n?`${n.name} ${e.name}`:e.name}r.d(t,"lumaStats",function(){return T}),r.d(t,"requestAnimationFrame",function(){return R}),r.d(t,"cancelAnimationFrame",function(){return d}),r.d(t,"cloneTextureFrom",function(){return Ge}),r.d(t,"getKeyValue",function(){return b}),r.d(t,"getKey",function(){return S}),r.d(t,"getContextInfo",function(){return Ve}),r.d(t,"getGLContextInfo",function(){return Xe}),r.d(t,"getContextLimits",function(){return He}),r.d(t,"FEATURES",function(){return Le}),r.d(t,"hasFeature",function(){return Me}),r.d(t,"hasFeatures",function(){return pe}),r.d(t,"getFeatures",function(){return Ue}),r.d(t,"canCompileGLGSExtension",function(){return We}),r.d(t,"Accessor",function(){return H}),r.d(t,"Buffer",function(){return k}),r.d(t,"Shader",function(){return qe}),r.d(t,"VertexShader",function(){return Je}),r.d(t,"FragmentShader",function(){return et}),r.d(t,"Program",function(){return xt}),r.d(t,"Framebuffer",function(){return De}),r.d(t,"Renderbuffer",function(){return Ee}),r.d(t,"Texture2D",function(){return re}),r.d(t,"TextureCube",function(){return ae}),r.d(t,"clear",function(){return Re}),r.d(t,"clearBuffer",function(){return de}),r.d(t,"readPixelsToArray",function(){return Ne}),r.d(t,"readPixelsToBuffer",function(){return me}),r.d(t,"copyToDataUrl",function(){return Fe}),r.d(t,"copyToImage",function(){return Oe}),r.d(t,"copyToTexture",function(){return be}),r.d(t,"blit",function(){return Se}),r.d(t,"Query",function(){return Kt}),r.d(t,"Texture3D",function(){return ie}),r.d(t,"TransformFeedback",function(){return Yt}),r.d(t,"VertexArrayObject",function(){return er}),r.d(t,"VertexArray",function(){return ar}),r.d(t,"UniformBufferLayout",function(){return ur}),r.d(t,"setPathPrefix",function(){return J}),r.d(t,"loadFile",function(){return ee}),r.d(t,"loadImage",function(){return te}),r.d(t,"getShaderName",function(){return ke}),r.d(t,"getShaderVersion",function(){return _r}),r.d(t,"log",function(){return o.g}),r.d(t,"assert",function(){return g}),r.d(t,"uid",function(){return L}),r.d(t,"isObjectEmpty",function(){return C}),r.d(t,"parseUniformName",function(){return _t}),r.d(t,"getUniformSetter",function(){return ct}),r.d(t,"getDebugTableForUniforms",function(){return lr}),r.d(t,"getDebugTableForVertexArray",function(){return fr}),r.d(t,"getDebugTableForProgramConfiguration",function(){return Rr})}])});